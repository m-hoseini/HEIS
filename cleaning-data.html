<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Cleaning data | Household Expenditure and Income Surveys of Iran</title>
  <meta name="description" content="The Household Expenditure and Income Surveys of Iran: Introduction and data cleaning" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Cleaning data | Household Expenditure and Income Surveys of Iran" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The Household Expenditure and Income Surveys of Iran: Introduction and data cleaning" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Cleaning data | Household Expenditure and Income Surveys of Iran" />
  
  <meta name="twitter:description" content="The Household Expenditure and Income Surveys of Iran: Introduction and data cleaning" />
  

<meta name="author" content="Mohammad Hoseini and Avenia Ghazarian" />


<meta name="date" content="2020-12-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="importing-raw-data.html"/>
<link rel="next" href="trends-in-expenditure-items.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="index.html#section"></a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#sample-design"><i class="fa fa-check"></i><b>1.1</b> Sample design</a><ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#rotating-panel-feature"><i class="fa fa-check"></i><b>1.1.1</b> Rotating panel feature</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#different-rounds"><i class="fa fa-check"></i><b>1.2</b> Different rounds</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="questionnaire-details.html"><a href="questionnaire-details.html"><i class="fa fa-check"></i><b>2</b> Questionnaire details</a><ul>
<li class="chapter" data-level="2.1" data-path="questionnaire-details.html"><a href="questionnaire-details.html#part-1---member-characteristics"><i class="fa fa-check"></i><b>2.1</b> Part 1 - Member Characteristics</a></li>
<li class="chapter" data-level="2.2" data-path="questionnaire-details.html"><a href="questionnaire-details.html#part-2---household-facilities"><i class="fa fa-check"></i><b>2.2</b> Part 2 - Household Facilities</a></li>
<li class="chapter" data-level="2.3" data-path="questionnaire-details.html"><a href="questionnaire-details.html#part-3---expenditure"><i class="fa fa-check"></i><b>2.3</b> Part 3 - Expenditure</a></li>
<li class="chapter" data-level="2.4" data-path="questionnaire-details.html"><a href="questionnaire-details.html#part-4-income"><i class="fa fa-check"></i><b>2.4</b> Part 4: Income</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="importing-raw-data.html"><a href="importing-raw-data.html"><i class="fa fa-check"></i><b>3</b> Importing raw data</a><ul>
<li class="chapter" data-level="3.1" data-path="importing-raw-data.html"><a href="importing-raw-data.html#importing-access-files-to-r"><i class="fa fa-check"></i><b>3.1</b> Importing access files to R</a></li>
<li class="chapter" data-level="3.2" data-path="importing-raw-data.html"><a href="importing-raw-data.html#importing-code-for-all-years"><i class="fa fa-check"></i><b>3.2</b> Importing code for all years</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="cleaning-data.html"><a href="cleaning-data.html"><i class="fa fa-check"></i><b>4</b> Cleaning data</a><ul>
<li class="chapter" data-level="4.1" data-path="cleaning-data.html"><a href="cleaning-data.html#importing-raw-data-and-sampling-information"><i class="fa fa-check"></i><b>4.1</b> Importing raw data and sampling information</a></li>
<li class="chapter" data-level="4.2" data-path="cleaning-data.html"><a href="cleaning-data.html#cleaning-part-1"><i class="fa fa-check"></i><b>4.2</b> Cleaning Part 1</a></li>
<li class="chapter" data-level="4.3" data-path="cleaning-data.html"><a href="cleaning-data.html#cleaning-part-2"><i class="fa fa-check"></i><b>4.3</b> Cleaning Part 2</a></li>
<li class="chapter" data-level="4.4" data-path="cleaning-data.html"><a href="cleaning-data.html#cleaning-part-3"><i class="fa fa-check"></i><b>4.4</b> Cleaning Part 3</a><ul>
<li class="chapter" data-level="4.4.1" data-path="cleaning-data.html"><a href="cleaning-data.html#price-index-and-real-expenditure"><i class="fa fa-check"></i><b>4.4.1</b> Price index and real expenditure</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="cleaning-data.html"><a href="cleaning-data.html#cleaning-part-4"><i class="fa fa-check"></i><b>4.5</b> Cleaning Part 4</a></li>
<li class="chapter" data-level="4.6" data-path="cleaning-data.html"><a href="cleaning-data.html#building-item-level-data"><i class="fa fa-check"></i><b>4.6</b> Building item-level data</a></li>
<li class="chapter" data-level="4.7" data-path="cleaning-data.html"><a href="cleaning-data.html#building-individual-level-data"><i class="fa fa-check"></i><b>4.7</b> Building individual-level data</a></li>
<li class="chapter" data-level="4.8" data-path="cleaning-data.html"><a href="cleaning-data.html#building-household-level-data-summary-files"><i class="fa fa-check"></i><b>4.8</b> Building Household-level data (summary files)</a><ul>
<li class="chapter" data-level="4.8.1" data-path="cleaning-data.html"><a href="cleaning-data.html#exporting-to-other-formats."><i class="fa fa-check"></i><b>4.8.1</b> Exporting to other formats.</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="cleaning-data.html"><a href="cleaning-data.html#special-issues-for-different-years"><i class="fa fa-check"></i><b>4.9</b> Special issues for different years</a><ul>
<li class="chapter" data-level="4.9.1" data-path="cleaning-data.html"><a href="cleaning-data.html#the-structure-of-address-variable"><i class="fa fa-check"></i><b>4.9.1</b> The structure of Address variable</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="trends-in-expenditure-items.html"><a href="trends-in-expenditure-items.html"><i class="fa fa-check"></i><b>5</b> Trends in expenditure items</a><ul>
<li class="chapter" data-level="5.1" data-path="trends-in-expenditure-items.html"><a href="trends-in-expenditure-items.html#total-expenditure-across-coicop-groups"><i class="fa fa-check"></i><b>5.1</b> Total expenditure across COICOP groups</a></li>
<li class="chapter" data-level="5.2" data-path="trends-in-expenditure-items.html"><a href="trends-in-expenditure-items.html#expenditure-shares-of-coicop-groups"><i class="fa fa-check"></i><b>5.2</b> Expenditure shares of COICOP groups</a></li>
<li class="chapter" data-level="5.3" data-path="trends-in-expenditure-items.html"><a href="trends-in-expenditure-items.html#percapita-expenditure-across-coicop-groups-and-regions"><i class="fa fa-check"></i><b>5.3</b> Percapita expenditure across COICOP groups and regions</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="some-applications-of-household-level-data.html"><a href="some-applications-of-household-level-data.html"><i class="fa fa-check"></i><b>6</b> Some applications of household-level data</a><ul>
<li class="chapter" data-level="6.1" data-path="some-applications-of-household-level-data.html"><a href="some-applications-of-household-level-data.html#gas-price-reform-in-november-2019-in-iran-and-poverty"><i class="fa fa-check"></i><b>6.1</b> Gas price reform in November 2019 in Iran and poverty</a></li>
<li class="chapter" data-level="6.2" data-path="some-applications-of-household-level-data.html"><a href="some-applications-of-household-level-data.html#car-ownership-across-provinces"><i class="fa fa-check"></i><b>6.2</b> Car ownership across provinces</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Household Expenditure and Income Surveys of Iran</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cleaning-data" class="section level1">
<h1><span class="header-section-number">4</span> Cleaning data</h1>
<style type="text/css">
pre {
  max-height: 500px;
  overflow-y: auto;
}

pre[class] {
  max-height: 500px;
}
</style>
<p>The raw data (in <em>rdata</em> format) consists of several data frames each corresponding to a table in the questionnaire. The name of each data frame informs the user about the region, year, part, and table number. For example, R98P3S01 contains Table 1 (food) of Part 3 (expenditure item) for the R (rural) sample of year 98. Our data cleaning process has different steps:</p>
<ul>
<li>for each year of the survey, we write a script to reconcile variable names and codings.</li>
<li>we match item codes with detailed price index</li>
<li>we merge different rounds and build household and individual level datasets overtime.</li>
</ul>
<p>This chapter describes the structure of the script for each survey year and presents a sample code written for 1398. The output of each script, in addition to the cleaned raw data, would be 3 <em>.RDS</em> files (which can be easily exported to <em>.csv</em>, <em>.dta</em>, and other formats) including (1) household-level, (2) individual-level, (3) item-level data frames. For example, the script of the 1398 survey, takes the raw data of <em>98.Rdata</em> file as input and creates the following 4 files as output:</p>
<ul>
<li><em>HEIS98.Rdata</em> which is a cleaned image of the data</li>
<li><em>HH98.Rds</em> which is the household-level data</li>
<li><em>IND98.Rds</em> which is the individual-level data</li>
<li><em>EXP98.Rds</em> which is the item-level data</li>
</ul>
<p>The year-wise scripts can be downloaded from here: <a href="https://bit.ly/3l7jl14" class="uri">https://bit.ly/3l7jl14</a></p>
<p>The cleaned data files for each can be downloaded from here: <a href="https://t.ly/YYfx" class="uri">https://t.ly/YYfx</a></p>
<p>In each yearly scripts we do the following steps:</p>
<ul>
<li>rename variable to have unique names over time</li>
<li>recode expenditure items to have global code over time</li>
<li>attaching each expenditure item to its corresponding price index</li>
<li>merging tables of part 3 to build a unique expenditure data frame</li>
<li>merging part 1 and part 4 to build individual-level data on characteristics and income</li>
<li>aggregating expenditures and income to make household-level data</li>
</ul>
<div id="importing-raw-data-and-sampling-information" class="section level2">
<h2><span class="header-section-number">4.1</span> Importing raw data and sampling information</h2>
<p>In the first step, we import <em>tidyverse</em> library, clear the memory, and import the raw data. In most years, raw data has a separate file for information about the sample like whether it is the original household in the framework, the sample weight, etc. In this code, first, we define province labels and the last two lines regarding Part 1 are for generating variables for province and town codes. The information on the location is available in household ID variables which are titled “Address” in the surveys. The structure of Address is changing over time and we explain it later.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="cleaning-data.html#cb1-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="cleaning-data.html#cb1-2"></a></span>
<span id="cb1-3"><a href="cleaning-data.html#cb1-3"></a><span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())</span>
<span id="cb1-4"><a href="cleaning-data.html#cb1-4"></a></span>
<span id="cb1-5"><a href="cleaning-data.html#cb1-5"></a><span class="kw">load</span>(<span class="st">&quot;./RAW/98.RData&quot;</span>)</span>
<span id="cb1-6"><a href="cleaning-data.html#cb1-6"></a></span>
<span id="cb1-7"><a href="cleaning-data.html#cb1-7"></a><span class="co">##############################</span></span>
<span id="cb1-8"><a href="cleaning-data.html#cb1-8"></a>Province &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">Markazi=</span><span class="st">&quot;00&quot;</span>, <span class="dt">Gilan=</span><span class="st">&quot;01&quot;</span>, <span class="dt">Mazandaran=</span><span class="st">&quot;02&quot;</span>, <span class="dt">AzarbaijanSharghi=</span><span class="st">&quot;03&quot;</span>, <span class="dt">AzarbaijanGharbi=</span><span class="st">&quot;04&quot;</span>,</span>
<span id="cb1-9"><a href="cleaning-data.html#cb1-9"></a>              <span class="dt">Kermanshah=</span><span class="st">&quot;05&quot;</span>, <span class="dt">Kouzestan=</span><span class="st">&quot;06&quot;</span>, <span class="dt">Fars=</span><span class="st">&quot;07&quot;</span>, <span class="dt">Kerman=</span><span class="st">&quot;08&quot;</span>, <span class="dt">KhorasanRazavi=</span><span class="st">&quot;09&quot;</span>,</span>
<span id="cb1-10"><a href="cleaning-data.html#cb1-10"></a>              <span class="dt">Esfahan=</span><span class="st">&quot;10&quot;</span>, <span class="dt">SistanBalouchestan=</span><span class="st">&quot;11&quot;</span>, <span class="dt">Kordestan=</span><span class="st">&quot;12&quot;</span>, <span class="dt">Hamedan=</span><span class="st">&quot;13&quot;</span>, <span class="dt">CharmahalBakhtiari=</span><span class="st">&quot;14&quot;</span>,</span>
<span id="cb1-11"><a href="cleaning-data.html#cb1-11"></a>              <span class="dt">Lorestan=</span><span class="st">&quot;15&quot;</span>, <span class="dt">Ilam=</span><span class="st">&quot;16&quot;</span>, <span class="dt">KohkilouyeBoyerahamad=</span><span class="st">&quot;17&quot;</span>, <span class="dt">Boushehr=</span><span class="st">&quot;18&quot;</span>, <span class="dt">Zanjan=</span><span class="st">&quot;19&quot;</span>, </span>
<span id="cb1-12"><a href="cleaning-data.html#cb1-12"></a>              <span class="dt">Semnan=</span><span class="st">&quot;20&quot;</span>, <span class="dt">Yazd=</span><span class="st">&quot;21&quot;</span>, <span class="dt">Hormozgan=</span><span class="st">&quot;22&quot;</span>, <span class="dt">Tehran=</span><span class="st">&quot;23&quot;</span>, <span class="dt">Ardebil=</span><span class="st">&quot;24&quot;</span>, <span class="dt">Qom=</span><span class="st">&quot;25&quot;</span>, <span class="dt">Qazvin=</span><span class="st">&quot;26&quot;</span>,</span>
<span id="cb1-13"><a href="cleaning-data.html#cb1-13"></a>              <span class="dt">Golestan=</span><span class="st">&quot;27&quot;</span>, <span class="dt">KhorasanShomali=</span><span class="st">&quot;28&quot;</span>, <span class="dt">KhorasanJonoubi=</span><span class="st">&quot;29&quot;</span>, <span class="dt">Alborz=</span><span class="st">&quot;30&quot;</span>)</span>
<span id="cb1-14"><a href="cleaning-data.html#cb1-14"></a></span>
<span id="cb1-15"><a href="cleaning-data.html#cb1-15"></a>R98Data &lt;-<span class="st"> </span>R98Data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-16"><a href="cleaning-data.html#cb1-16"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">month =</span> MahMorajeh, <span class="dt">khanevartype =</span> NoeKhn) <span class="op">%&gt;%</span></span>
<span id="cb1-17"><a href="cleaning-data.html#cb1-17"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">province =</span> <span class="kw">fct_recode</span>(<span class="kw">as.factor</span>(<span class="kw">substr</span>(Address, <span class="dv">2</span>, <span class="dv">3</span>)), <span class="op">!!!</span>Province),</span>
<span id="cb1-18"><a href="cleaning-data.html#cb1-18"></a>         <span class="dt">town =</span> <span class="kw">as.integer</span>(<span class="kw">substr</span>(Address, <span class="dv">4</span>, <span class="dv">5</span>)))</span>
<span id="cb1-19"><a href="cleaning-data.html#cb1-19"></a>U98Data &lt;-<span class="st"> </span>U98Data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-20"><a href="cleaning-data.html#cb1-20"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">month =</span> MahMorajeh, <span class="dt">khanevartype =</span> NoeKhn) <span class="op">%&gt;%</span></span>
<span id="cb1-21"><a href="cleaning-data.html#cb1-21"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">province =</span> <span class="kw">fct_recode</span>(<span class="kw">as.factor</span>(<span class="kw">substr</span>(Address, <span class="dv">2</span>, <span class="dv">3</span>)), <span class="op">!!!</span>Province),</span>
<span id="cb1-22"><a href="cleaning-data.html#cb1-22"></a>         <span class="dt">town =</span> <span class="kw">as.integer</span>(<span class="kw">substr</span>(Address, <span class="dv">4</span>, <span class="dv">5</span>)))</span></code></pre></div>
</div>
<div id="cleaning-part-1" class="section level2">
<h2><span class="header-section-number">4.2</span> Cleaning Part 1</h2>
<p>For part 1, we first define our global codes for member characteristics including relation, gender, literacy, studying, education, occupation, marital such that these variables become comparable overtime. Then we change variable names to have unique names over time. The below code shows the name list of 1398. Finally, we assign our global codes as labels of the variables (levels of factors).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="cleaning-data.html#cb2-1"></a><span class="co">##############################</span></span>
<span id="cb2-2"><a href="cleaning-data.html#cb2-2"></a><span class="co"># Part 1</span></span>
<span id="cb2-3"><a href="cleaning-data.html#cb2-3"></a></span>
<span id="cb2-4"><a href="cleaning-data.html#cb2-4"></a>relation &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">Head=</span><span class="st">&quot;1&quot;</span>, <span class="dt">Spouse=</span><span class="st">&quot;2&quot;</span>, <span class="dt">Child=</span><span class="st">&quot;3&quot;</span>, <span class="dt">SonDaughter_inLaw=</span><span class="st">&quot;4&quot;</span>, <span class="dt">GrandSonDaughter=</span><span class="st">&quot;5&quot;</span>, <span class="dt">Parent=</span><span class="st">&quot;6&quot;</span>, <span class="dt">Sibling=</span><span class="st">&quot;7&quot;</span>, <span class="dt">OtherRelative=</span><span class="st">&quot;8&quot;</span>, <span class="dt">NonRelative=</span><span class="st">&quot;9&quot;</span>)</span>
<span id="cb2-5"><a href="cleaning-data.html#cb2-5"></a>gender &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">Male=</span><span class="st">&quot;1&quot;</span>, <span class="dt">Female=</span><span class="st">&quot;2&quot;</span>)</span>
<span id="cb2-6"><a href="cleaning-data.html#cb2-6"></a>literacy &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">literate=</span><span class="st">&quot;1&quot;</span>, <span class="dt">illiterate=</span><span class="st">&quot;2&quot;</span>)</span>
<span id="cb2-7"><a href="cleaning-data.html#cb2-7"></a>yesno &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">Yes=</span><span class="st">&quot;1&quot;</span>, <span class="dt">No=</span><span class="st">&quot;2&quot;</span>)</span>
<span id="cb2-8"><a href="cleaning-data.html#cb2-8"></a>education &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">Elemantry=</span><span class="st">&quot;1&quot;</span>, <span class="dt">Secondary=</span><span class="st">&quot;2&quot;</span>, <span class="dt">HighSchool=</span><span class="st">&quot;3&quot;</span>, <span class="dt">Diploma=</span><span class="st">&quot;4&quot;</span>, <span class="dt">College=</span><span class="st">&quot;5&quot;</span>, <span class="dt">Bachelor=</span><span class="st">&quot;6&quot;</span>, <span class="dt">Master=</span><span class="st">&quot;7&quot;</span>, <span class="dt">PhD=</span><span class="st">&quot;8&quot;</span>, <span class="dt">Other=</span><span class="st">&quot;9&quot;</span>)</span>
<span id="cb2-9"><a href="cleaning-data.html#cb2-9"></a>occupation &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">employed=</span><span class="st">&quot;1&quot;</span>, <span class="dt">unemployed=</span><span class="st">&quot;2&quot;</span>, <span class="dt">IncomeWOJob=</span><span class="st">&quot;3&quot;</span>, <span class="dt">Student=</span><span class="st">&quot;4&quot;</span>, <span class="dt">Housewife=</span><span class="st">&quot;5&quot;</span>, <span class="dt">Other=</span><span class="st">&quot;6&quot;</span>)</span>
<span id="cb2-10"><a href="cleaning-data.html#cb2-10"></a>marital &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">Married =</span><span class="st">&quot;1&quot;</span>, <span class="dt">Widowed=</span><span class="st">&quot;2&quot;</span>, <span class="dt">Divorced=</span><span class="st">&quot;3&quot;</span>, <span class="dt">Single=</span><span class="st">&quot;4&quot;</span>)</span>
<span id="cb2-11"><a href="cleaning-data.html#cb2-11"></a></span>
<span id="cb2-12"><a href="cleaning-data.html#cb2-12"></a>R98P1 &lt;-<span class="st"> </span>R98P1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-13"><a href="cleaning-data.html#cb2-13"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb2-14"><a href="cleaning-data.html#cb2-14"></a>    <span class="dt">member =</span> DYCOL01,</span>
<span id="cb2-15"><a href="cleaning-data.html#cb2-15"></a>    <span class="dt">relation =</span> DYCOL03,</span>
<span id="cb2-16"><a href="cleaning-data.html#cb2-16"></a>    <span class="dt">gender =</span> DYCOL04,</span>
<span id="cb2-17"><a href="cleaning-data.html#cb2-17"></a>    <span class="dt">age =</span> DYCOL05,</span>
<span id="cb2-18"><a href="cleaning-data.html#cb2-18"></a>    <span class="dt">literacy =</span> DYCOL06,</span>
<span id="cb2-19"><a href="cleaning-data.html#cb2-19"></a>    <span class="dt">studying =</span> DYCOL07,</span>
<span id="cb2-20"><a href="cleaning-data.html#cb2-20"></a>    <span class="dt">degree =</span> DYCOL08,</span>
<span id="cb2-21"><a href="cleaning-data.html#cb2-21"></a>    <span class="dt">occupationalst =</span> DYCOL09,</span>
<span id="cb2-22"><a href="cleaning-data.html#cb2-22"></a>    <span class="dt">maritalst =</span> DYCOL10) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-23"><a href="cleaning-data.html#cb2-23"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">where</span>(is.character), as.integer),</span>
<span id="cb2-24"><a href="cleaning-data.html#cb2-24"></a>         <span class="kw">across</span>(<span class="kw">c</span>(relation,gender,literacy,studying,degree,occupationalst,maritalst), as.factor),</span>
<span id="cb2-25"><a href="cleaning-data.html#cb2-25"></a>         <span class="dt">relation =</span> <span class="kw">fct_recode</span>(relation, <span class="op">!!!</span>relation), </span>
<span id="cb2-26"><a href="cleaning-data.html#cb2-26"></a>         <span class="dt">gender =</span> <span class="kw">fct_recode</span>(gender, <span class="op">!!!</span>gender),</span>
<span id="cb2-27"><a href="cleaning-data.html#cb2-27"></a>         <span class="dt">literacy =</span> <span class="kw">fct_recode</span>(literacy, <span class="op">!!!</span>literacy), </span>
<span id="cb2-28"><a href="cleaning-data.html#cb2-28"></a>         <span class="dt">studying =</span> <span class="kw">fct_recode</span>(studying, <span class="op">!!!</span>yesno),</span>
<span id="cb2-29"><a href="cleaning-data.html#cb2-29"></a>         <span class="dt">degree =</span> <span class="kw">fct_recode</span>(degree, <span class="op">!!!</span>education), </span>
<span id="cb2-30"><a href="cleaning-data.html#cb2-30"></a>         <span class="dt">occupationalst =</span> <span class="kw">fct_recode</span>(occupationalst, <span class="op">!!!</span>occupation),</span>
<span id="cb2-31"><a href="cleaning-data.html#cb2-31"></a>         <span class="dt">maritalst =</span> <span class="kw">fct_recode</span>(maritalst, <span class="op">!!!</span>marital))</span>
<span id="cb2-32"><a href="cleaning-data.html#cb2-32"></a></span>
<span id="cb2-33"><a href="cleaning-data.html#cb2-33"></a>U98P1 &lt;-<span class="st"> </span>U98P1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-34"><a href="cleaning-data.html#cb2-34"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb2-35"><a href="cleaning-data.html#cb2-35"></a>    <span class="dt">member =</span> DYCOL01,</span>
<span id="cb2-36"><a href="cleaning-data.html#cb2-36"></a>    <span class="dt">relation =</span> DYCOL03,</span>
<span id="cb2-37"><a href="cleaning-data.html#cb2-37"></a>    <span class="dt">gender =</span> DYCOL04,</span>
<span id="cb2-38"><a href="cleaning-data.html#cb2-38"></a>    <span class="dt">age =</span> DYCOL05,</span>
<span id="cb2-39"><a href="cleaning-data.html#cb2-39"></a>    <span class="dt">literacy =</span> DYCOL06,</span>
<span id="cb2-40"><a href="cleaning-data.html#cb2-40"></a>    <span class="dt">studying =</span> DYCOL07,</span>
<span id="cb2-41"><a href="cleaning-data.html#cb2-41"></a>    <span class="dt">degree =</span> DYCOL08,</span>
<span id="cb2-42"><a href="cleaning-data.html#cb2-42"></a>    <span class="dt">occupationalst =</span> DYCOL09,</span>
<span id="cb2-43"><a href="cleaning-data.html#cb2-43"></a>    <span class="dt">maritalst =</span> DYCOL10 ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-44"><a href="cleaning-data.html#cb2-44"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">where</span>(is.character), as.integer),</span>
<span id="cb2-45"><a href="cleaning-data.html#cb2-45"></a>         <span class="kw">across</span>(<span class="kw">c</span>(relation,gender,literacy,studying,degree,occupationalst,maritalst), as.factor),</span>
<span id="cb2-46"><a href="cleaning-data.html#cb2-46"></a>         <span class="dt">relation =</span> <span class="kw">fct_recode</span>(relation, <span class="op">!!!</span>relation), </span>
<span id="cb2-47"><a href="cleaning-data.html#cb2-47"></a>         <span class="dt">gender =</span> <span class="kw">fct_recode</span>(gender, <span class="op">!!!</span>gender),</span>
<span id="cb2-48"><a href="cleaning-data.html#cb2-48"></a>         <span class="dt">literacy =</span> <span class="kw">fct_recode</span>(literacy, <span class="op">!!!</span>literacy), </span>
<span id="cb2-49"><a href="cleaning-data.html#cb2-49"></a>         <span class="dt">studying =</span> <span class="kw">fct_recode</span>(studying, <span class="op">!!!</span>yesno),</span>
<span id="cb2-50"><a href="cleaning-data.html#cb2-50"></a>         <span class="dt">degree =</span> <span class="kw">fct_recode</span>(degree, <span class="op">!!!</span>education), </span>
<span id="cb2-51"><a href="cleaning-data.html#cb2-51"></a>         <span class="dt">occupationalst =</span> <span class="kw">fct_recode</span>(occupationalst, <span class="op">!!!</span>occupation),</span>
<span id="cb2-52"><a href="cleaning-data.html#cb2-52"></a>         <span class="dt">maritalst =</span> <span class="kw">fct_recode</span>(maritalst, <span class="op">!!!</span>marital))</span></code></pre></div>
</div>
<div id="cleaning-part-2" class="section level2">
<h2><span class="header-section-number">4.3</span> Cleaning Part 2</h2>
<p>Cleaning Part 2 is similar to Part 1. First defining global labels for variables, then renaming the variables and assigning the labels to variables. Because many variables in this part are yes-no questions, we change the format of those variables to binary for saving space.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="cleaning-data.html#cb3-1"></a><span class="co">##############################</span></span>
<span id="cb3-2"><a href="cleaning-data.html#cb3-2"></a><span class="co"># Part 2</span></span>
<span id="cb3-3"><a href="cleaning-data.html#cb3-3"></a></span>
<span id="cb3-4"><a href="cleaning-data.html#cb3-4"></a>tenure &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">OwnedEstateLand=</span><span class="st">&quot;1&quot;</span>, <span class="dt">OwnedEstate=</span><span class="st">&quot;2&quot;</span>, <span class="dt">Rent=</span><span class="st">&quot;3&quot;</span>, <span class="dt">Mortgage=</span><span class="st">&quot;4&quot;</span>, <span class="dt">Service=</span><span class="st">&quot;5&quot;</span>, <span class="dt">Free=</span><span class="st">&quot;6&quot;</span>, <span class="dt">Other=</span><span class="st">&quot;7&quot;</span>)</span>
<span id="cb3-5"><a href="cleaning-data.html#cb3-5"></a>material &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">MetalBlock=</span><span class="st">&quot;1&quot;</span>, <span class="dt">BrickWood=</span><span class="st">&quot;2&quot;</span>, <span class="dt">Cement=</span><span class="st">&quot;3&quot;</span>, <span class="dt">Brick=</span><span class="st">&quot;4&quot;</span>, <span class="dt">Wood=</span><span class="st">&quot;5&quot;</span>, <span class="dt">WoodKesht=</span><span class="st">&quot;6&quot;</span>, <span class="dt">KeshtGel=</span><span class="st">&quot;7&quot;</span>, <span class="dt">Other=</span><span class="st">&quot;8&quot;</span>)</span>
<span id="cb3-6"><a href="cleaning-data.html#cb3-6"></a>fuel &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">Oil=</span><span class="st">&quot;1&quot;</span>, <span class="dt">Gasoline=</span><span class="st">&quot;2&quot;</span>, <span class="dt">LiquidGas=</span><span class="st">&quot;3&quot;</span>, <span class="dt">NaturalGas=</span><span class="st">&quot;4&quot;</span>, <span class="dt">Electricity=</span><span class="st">&quot;5&quot;</span>, <span class="dt">Wood=</span><span class="st">&quot;6&quot;</span>, <span class="dt">AnimalOil=</span><span class="st">&quot;7&quot;</span>, <span class="dt">Coke=</span><span class="st">&quot;8&quot;</span>, <span class="dt">Other=</span><span class="st">&quot;9&quot;</span>, <span class="dt">None=</span><span class="st">&quot;10&quot;</span> )</span>
<span id="cb3-7"><a href="cleaning-data.html#cb3-7"></a>fuel1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">Oil=</span><span class="st">&quot;11&quot;</span>, <span class="dt">Gasoline=</span><span class="st">&quot;12&quot;</span>, <span class="dt">LiquidGas=</span><span class="st">&quot;13&quot;</span>, <span class="dt">NaturalGas=</span><span class="st">&quot;14&quot;</span>, <span class="dt">Electricity=</span><span class="st">&quot;15&quot;</span>, <span class="dt">Wood=</span><span class="st">&quot;16&quot;</span>, <span class="dt">AnimalOil=</span><span class="st">&quot;17&quot;</span>, <span class="dt">Coke=</span><span class="st">&quot;18&quot;</span>, <span class="dt">Other=</span><span class="st">&quot;19&quot;</span>, <span class="dt">None=</span><span class="st">&quot;20&quot;</span> )</span>
<span id="cb3-8"><a href="cleaning-data.html#cb3-8"></a>fuel2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">Oil=</span><span class="st">&quot;21&quot;</span>, <span class="dt">Gasoline=</span><span class="st">&quot;22&quot;</span>, <span class="dt">LiquidGas=</span><span class="st">&quot;23&quot;</span>, <span class="dt">NaturalGas=</span><span class="st">&quot;24&quot;</span>, <span class="dt">Electricity=</span><span class="st">&quot;25&quot;</span>, <span class="dt">Wood=</span><span class="st">&quot;26&quot;</span>, <span class="dt">AnimalOil=</span><span class="st">&quot;27&quot;</span>, <span class="dt">Coke=</span><span class="st">&quot;28&quot;</span>, <span class="dt">Other=</span><span class="st">&quot;29&quot;</span>, <span class="dt">None=</span><span class="st">&quot;30&quot;</span> )</span>
<span id="cb3-9"><a href="cleaning-data.html#cb3-9"></a></span>
<span id="cb3-10"><a href="cleaning-data.html#cb3-10"></a>R98P2 &lt;-<span class="st"> </span>R98P2 <span class="op">%&gt;%</span></span>
<span id="cb3-11"><a href="cleaning-data.html#cb3-11"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb3-12"><a href="cleaning-data.html#cb3-12"></a>    <span class="dt">tenure =</span> DYCOL01,</span>
<span id="cb3-13"><a href="cleaning-data.html#cb3-13"></a>    <span class="dt">room =</span> DYCOL03,</span>
<span id="cb3-14"><a href="cleaning-data.html#cb3-14"></a>    <span class="dt">space =</span> DYCOL04,</span>
<span id="cb3-15"><a href="cleaning-data.html#cb3-15"></a>    <span class="dt">construction =</span> DYCOL05,</span>
<span id="cb3-16"><a href="cleaning-data.html#cb3-16"></a>    <span class="dt">material =</span> DYCOL06,</span>
<span id="cb3-17"><a href="cleaning-data.html#cb3-17"></a>    <span class="dt">vehicle =</span> DYCOL07,</span>
<span id="cb3-18"><a href="cleaning-data.html#cb3-18"></a>    <span class="dt">motorcycle =</span> DYCOL08,</span>
<span id="cb3-19"><a href="cleaning-data.html#cb3-19"></a>    <span class="dt">bicycle =</span> DYCOL09,</span>
<span id="cb3-20"><a href="cleaning-data.html#cb3-20"></a>    <span class="dt">radio =</span> DYCOL10,</span>
<span id="cb3-21"><a href="cleaning-data.html#cb3-21"></a>    <span class="dt">radiotape =</span> DYCOL11,</span>
<span id="cb3-22"><a href="cleaning-data.html#cb3-22"></a>    <span class="dt">TVbw =</span> DYCOL12,</span>
<span id="cb3-23"><a href="cleaning-data.html#cb3-23"></a>    <span class="dt">TV =</span> DYCOL13,</span>
<span id="cb3-24"><a href="cleaning-data.html#cb3-24"></a>    <span class="dt">VHS_VCD_DVD =</span> DYCOL14,</span>
<span id="cb3-25"><a href="cleaning-data.html#cb3-25"></a>    <span class="dt">computer =</span> DYCOL15,</span>
<span id="cb3-26"><a href="cleaning-data.html#cb3-26"></a>    <span class="dt">cellphone =</span> DYCOL16,</span>
<span id="cb3-27"><a href="cleaning-data.html#cb3-27"></a>    <span class="dt">freezer =</span> DYCOL17,</span>
<span id="cb3-28"><a href="cleaning-data.html#cb3-28"></a>    <span class="dt">refridgerator =</span> DYCOL18,</span>
<span id="cb3-29"><a href="cleaning-data.html#cb3-29"></a>    <span class="dt">fridge =</span> DYCOL19,</span>
<span id="cb3-30"><a href="cleaning-data.html#cb3-30"></a>    <span class="dt">stove =</span> DYCOL20,</span>
<span id="cb3-31"><a href="cleaning-data.html#cb3-31"></a>    <span class="dt">vacuum =</span> DYCOL21,</span>
<span id="cb3-32"><a href="cleaning-data.html#cb3-32"></a>    <span class="dt">washingmachine =</span> DYCOL22,</span>
<span id="cb3-33"><a href="cleaning-data.html#cb3-33"></a>    <span class="dt">sewingmachine =</span> DYCOL23,</span>
<span id="cb3-34"><a href="cleaning-data.html#cb3-34"></a>    <span class="dt">fan =</span> DYCOL24,</span>
<span id="cb3-35"><a href="cleaning-data.html#cb3-35"></a>    <span class="dt">evapcoolingportable =</span> DYCOL25,</span>
<span id="cb3-36"><a href="cleaning-data.html#cb3-36"></a>    <span class="dt">splitportable =</span> DYCOL26,</span>
<span id="cb3-37"><a href="cleaning-data.html#cb3-37"></a>    <span class="dt">dishwasher =</span> DYCOL27,</span>
<span id="cb3-38"><a href="cleaning-data.html#cb3-38"></a>    <span class="dt">microwave =</span> DYCOL28,</span>
<span id="cb3-39"><a href="cleaning-data.html#cb3-39"></a>    <span class="dt">none =</span> DYCOL29,</span>
<span id="cb3-40"><a href="cleaning-data.html#cb3-40"></a>    <span class="dt">pipewater =</span> DYCOL30,</span>
<span id="cb3-41"><a href="cleaning-data.html#cb3-41"></a>    <span class="dt">electricity =</span> DYCOL31,</span>
<span id="cb3-42"><a href="cleaning-data.html#cb3-42"></a>    <span class="dt">pipegas =</span> DYCOL32,</span>
<span id="cb3-43"><a href="cleaning-data.html#cb3-43"></a>    <span class="dt">telephone =</span> DYCOL33,</span>
<span id="cb3-44"><a href="cleaning-data.html#cb3-44"></a>    <span class="dt">internet  =</span> DYCOL34,</span>
<span id="cb3-45"><a href="cleaning-data.html#cb3-45"></a>    <span class="dt">bathroom =</span> DYCOL35,</span>
<span id="cb3-46"><a href="cleaning-data.html#cb3-46"></a>    <span class="dt">kitchen =</span> DYCOL36,</span>
<span id="cb3-47"><a href="cleaning-data.html#cb3-47"></a>    <span class="dt">evapcooling =</span> DYCOL37,</span>
<span id="cb3-48"><a href="cleaning-data.html#cb3-48"></a>    <span class="dt">centralcooling =</span> DYCOL38,</span>
<span id="cb3-49"><a href="cleaning-data.html#cb3-49"></a>    <span class="dt">centralheating =</span> DYCOL39,</span>
<span id="cb3-50"><a href="cleaning-data.html#cb3-50"></a>    <span class="dt">package =</span> DYCOL40,</span>
<span id="cb3-51"><a href="cleaning-data.html#cb3-51"></a>    <span class="dt">split =</span> DYCOL41,</span>
<span id="cb3-52"><a href="cleaning-data.html#cb3-52"></a>    <span class="dt">wastewater =</span> DYCOL42,</span>
<span id="cb3-53"><a href="cleaning-data.html#cb3-53"></a>    <span class="dt">cookingfuel =</span> DYCOL43,</span>
<span id="cb3-54"><a href="cleaning-data.html#cb3-54"></a>    <span class="dt">heatingfuel =</span> DYCOL44,</span>
<span id="cb3-55"><a href="cleaning-data.html#cb3-55"></a>    <span class="dt">waterheatingfuel =</span> DYCOL45) <span class="op">%&gt;%</span></span>
<span id="cb3-56"><a href="cleaning-data.html#cb3-56"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">where</span>(is.character), as.integer),</span>
<span id="cb3-57"><a href="cleaning-data.html#cb3-57"></a>         <span class="kw">across</span>(<span class="kw">c</span>(tenure,material,cookingfuel,heatingfuel,waterheatingfuel), as.factor),</span>
<span id="cb3-58"><a href="cleaning-data.html#cb3-58"></a>         <span class="dt">tenure =</span> <span class="kw">fct_recode</span>(tenure, <span class="op">!!!</span>tenure), </span>
<span id="cb3-59"><a href="cleaning-data.html#cb3-59"></a>         <span class="dt">material =</span> <span class="kw">fct_recode</span>(material, <span class="op">!!!</span>material),</span>
<span id="cb3-60"><a href="cleaning-data.html#cb3-60"></a>         <span class="dt">cookingfuel =</span> <span class="kw">fct_recode</span>(cookingfuel, <span class="op">!!!</span>fuel), </span>
<span id="cb3-61"><a href="cleaning-data.html#cb3-61"></a>         <span class="dt">heatingfuel =</span> <span class="kw">fct_recode</span>(heatingfuel, <span class="op">!!!</span>fuel1),</span>
<span id="cb3-62"><a href="cleaning-data.html#cb3-62"></a>         <span class="dt">waterheatingfuel =</span> <span class="kw">fct_recode</span>(waterheatingfuel, <span class="op">!!!</span>fuel2),</span>
<span id="cb3-63"><a href="cleaning-data.html#cb3-63"></a>         <span class="kw">across</span>(vehicle<span class="op">:</span>wastewater, <span class="op">~!</span><span class="kw">is.na</span>(.x)))</span>
<span id="cb3-64"><a href="cleaning-data.html#cb3-64"></a>         </span>
<span id="cb3-65"><a href="cleaning-data.html#cb3-65"></a></span>
<span id="cb3-66"><a href="cleaning-data.html#cb3-66"></a>U98P2 &lt;-<span class="st"> </span>U98P2 <span class="op">%&gt;%</span></span>
<span id="cb3-67"><a href="cleaning-data.html#cb3-67"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb3-68"><a href="cleaning-data.html#cb3-68"></a>    <span class="dt">tenure =</span> DYCOL01,</span>
<span id="cb3-69"><a href="cleaning-data.html#cb3-69"></a>    <span class="dt">room =</span> DYCOL03,</span>
<span id="cb3-70"><a href="cleaning-data.html#cb3-70"></a>    <span class="dt">space =</span> DYCOL04,</span>
<span id="cb3-71"><a href="cleaning-data.html#cb3-71"></a>    <span class="dt">construction =</span> DYCOL05,</span>
<span id="cb3-72"><a href="cleaning-data.html#cb3-72"></a>    <span class="dt">material =</span> DYCOL06,</span>
<span id="cb3-73"><a href="cleaning-data.html#cb3-73"></a>    <span class="dt">vehicle =</span> DYCOL07,</span>
<span id="cb3-74"><a href="cleaning-data.html#cb3-74"></a>    <span class="dt">motorcycle =</span> DYCOL08,</span>
<span id="cb3-75"><a href="cleaning-data.html#cb3-75"></a>    <span class="dt">bicycle =</span> DYCOL09,</span>
<span id="cb3-76"><a href="cleaning-data.html#cb3-76"></a>    <span class="dt">radio =</span> DYCOL10,</span>
<span id="cb3-77"><a href="cleaning-data.html#cb3-77"></a>    <span class="dt">radiotape =</span> DYCOL11,</span>
<span id="cb3-78"><a href="cleaning-data.html#cb3-78"></a>    <span class="dt">TVbw =</span> DYCOL12,</span>
<span id="cb3-79"><a href="cleaning-data.html#cb3-79"></a>    <span class="dt">TV =</span> DYCOL13,</span>
<span id="cb3-80"><a href="cleaning-data.html#cb3-80"></a>    <span class="dt">VHS_VCD_DVD =</span> DYCOL14,</span>
<span id="cb3-81"><a href="cleaning-data.html#cb3-81"></a>    <span class="dt">computer =</span> DYCOL15,</span>
<span id="cb3-82"><a href="cleaning-data.html#cb3-82"></a>    <span class="dt">cellphone =</span> DYCOL16,</span>
<span id="cb3-83"><a href="cleaning-data.html#cb3-83"></a>    <span class="dt">freezer =</span> DYCOL17,</span>
<span id="cb3-84"><a href="cleaning-data.html#cb3-84"></a>    <span class="dt">refridgerator =</span> DYCOL18,</span>
<span id="cb3-85"><a href="cleaning-data.html#cb3-85"></a>    <span class="dt">fridge =</span> DYCOL19,</span>
<span id="cb3-86"><a href="cleaning-data.html#cb3-86"></a>    <span class="dt">stove =</span> DYCOL20,</span>
<span id="cb3-87"><a href="cleaning-data.html#cb3-87"></a>    <span class="dt">vacuum =</span> DYCOL21,</span>
<span id="cb3-88"><a href="cleaning-data.html#cb3-88"></a>    <span class="dt">washingmachine =</span> DYCOL22,</span>
<span id="cb3-89"><a href="cleaning-data.html#cb3-89"></a>    <span class="dt">sewingmachine =</span> DYCOL23,</span>
<span id="cb3-90"><a href="cleaning-data.html#cb3-90"></a>    <span class="dt">fan =</span> DYCOL24,</span>
<span id="cb3-91"><a href="cleaning-data.html#cb3-91"></a>    <span class="dt">evapcoolingportable =</span> DYCOL25,</span>
<span id="cb3-92"><a href="cleaning-data.html#cb3-92"></a>    <span class="dt">splitportable =</span> DYCOL26,</span>
<span id="cb3-93"><a href="cleaning-data.html#cb3-93"></a>    <span class="dt">dishwasher =</span> DYCOL27,</span>
<span id="cb3-94"><a href="cleaning-data.html#cb3-94"></a>    <span class="dt">microwave =</span> DYCOL28,</span>
<span id="cb3-95"><a href="cleaning-data.html#cb3-95"></a>    <span class="dt">none =</span> DYCOL29,</span>
<span id="cb3-96"><a href="cleaning-data.html#cb3-96"></a>    <span class="dt">pipewater =</span> DYCOL30,</span>
<span id="cb3-97"><a href="cleaning-data.html#cb3-97"></a>    <span class="dt">electricity =</span> DYCOL31,</span>
<span id="cb3-98"><a href="cleaning-data.html#cb3-98"></a>    <span class="dt">pipegas =</span> DYCOL32,</span>
<span id="cb3-99"><a href="cleaning-data.html#cb3-99"></a>    <span class="dt">telephone =</span> DYCOL33,</span>
<span id="cb3-100"><a href="cleaning-data.html#cb3-100"></a>    <span class="dt">internet  =</span> DYCOL34,</span>
<span id="cb3-101"><a href="cleaning-data.html#cb3-101"></a>    <span class="dt">bathroom =</span> DYCOL35,</span>
<span id="cb3-102"><a href="cleaning-data.html#cb3-102"></a>    <span class="dt">kitchen =</span> DYCOL36,</span>
<span id="cb3-103"><a href="cleaning-data.html#cb3-103"></a>    <span class="dt">evapcooling =</span> DYCOL37,</span>
<span id="cb3-104"><a href="cleaning-data.html#cb3-104"></a>    <span class="dt">centralcooling =</span> DYCOL38,</span>
<span id="cb3-105"><a href="cleaning-data.html#cb3-105"></a>    <span class="dt">centralheating =</span> DYCOL39,</span>
<span id="cb3-106"><a href="cleaning-data.html#cb3-106"></a>    <span class="dt">package =</span> DYCOL40,</span>
<span id="cb3-107"><a href="cleaning-data.html#cb3-107"></a>    <span class="dt">split =</span> DYCOL41,</span>
<span id="cb3-108"><a href="cleaning-data.html#cb3-108"></a>    <span class="dt">wastewater =</span> DYCOL42,</span>
<span id="cb3-109"><a href="cleaning-data.html#cb3-109"></a>    <span class="dt">cookingfuel =</span> DYCOL43,</span>
<span id="cb3-110"><a href="cleaning-data.html#cb3-110"></a>    <span class="dt">heatingfuel =</span> DYCOL44,</span>
<span id="cb3-111"><a href="cleaning-data.html#cb3-111"></a>    <span class="dt">waterheatingfuel =</span> DYCOL45) <span class="op">%&gt;%</span></span>
<span id="cb3-112"><a href="cleaning-data.html#cb3-112"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">where</span>(is.character), as.integer),</span>
<span id="cb3-113"><a href="cleaning-data.html#cb3-113"></a>         <span class="kw">across</span>(<span class="kw">c</span>(tenure,material,cookingfuel,heatingfuel,waterheatingfuel), as.factor),</span>
<span id="cb3-114"><a href="cleaning-data.html#cb3-114"></a>         <span class="dt">tenure =</span> <span class="kw">fct_recode</span>(tenure, <span class="op">!!!</span>tenure), </span>
<span id="cb3-115"><a href="cleaning-data.html#cb3-115"></a>         <span class="dt">material =</span> <span class="kw">fct_recode</span>(material, <span class="op">!!!</span>material),</span>
<span id="cb3-116"><a href="cleaning-data.html#cb3-116"></a>         <span class="dt">cookingfuel =</span> <span class="kw">fct_recode</span>(cookingfuel, <span class="op">!!!</span>fuel), </span>
<span id="cb3-117"><a href="cleaning-data.html#cb3-117"></a>         <span class="dt">heatingfuel =</span> <span class="kw">fct_recode</span>(heatingfuel, <span class="op">!!!</span>fuel1),</span>
<span id="cb3-118"><a href="cleaning-data.html#cb3-118"></a>         <span class="dt">waterheatingfuel =</span> <span class="kw">fct_recode</span>(waterheatingfuel, <span class="op">!!!</span>fuel2),</span>
<span id="cb3-119"><a href="cleaning-data.html#cb3-119"></a>         <span class="kw">across</span>(vehicle<span class="op">:</span>wastewater, <span class="op">~!</span><span class="kw">is.na</span>(.x)))</span></code></pre></div>
</div>
<div id="cleaning-part-3" class="section level2">
<h2><span class="header-section-number">4.4</span> Cleaning Part 3</h2>
<p>The most cumbersome step to clean HEIS is to match expenditure items data over time and adjust the value by price indices. We first rename all columns to have the same name over different rounds of surveys and then define a unique code for each expenditure item. As expenditure categories are changing over time and in many cases, a more general classification is decomposed into different categories, our global codes cover both general and detailed classifications. For example in one year there is an expenditure item ‘fruit’ and in the next year, it is decomposed into ‘apple’, ‘banana’, and other fruits. We then would have 4 global codes: 1-fruit, 2-apple, 3-banana, 4-other fruits.</p>
<div id="price-index-and-real-expenditure" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Price index and real expenditure</h3>
<p>After defining the global codes for each round, we merge each item with its price index. The index we use is based on an item-level monthly consumer price index published for over 500 items by the Central Bank of Iran. We obtained the indices for two base years: The index with the base year 1390 = 100, is available for years before 1395, and the index with the base year 1395 = 100, is available from 1392 onwards. We use the first index for the year before 1395, and the second index for years after 1395. To remove the drop in the level of indices between the two series, we compute the average ratio of the two indices in their overlapping years (1392 to 1395) for each item and multiply the second series by that ratio.</p>
<p>As the item coding in HEIS (COICOP) is different from CPI item code, we need to match each COICOP item to a proper CPI item. This correspondence is not always straight forward. Some COICOP items are corresponding to multiple CPI items and vice versa. For this reason, we compute the price index for each COICOP item as the weighted average of the index of its corresponding CPI items, where the weight is drawn from the base basket of CPI. Also in several instances, there is no specific CPI code for a COICOP item (e.g. donations) and in these cases, we use overall CPI as the price index. Doing these steps result in a price index file (<em>CPI.rds</em>) in which a monthly price index is computed for each global code (COICOP item).</p>
<p>Because households are surveyed in different months of the year and each table has a different recall period, for performing price adjustment of values, we note both the month of the survey and the recall period of the item. For items with past month recall period (Expenditure tables 1 to 12), we use the monthly price index, but for items with past year recall period (Expenditure tables 13 and 14), we use the average of the price index in 12 months ending to the month of the survey.</p>
<p>Here is a sample code for 1398. At first, we define two data frames <em>month</em> that attaches the month of the survey to each household Address, and <em>CPI</em> which provides the COICOP-level monthly price index. Then for each table, we rename variables and define unique item code as <em>DYCOL00</em>. Notice that the variables in all tables are not the same. The two variables “code” referring to item code in that year and “purchased” refers to the method of obtaining exist in all tables. But many variables exist in only some tables like “gram”, “kilogram”, “price” in tables 1 and 2, “cost” and “sell” in table 13 and 14. In tables 1 to 12, “value” refers to the value of transactions, but in tables 13 and 14 no such variable already exists and we define “value” as the net expenditure (cost-sell). We define a variable <em>table</em> to simplify summarizing expenditures in the next steps. The last four lines of code for each table is to merge the price index and generating the value of expenditure in fixed price “value_r”. As mentioned above, in tables 1 to 12, the monthly price index is used, but in tables 13 and 14, the yearly average of the indices.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="cleaning-data.html#cb4-1"></a><span class="co"># Adding Global variable as DYCOL00</span></span>
<span id="cb4-2"><a href="cleaning-data.html#cb4-2"></a></span>
<span id="cb4-3"><a href="cleaning-data.html#cb4-3"></a><span class="co">##############################</span></span>
<span id="cb4-4"><a href="cleaning-data.html#cb4-4"></a><span class="co"># Part 3, Table 1</span></span>
<span id="cb4-5"><a href="cleaning-data.html#cb4-5"></a></span>
<span id="cb4-6"><a href="cleaning-data.html#cb4-6"></a>month &lt;-<span class="st"> </span>R98Data <span class="op">%&gt;%</span></span>
<span id="cb4-7"><a href="cleaning-data.html#cb4-7"></a><span class="st">  </span><span class="kw">bind_rows</span>(U98Data) <span class="op">%&gt;%</span></span>
<span id="cb4-8"><a href="cleaning-data.html#cb4-8"></a><span class="st">  </span><span class="kw">select</span>(Address,month) <span class="op">%&gt;%</span></span>
<span id="cb4-9"><a href="cleaning-data.html#cb4-9"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year=</span><span class="dv">1398</span>)</span>
<span id="cb4-10"><a href="cleaning-data.html#cb4-10"></a></span>
<span id="cb4-11"><a href="cleaning-data.html#cb4-11"></a>CPI &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;CPI/CPI.rds&quot;</span>)</span>
<span id="cb4-12"><a href="cleaning-data.html#cb4-12"></a></span>
<span id="cb4-13"><a href="cleaning-data.html#cb4-13"></a>R98P3S01 &lt;-<span class="st"> </span>R98P3S01 <span class="op">%&gt;%</span></span>
<span id="cb4-14"><a href="cleaning-data.html#cb4-14"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb4-15"><a href="cleaning-data.html#cb4-15"></a>    <span class="dt">code =</span> DYCOL01,</span>
<span id="cb4-16"><a href="cleaning-data.html#cb4-16"></a>    <span class="dt">purchased =</span> DYCOL02,</span>
<span id="cb4-17"><a href="cleaning-data.html#cb4-17"></a>    <span class="dt">gram =</span> DYCOL03,</span>
<span id="cb4-18"><a href="cleaning-data.html#cb4-18"></a>    <span class="dt">kilogram =</span> DYCOL04,</span>
<span id="cb4-19"><a href="cleaning-data.html#cb4-19"></a>    <span class="dt">price =</span> DYCOL05,</span>
<span id="cb4-20"><a href="cleaning-data.html#cb4-20"></a>    <span class="dt">value =</span> DYCOL06 ) <span class="op">%&gt;%</span></span>
<span id="cb4-21"><a href="cleaning-data.html#cb4-21"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</span>
<span id="cb4-22"><a href="cleaning-data.html#cb4-22"></a>    code <span class="op">==</span><span class="st"> </span><span class="dv">11241</span> <span class="op">~</span><span class="st"> </span>11240L,</span>
<span id="cb4-23"><a href="cleaning-data.html#cb4-23"></a>    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code),</span>
<span id="cb4-24"><a href="cleaning-data.html#cb4-24"></a>    <span class="kw">across</span>(<span class="kw">c</span>(price,value,kilogram),  <span class="op">~</span><span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(.x)) ),</span>
<span id="cb4-25"><a href="cleaning-data.html#cb4-25"></a>    <span class="dt">table =</span> 1L) <span class="op">%&gt;%</span></span>
<span id="cb4-26"><a href="cleaning-data.html#cb4-26"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb4-27"><a href="cleaning-data.html#cb4-27"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb4-28"><a href="cleaning-data.html#cb4-28"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value_r=</span>value<span class="op">*</span><span class="dv">100</span><span class="op">/</span>cpi) <span class="op">%&gt;%</span></span>
<span id="cb4-29"><a href="cleaning-data.html#cb4-29"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>table, value_r)</span>
<span id="cb4-30"><a href="cleaning-data.html#cb4-30"></a></span>
<span id="cb4-31"><a href="cleaning-data.html#cb4-31"></a></span>
<span id="cb4-32"><a href="cleaning-data.html#cb4-32"></a>U98P3S01 &lt;-<span class="st"> </span>U98P3S01 <span class="op">%&gt;%</span></span>
<span id="cb4-33"><a href="cleaning-data.html#cb4-33"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb4-34"><a href="cleaning-data.html#cb4-34"></a>    <span class="dt">code =</span> DYCOL01,</span>
<span id="cb4-35"><a href="cleaning-data.html#cb4-35"></a>    <span class="dt">purchased =</span> DYCOL02,</span>
<span id="cb4-36"><a href="cleaning-data.html#cb4-36"></a>    <span class="dt">gram =</span> DYCOL03,</span>
<span id="cb4-37"><a href="cleaning-data.html#cb4-37"></a>    <span class="dt">kilogram =</span> DYCOL04,</span>
<span id="cb4-38"><a href="cleaning-data.html#cb4-38"></a>    <span class="dt">price =</span> DYCOL05,</span>
<span id="cb4-39"><a href="cleaning-data.html#cb4-39"></a>    <span class="dt">value =</span> DYCOL06 ) <span class="op">%&gt;%</span></span>
<span id="cb4-40"><a href="cleaning-data.html#cb4-40"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</span>
<span id="cb4-41"><a href="cleaning-data.html#cb4-41"></a>    code <span class="op">==</span><span class="st"> </span><span class="dv">11241</span> <span class="op">~</span><span class="st"> </span>11240L,</span>
<span id="cb4-42"><a href="cleaning-data.html#cb4-42"></a>    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code),</span>
<span id="cb4-43"><a href="cleaning-data.html#cb4-43"></a>    <span class="kw">across</span>(<span class="kw">c</span>(price,value,kilogram),  <span class="op">~</span><span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(.x)) ),</span>
<span id="cb4-44"><a href="cleaning-data.html#cb4-44"></a>    <span class="dt">table =</span> 1L) <span class="op">%&gt;%</span></span>
<span id="cb4-45"><a href="cleaning-data.html#cb4-45"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb4-46"><a href="cleaning-data.html#cb4-46"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb4-47"><a href="cleaning-data.html#cb4-47"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value_r=</span>value<span class="op">*</span><span class="dv">100</span><span class="op">/</span>cpi) <span class="op">%&gt;%</span></span>
<span id="cb4-48"><a href="cleaning-data.html#cb4-48"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>table, value_r)</span>
<span id="cb4-49"><a href="cleaning-data.html#cb4-49"></a></span>
<span id="cb4-50"><a href="cleaning-data.html#cb4-50"></a><span class="co"># Part 3, Table 2</span></span>
<span id="cb4-51"><a href="cleaning-data.html#cb4-51"></a>R98P3S02 &lt;-<span class="st"> </span>R98P3S02 <span class="op">%&gt;%</span></span>
<span id="cb4-52"><a href="cleaning-data.html#cb4-52"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb4-53"><a href="cleaning-data.html#cb4-53"></a>    <span class="dt">code =</span> DYCOL01,</span>
<span id="cb4-54"><a href="cleaning-data.html#cb4-54"></a>    <span class="dt">purchased =</span> DYCOL02,</span>
<span id="cb4-55"><a href="cleaning-data.html#cb4-55"></a>    <span class="dt">gram =</span> DYCOL03,</span>
<span id="cb4-56"><a href="cleaning-data.html#cb4-56"></a>    <span class="dt">kilogram =</span> DYCOL04,</span>
<span id="cb4-57"><a href="cleaning-data.html#cb4-57"></a>    <span class="dt">price =</span> DYCOL05,</span>
<span id="cb4-58"><a href="cleaning-data.html#cb4-58"></a>    <span class="dt">value =</span> DYCOL06 ) <span class="op">%&gt;%</span></span>
<span id="cb4-59"><a href="cleaning-data.html#cb4-59"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</span>
<span id="cb4-60"><a href="cleaning-data.html#cb4-60"></a>         <span class="dt">table =</span> 2L) <span class="op">%&gt;%</span></span>
<span id="cb4-61"><a href="cleaning-data.html#cb4-61"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb4-62"><a href="cleaning-data.html#cb4-62"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb4-63"><a href="cleaning-data.html#cb4-63"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value_r=</span>value<span class="op">*</span><span class="dv">100</span><span class="op">/</span>cpi) <span class="op">%&gt;%</span></span>
<span id="cb4-64"><a href="cleaning-data.html#cb4-64"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>table, value_r)</span>
<span id="cb4-65"><a href="cleaning-data.html#cb4-65"></a></span>
<span id="cb4-66"><a href="cleaning-data.html#cb4-66"></a>U98P3S02 &lt;-<span class="st"> </span>U98P3S02 <span class="op">%&gt;%</span></span>
<span id="cb4-67"><a href="cleaning-data.html#cb4-67"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb4-68"><a href="cleaning-data.html#cb4-68"></a>    <span class="dt">code =</span> DYCOL01,</span>
<span id="cb4-69"><a href="cleaning-data.html#cb4-69"></a>    <span class="dt">purchased =</span> DYCOL02,</span>
<span id="cb4-70"><a href="cleaning-data.html#cb4-70"></a>    <span class="dt">gram =</span> DYCOL03,</span>
<span id="cb4-71"><a href="cleaning-data.html#cb4-71"></a>    <span class="dt">kilogram =</span> DYCOL04,</span>
<span id="cb4-72"><a href="cleaning-data.html#cb4-72"></a>    <span class="dt">price =</span> DYCOL05,</span>
<span id="cb4-73"><a href="cleaning-data.html#cb4-73"></a>    <span class="dt">value =</span> DYCOL06 ) <span class="op">%&gt;%</span></span>
<span id="cb4-74"><a href="cleaning-data.html#cb4-74"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</span>
<span id="cb4-75"><a href="cleaning-data.html#cb4-75"></a>         <span class="dt">table =</span> 2L) <span class="op">%&gt;%</span></span>
<span id="cb4-76"><a href="cleaning-data.html#cb4-76"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb4-77"><a href="cleaning-data.html#cb4-77"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb4-78"><a href="cleaning-data.html#cb4-78"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value_r=</span>value<span class="op">*</span><span class="dv">100</span><span class="op">/</span>cpi) <span class="op">%&gt;%</span></span>
<span id="cb4-79"><a href="cleaning-data.html#cb4-79"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>table, value_r)</span>
<span id="cb4-80"><a href="cleaning-data.html#cb4-80"></a></span>
<span id="cb4-81"><a href="cleaning-data.html#cb4-81"></a><span class="co"># Part 3, Table 3</span></span>
<span id="cb4-82"><a href="cleaning-data.html#cb4-82"></a>R98P3S03 &lt;-<span class="st"> </span>R98P3S03 <span class="op">%&gt;%</span></span>
<span id="cb4-83"><a href="cleaning-data.html#cb4-83"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb4-84"><a href="cleaning-data.html#cb4-84"></a>    <span class="dt">code =</span> DYCOL01,</span>
<span id="cb4-85"><a href="cleaning-data.html#cb4-85"></a>    <span class="dt">purchased =</span> DYCOL02,</span>
<span id="cb4-86"><a href="cleaning-data.html#cb4-86"></a>    <span class="dt">value =</span> DYCOL03 ) <span class="op">%&gt;%</span></span>
<span id="cb4-87"><a href="cleaning-data.html#cb4-87"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</span>
<span id="cb4-88"><a href="cleaning-data.html#cb4-88"></a>    code <span class="op">==</span><span class="st"> </span><span class="dv">31244</span> <span class="op">~</span><span class="st"> </span>31255L,</span>
<span id="cb4-89"><a href="cleaning-data.html#cb4-89"></a>    code <span class="op">==</span><span class="st"> </span><span class="dv">31269</span> <span class="op">~</span><span class="st"> </span>31263L,</span>
<span id="cb4-90"><a href="cleaning-data.html#cb4-90"></a>    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code),</span>
<span id="cb4-91"><a href="cleaning-data.html#cb4-91"></a>    <span class="dt">table =</span> 3L) <span class="op">%&gt;%</span></span>
<span id="cb4-92"><a href="cleaning-data.html#cb4-92"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb4-93"><a href="cleaning-data.html#cb4-93"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb4-94"><a href="cleaning-data.html#cb4-94"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value_r=</span>value<span class="op">*</span><span class="dv">100</span><span class="op">/</span>cpi) <span class="op">%&gt;%</span></span>
<span id="cb4-95"><a href="cleaning-data.html#cb4-95"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>table, value_r)</span>
<span id="cb4-96"><a href="cleaning-data.html#cb4-96"></a></span>
<span id="cb4-97"><a href="cleaning-data.html#cb4-97"></a></span>
<span id="cb4-98"><a href="cleaning-data.html#cb4-98"></a>U98P3S03 &lt;-<span class="st"> </span>U98P3S03 <span class="op">%&gt;%</span></span>
<span id="cb4-99"><a href="cleaning-data.html#cb4-99"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb4-100"><a href="cleaning-data.html#cb4-100"></a>    <span class="dt">code =</span> DYCOL01,</span>
<span id="cb4-101"><a href="cleaning-data.html#cb4-101"></a>    <span class="dt">purchased =</span> DYCOL02,</span>
<span id="cb4-102"><a href="cleaning-data.html#cb4-102"></a>    <span class="dt">value =</span> DYCOL03) <span class="op">%&gt;%</span></span>
<span id="cb4-103"><a href="cleaning-data.html#cb4-103"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</span>
<span id="cb4-104"><a href="cleaning-data.html#cb4-104"></a>    code <span class="op">==</span><span class="st"> </span><span class="dv">31244</span> <span class="op">~</span><span class="st"> </span>31255L,</span>
<span id="cb4-105"><a href="cleaning-data.html#cb4-105"></a>    code <span class="op">==</span><span class="st"> </span><span class="dv">31269</span> <span class="op">~</span><span class="st"> </span>31263L,</span>
<span id="cb4-106"><a href="cleaning-data.html#cb4-106"></a>    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code),</span>
<span id="cb4-107"><a href="cleaning-data.html#cb4-107"></a>    <span class="dt">table =</span> 3L) <span class="op">%&gt;%</span></span>
<span id="cb4-108"><a href="cleaning-data.html#cb4-108"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb4-109"><a href="cleaning-data.html#cb4-109"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb4-110"><a href="cleaning-data.html#cb4-110"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value_r=</span>value<span class="op">*</span><span class="dv">100</span><span class="op">/</span>cpi) <span class="op">%&gt;%</span></span>
<span id="cb4-111"><a href="cleaning-data.html#cb4-111"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>table, value_r)</span>
<span id="cb4-112"><a href="cleaning-data.html#cb4-112"></a></span>
<span id="cb4-113"><a href="cleaning-data.html#cb4-113"></a></span>
<span id="cb4-114"><a href="cleaning-data.html#cb4-114"></a><span class="co"># Part 3, Table 4</span></span>
<span id="cb4-115"><a href="cleaning-data.html#cb4-115"></a>R98P3S04 &lt;-<span class="st"> </span>R98P3S04 <span class="op">%&gt;%</span></span>
<span id="cb4-116"><a href="cleaning-data.html#cb4-116"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb4-117"><a href="cleaning-data.html#cb4-117"></a>    <span class="dt">code =</span> DYCOL01,</span>
<span id="cb4-118"><a href="cleaning-data.html#cb4-118"></a>    <span class="dt">mortgage =</span> DYCOL02,</span>
<span id="cb4-119"><a href="cleaning-data.html#cb4-119"></a>    <span class="dt">purchased =</span> DYCOL03,</span>
<span id="cb4-120"><a href="cleaning-data.html#cb4-120"></a>    <span class="dt">value =</span> DYCOL04 ) <span class="op">%&gt;%</span></span>
<span id="cb4-121"><a href="cleaning-data.html#cb4-121"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</span>
<span id="cb4-122"><a href="cleaning-data.html#cb4-122"></a>    code <span class="op">==</span><span class="st"> </span><span class="dv">44418</span> <span class="op">~</span><span class="st"> </span>44419L,</span>
<span id="cb4-123"><a href="cleaning-data.html#cb4-123"></a>    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code),</span>
<span id="cb4-124"><a href="cleaning-data.html#cb4-124"></a>    <span class="dt">table =</span> 4L) <span class="op">%&gt;%</span></span>
<span id="cb4-125"><a href="cleaning-data.html#cb4-125"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb4-126"><a href="cleaning-data.html#cb4-126"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb4-127"><a href="cleaning-data.html#cb4-127"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value_r=</span>value<span class="op">*</span><span class="dv">100</span><span class="op">/</span>cpi) <span class="op">%&gt;%</span></span>
<span id="cb4-128"><a href="cleaning-data.html#cb4-128"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>table, value_r)</span>
<span id="cb4-129"><a href="cleaning-data.html#cb4-129"></a></span>
<span id="cb4-130"><a href="cleaning-data.html#cb4-130"></a></span>
<span id="cb4-131"><a href="cleaning-data.html#cb4-131"></a>U98P3S04 &lt;-<span class="st"> </span>U98P3S04 <span class="op">%&gt;%</span></span>
<span id="cb4-132"><a href="cleaning-data.html#cb4-132"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb4-133"><a href="cleaning-data.html#cb4-133"></a>    <span class="dt">code =</span> DYCOL01,</span>
<span id="cb4-134"><a href="cleaning-data.html#cb4-134"></a>    <span class="dt">mortgage =</span> DYCOL02,</span>
<span id="cb4-135"><a href="cleaning-data.html#cb4-135"></a>    <span class="dt">purchased =</span> DYCOL03,</span>
<span id="cb4-136"><a href="cleaning-data.html#cb4-136"></a>    <span class="dt">value =</span> DYCOL04 ) <span class="op">%&gt;%</span></span>
<span id="cb4-137"><a href="cleaning-data.html#cb4-137"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</span>
<span id="cb4-138"><a href="cleaning-data.html#cb4-138"></a>    code <span class="op">==</span><span class="st"> </span><span class="dv">44418</span> <span class="op">~</span><span class="st"> </span>44419L,</span>
<span id="cb4-139"><a href="cleaning-data.html#cb4-139"></a>    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code),</span>
<span id="cb4-140"><a href="cleaning-data.html#cb4-140"></a>    <span class="dt">table =</span> 4L)  <span class="op">%&gt;%</span></span>
<span id="cb4-141"><a href="cleaning-data.html#cb4-141"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb4-142"><a href="cleaning-data.html#cb4-142"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb4-143"><a href="cleaning-data.html#cb4-143"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value_r=</span>value<span class="op">*</span><span class="dv">100</span><span class="op">/</span>cpi) <span class="op">%&gt;%</span></span>
<span id="cb4-144"><a href="cleaning-data.html#cb4-144"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>table, value_r)</span>
<span id="cb4-145"><a href="cleaning-data.html#cb4-145"></a></span>
<span id="cb4-146"><a href="cleaning-data.html#cb4-146"></a><span class="co"># Part 3, Table 5</span></span>
<span id="cb4-147"><a href="cleaning-data.html#cb4-147"></a>R98P3S05 &lt;-<span class="st"> </span>R98P3S05 <span class="op">%&gt;%</span></span>
<span id="cb4-148"><a href="cleaning-data.html#cb4-148"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb4-149"><a href="cleaning-data.html#cb4-149"></a>    <span class="dt">code =</span> DYCOL01,</span>
<span id="cb4-150"><a href="cleaning-data.html#cb4-150"></a>    <span class="dt">purchased =</span> DYCOL02,</span>
<span id="cb4-151"><a href="cleaning-data.html#cb4-151"></a>    <span class="dt">value =</span> DYCOL03 ) <span class="op">%&gt;%</span></span>
<span id="cb4-152"><a href="cleaning-data.html#cb4-152"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</span>
<span id="cb4-153"><a href="cleaning-data.html#cb4-153"></a>         <span class="dt">table =</span> 5L) <span class="op">%&gt;%</span></span>
<span id="cb4-154"><a href="cleaning-data.html#cb4-154"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb4-155"><a href="cleaning-data.html#cb4-155"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb4-156"><a href="cleaning-data.html#cb4-156"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value_r=</span>value<span class="op">*</span><span class="dv">100</span><span class="op">/</span>cpi) <span class="op">%&gt;%</span></span>
<span id="cb4-157"><a href="cleaning-data.html#cb4-157"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>table, value_r)</span>
<span id="cb4-158"><a href="cleaning-data.html#cb4-158"></a></span>
<span id="cb4-159"><a href="cleaning-data.html#cb4-159"></a></span>
<span id="cb4-160"><a href="cleaning-data.html#cb4-160"></a>U98P3S05 &lt;-<span class="st"> </span>U98P3S05 <span class="op">%&gt;%</span></span>
<span id="cb4-161"><a href="cleaning-data.html#cb4-161"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb4-162"><a href="cleaning-data.html#cb4-162"></a>    <span class="dt">code =</span> DYCOL01,</span>
<span id="cb4-163"><a href="cleaning-data.html#cb4-163"></a>    <span class="dt">purchased =</span> DYCOL02,</span>
<span id="cb4-164"><a href="cleaning-data.html#cb4-164"></a>    <span class="dt">value =</span> DYCOL03 ) <span class="op">%&gt;%</span></span>
<span id="cb4-165"><a href="cleaning-data.html#cb4-165"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</span>
<span id="cb4-166"><a href="cleaning-data.html#cb4-166"></a>         <span class="dt">table =</span> 5L) <span class="op">%&gt;%</span></span>
<span id="cb4-167"><a href="cleaning-data.html#cb4-167"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb4-168"><a href="cleaning-data.html#cb4-168"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb4-169"><a href="cleaning-data.html#cb4-169"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value_r=</span>value<span class="op">*</span><span class="dv">100</span><span class="op">/</span>cpi) <span class="op">%&gt;%</span></span>
<span id="cb4-170"><a href="cleaning-data.html#cb4-170"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>table, value_r)</span>
<span id="cb4-171"><a href="cleaning-data.html#cb4-171"></a></span>
<span id="cb4-172"><a href="cleaning-data.html#cb4-172"></a></span>
<span id="cb4-173"><a href="cleaning-data.html#cb4-173"></a></span>
<span id="cb4-174"><a href="cleaning-data.html#cb4-174"></a><span class="co"># Part 3, Table 6</span></span>
<span id="cb4-175"><a href="cleaning-data.html#cb4-175"></a>R98P3S06 &lt;-<span class="st"> </span>R98P3S06  <span class="op">%&gt;%</span></span>
<span id="cb4-176"><a href="cleaning-data.html#cb4-176"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb4-177"><a href="cleaning-data.html#cb4-177"></a>    <span class="dt">code =</span> DYCOL01,</span>
<span id="cb4-178"><a href="cleaning-data.html#cb4-178"></a>    <span class="dt">purchased =</span> DYCOL02,</span>
<span id="cb4-179"><a href="cleaning-data.html#cb4-179"></a>    <span class="dt">value =</span> DYCOL03) <span class="op">%&gt;%</span></span>
<span id="cb4-180"><a href="cleaning-data.html#cb4-180"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</span>
<span id="cb4-181"><a href="cleaning-data.html#cb4-181"></a>    code <span class="op">==</span><span class="st"> </span><span class="dv">62128</span> <span class="op">~</span><span class="st"> </span>62125L,</span>
<span id="cb4-182"><a href="cleaning-data.html#cb4-182"></a>    code <span class="op">==</span><span class="st"> </span><span class="dv">62129</span> <span class="op">~</span><span class="st"> </span>62126L,</span>
<span id="cb4-183"><a href="cleaning-data.html#cb4-183"></a>    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code),</span>
<span id="cb4-184"><a href="cleaning-data.html#cb4-184"></a>    <span class="dt">table =</span> 6L) <span class="op">%&gt;%</span></span>
<span id="cb4-185"><a href="cleaning-data.html#cb4-185"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb4-186"><a href="cleaning-data.html#cb4-186"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb4-187"><a href="cleaning-data.html#cb4-187"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value_r=</span>value<span class="op">*</span><span class="dv">100</span><span class="op">/</span>cpi) <span class="op">%&gt;%</span></span>
<span id="cb4-188"><a href="cleaning-data.html#cb4-188"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>table, value_r)</span>
<span id="cb4-189"><a href="cleaning-data.html#cb4-189"></a></span>
<span id="cb4-190"><a href="cleaning-data.html#cb4-190"></a></span>
<span id="cb4-191"><a href="cleaning-data.html#cb4-191"></a>U98P3S06 &lt;-<span class="st"> </span>U98P3S06 <span class="op">%&gt;%</span></span>
<span id="cb4-192"><a href="cleaning-data.html#cb4-192"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb4-193"><a href="cleaning-data.html#cb4-193"></a>    <span class="dt">code =</span> DYCOL01,</span>
<span id="cb4-194"><a href="cleaning-data.html#cb4-194"></a>    <span class="dt">purchased =</span> DYCOL02,</span>
<span id="cb4-195"><a href="cleaning-data.html#cb4-195"></a>    <span class="dt">value =</span> DYCOL03) <span class="op">%&gt;%</span></span>
<span id="cb4-196"><a href="cleaning-data.html#cb4-196"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</span>
<span id="cb4-197"><a href="cleaning-data.html#cb4-197"></a>    code <span class="op">==</span><span class="st"> </span><span class="dv">62128</span> <span class="op">~</span><span class="st"> </span>62125L,</span>
<span id="cb4-198"><a href="cleaning-data.html#cb4-198"></a>    code <span class="op">==</span><span class="st"> </span><span class="dv">62129</span> <span class="op">~</span><span class="st"> </span>62126L,</span>
<span id="cb4-199"><a href="cleaning-data.html#cb4-199"></a>    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code),</span>
<span id="cb4-200"><a href="cleaning-data.html#cb4-200"></a>    <span class="dt">table =</span> 6L) <span class="op">%&gt;%</span></span>
<span id="cb4-201"><a href="cleaning-data.html#cb4-201"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb4-202"><a href="cleaning-data.html#cb4-202"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb4-203"><a href="cleaning-data.html#cb4-203"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value_r=</span>value<span class="op">*</span><span class="dv">100</span><span class="op">/</span>cpi) <span class="op">%&gt;%</span></span>
<span id="cb4-204"><a href="cleaning-data.html#cb4-204"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>table, value_r)</span>
<span id="cb4-205"><a href="cleaning-data.html#cb4-205"></a></span>
<span id="cb4-206"><a href="cleaning-data.html#cb4-206"></a></span>
<span id="cb4-207"><a href="cleaning-data.html#cb4-207"></a><span class="co"># Part 3, Table 7</span></span>
<span id="cb4-208"><a href="cleaning-data.html#cb4-208"></a>R98P3S07 &lt;-<span class="st"> </span>R98P3S07 <span class="op">%&gt;%</span></span>
<span id="cb4-209"><a href="cleaning-data.html#cb4-209"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb4-210"><a href="cleaning-data.html#cb4-210"></a>    <span class="dt">code =</span> DYCOL01,</span>
<span id="cb4-211"><a href="cleaning-data.html#cb4-211"></a>    <span class="dt">purchased =</span> DYCOL02,</span>
<span id="cb4-212"><a href="cleaning-data.html#cb4-212"></a>    <span class="dt">value =</span> DYCOL03) <span class="op">%&gt;%</span></span>
<span id="cb4-213"><a href="cleaning-data.html#cb4-213"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</span>
<span id="cb4-214"><a href="cleaning-data.html#cb4-214"></a>    code <span class="op">==</span><span class="st"> </span><span class="dv">73611</span> <span class="op">~</span><span class="st"> </span>73615L,</span>
<span id="cb4-215"><a href="cleaning-data.html#cb4-215"></a>    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code),</span>
<span id="cb4-216"><a href="cleaning-data.html#cb4-216"></a>    <span class="dt">table =</span> 7L) <span class="op">%&gt;%</span></span>
<span id="cb4-217"><a href="cleaning-data.html#cb4-217"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb4-218"><a href="cleaning-data.html#cb4-218"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb4-219"><a href="cleaning-data.html#cb4-219"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value_r=</span>value<span class="op">*</span><span class="dv">100</span><span class="op">/</span>cpi) <span class="op">%&gt;%</span></span>
<span id="cb4-220"><a href="cleaning-data.html#cb4-220"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>table, value_r)</span>
<span id="cb4-221"><a href="cleaning-data.html#cb4-221"></a></span>
<span id="cb4-222"><a href="cleaning-data.html#cb4-222"></a></span>
<span id="cb4-223"><a href="cleaning-data.html#cb4-223"></a>U98P3S07 &lt;-<span class="st"> </span>U98P3S07 <span class="op">%&gt;%</span></span>
<span id="cb4-224"><a href="cleaning-data.html#cb4-224"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb4-225"><a href="cleaning-data.html#cb4-225"></a>    <span class="dt">code =</span> DYCOL01,</span>
<span id="cb4-226"><a href="cleaning-data.html#cb4-226"></a>    <span class="dt">purchased =</span> DYCOL02,</span>
<span id="cb4-227"><a href="cleaning-data.html#cb4-227"></a>    <span class="dt">value =</span> DYCOL03 ) <span class="op">%&gt;%</span></span>
<span id="cb4-228"><a href="cleaning-data.html#cb4-228"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</span>
<span id="cb4-229"><a href="cleaning-data.html#cb4-229"></a>    code <span class="op">==</span><span class="st"> </span><span class="dv">73611</span> <span class="op">~</span><span class="st"> </span>73615L,</span>
<span id="cb4-230"><a href="cleaning-data.html#cb4-230"></a>    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code),</span>
<span id="cb4-231"><a href="cleaning-data.html#cb4-231"></a>    <span class="dt">table =</span> 7L) <span class="op">%&gt;%</span></span>
<span id="cb4-232"><a href="cleaning-data.html#cb4-232"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb4-233"><a href="cleaning-data.html#cb4-233"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb4-234"><a href="cleaning-data.html#cb4-234"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value_r=</span>value<span class="op">*</span><span class="dv">100</span><span class="op">/</span>cpi) <span class="op">%&gt;%</span></span>
<span id="cb4-235"><a href="cleaning-data.html#cb4-235"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>table, value_r)</span>
<span id="cb4-236"><a href="cleaning-data.html#cb4-236"></a></span>
<span id="cb4-237"><a href="cleaning-data.html#cb4-237"></a></span>
<span id="cb4-238"><a href="cleaning-data.html#cb4-238"></a><span class="co"># Part 3, Table 8</span></span>
<span id="cb4-239"><a href="cleaning-data.html#cb4-239"></a>R98P3S08 &lt;-<span class="st"> </span>R98P3S08 <span class="op">%&gt;%</span></span>
<span id="cb4-240"><a href="cleaning-data.html#cb4-240"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb4-241"><a href="cleaning-data.html#cb4-241"></a>    <span class="dt">code =</span> DYCOL01,</span>
<span id="cb4-242"><a href="cleaning-data.html#cb4-242"></a>    <span class="dt">purchased =</span> DYCOL02,</span>
<span id="cb4-243"><a href="cleaning-data.html#cb4-243"></a>    <span class="dt">value =</span> DYCOL03) <span class="op">%&gt;%</span></span>
<span id="cb4-244"><a href="cleaning-data.html#cb4-244"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</span>
<span id="cb4-245"><a href="cleaning-data.html#cb4-245"></a>         <span class="dt">table =</span> 8L) <span class="op">%&gt;%</span></span>
<span id="cb4-246"><a href="cleaning-data.html#cb4-246"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb4-247"><a href="cleaning-data.html#cb4-247"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb4-248"><a href="cleaning-data.html#cb4-248"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value_r=</span>value<span class="op">*</span><span class="dv">100</span><span class="op">/</span>cpi) <span class="op">%&gt;%</span></span>
<span id="cb4-249"><a href="cleaning-data.html#cb4-249"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>table, value_r)</span>
<span id="cb4-250"><a href="cleaning-data.html#cb4-250"></a></span>
<span id="cb4-251"><a href="cleaning-data.html#cb4-251"></a></span>
<span id="cb4-252"><a href="cleaning-data.html#cb4-252"></a>U98P3S08 &lt;-<span class="st"> </span>U98P3S08 <span class="op">%&gt;%</span></span>
<span id="cb4-253"><a href="cleaning-data.html#cb4-253"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb4-254"><a href="cleaning-data.html#cb4-254"></a>    <span class="dt">code =</span> DYCOL01,</span>
<span id="cb4-255"><a href="cleaning-data.html#cb4-255"></a>    <span class="dt">purchased =</span> DYCOL02,</span>
<span id="cb4-256"><a href="cleaning-data.html#cb4-256"></a>    <span class="dt">value =</span> DYCOL03) <span class="op">%&gt;%</span></span>
<span id="cb4-257"><a href="cleaning-data.html#cb4-257"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</span>
<span id="cb4-258"><a href="cleaning-data.html#cb4-258"></a>         <span class="dt">table =</span> 8L) <span class="op">%&gt;%</span></span>
<span id="cb4-259"><a href="cleaning-data.html#cb4-259"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb4-260"><a href="cleaning-data.html#cb4-260"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb4-261"><a href="cleaning-data.html#cb4-261"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value_r=</span>value<span class="op">*</span><span class="dv">100</span><span class="op">/</span>cpi) <span class="op">%&gt;%</span></span>
<span id="cb4-262"><a href="cleaning-data.html#cb4-262"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>table, value_r)</span>
<span id="cb4-263"><a href="cleaning-data.html#cb4-263"></a></span>
<span id="cb4-264"><a href="cleaning-data.html#cb4-264"></a></span>
<span id="cb4-265"><a href="cleaning-data.html#cb4-265"></a><span class="co"># Part 3, Table 9</span></span>
<span id="cb4-266"><a href="cleaning-data.html#cb4-266"></a>R98P3S09 &lt;-<span class="st"> </span>R98P3S09 <span class="op">%&gt;%</span></span>
<span id="cb4-267"><a href="cleaning-data.html#cb4-267"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb4-268"><a href="cleaning-data.html#cb4-268"></a>    <span class="dt">code =</span> DYCOL01,</span>
<span id="cb4-269"><a href="cleaning-data.html#cb4-269"></a>    <span class="dt">purchased =</span> DYCOL02,</span>
<span id="cb4-270"><a href="cleaning-data.html#cb4-270"></a>    <span class="dt">value =</span> DYCOL03) <span class="op">%&gt;%</span></span>
<span id="cb4-271"><a href="cleaning-data.html#cb4-271"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</span>
<span id="cb4-272"><a href="cleaning-data.html#cb4-272"></a>         <span class="dt">table =</span> 9L) <span class="op">%&gt;%</span></span>
<span id="cb4-273"><a href="cleaning-data.html#cb4-273"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb4-274"><a href="cleaning-data.html#cb4-274"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb4-275"><a href="cleaning-data.html#cb4-275"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value_r=</span>value<span class="op">*</span><span class="dv">100</span><span class="op">/</span>cpi) <span class="op">%&gt;%</span></span>
<span id="cb4-276"><a href="cleaning-data.html#cb4-276"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>table, value_r)</span>
<span id="cb4-277"><a href="cleaning-data.html#cb4-277"></a></span>
<span id="cb4-278"><a href="cleaning-data.html#cb4-278"></a></span>
<span id="cb4-279"><a href="cleaning-data.html#cb4-279"></a>U98P3S09 &lt;-<span class="st"> </span>U98P3S09 <span class="op">%&gt;%</span></span>
<span id="cb4-280"><a href="cleaning-data.html#cb4-280"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb4-281"><a href="cleaning-data.html#cb4-281"></a>    <span class="dt">code =</span> DYCOL01,</span>
<span id="cb4-282"><a href="cleaning-data.html#cb4-282"></a>    <span class="dt">purchased =</span> DYCOL02,</span>
<span id="cb4-283"><a href="cleaning-data.html#cb4-283"></a>    <span class="dt">value =</span> DYCOL03) <span class="op">%&gt;%</span></span>
<span id="cb4-284"><a href="cleaning-data.html#cb4-284"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</span>
<span id="cb4-285"><a href="cleaning-data.html#cb4-285"></a>         <span class="dt">table =</span> 9L) <span class="op">%&gt;%</span></span>
<span id="cb4-286"><a href="cleaning-data.html#cb4-286"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb4-287"><a href="cleaning-data.html#cb4-287"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb4-288"><a href="cleaning-data.html#cb4-288"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value_r=</span>value<span class="op">*</span><span class="dv">100</span><span class="op">/</span>cpi) <span class="op">%&gt;%</span></span>
<span id="cb4-289"><a href="cleaning-data.html#cb4-289"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>table, value_r)</span>
<span id="cb4-290"><a href="cleaning-data.html#cb4-290"></a></span>
<span id="cb4-291"><a href="cleaning-data.html#cb4-291"></a></span>
<span id="cb4-292"><a href="cleaning-data.html#cb4-292"></a><span class="co"># Part 3, Table 10</span></span>
<span id="cb4-293"><a href="cleaning-data.html#cb4-293"></a>R98P3S10 &lt;-<span class="st"> </span>R98P3S10 <span class="op">%&gt;%</span></span>
<span id="cb4-294"><a href="cleaning-data.html#cb4-294"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb4-295"><a href="cleaning-data.html#cb4-295"></a>    <span class="dt">code =</span> DYCOL01,</span>
<span id="cb4-296"><a href="cleaning-data.html#cb4-296"></a>    <span class="dt">purchased =</span> DYCOL02,</span>
<span id="cb4-297"><a href="cleaning-data.html#cb4-297"></a>    <span class="dt">value =</span> DYCOL03) <span class="op">%&gt;%</span></span>
<span id="cb4-298"><a href="cleaning-data.html#cb4-298"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</span>
<span id="cb4-299"><a href="cleaning-data.html#cb4-299"></a>         <span class="dt">table =</span> 10L) </span>
<span id="cb4-300"><a href="cleaning-data.html#cb4-300"></a></span>
<span id="cb4-301"><a href="cleaning-data.html#cb4-301"></a>U98P3S10 &lt;-<span class="st"> </span>U98P3S10 <span class="op">%&gt;%</span></span>
<span id="cb4-302"><a href="cleaning-data.html#cb4-302"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb4-303"><a href="cleaning-data.html#cb4-303"></a>    <span class="dt">code =</span> DYCOL01,</span>
<span id="cb4-304"><a href="cleaning-data.html#cb4-304"></a>    <span class="dt">purchased =</span> DYCOL02,</span>
<span id="cb4-305"><a href="cleaning-data.html#cb4-305"></a>    <span class="dt">value =</span> DYCOL03) <span class="op">%&gt;%</span></span>
<span id="cb4-306"><a href="cleaning-data.html#cb4-306"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</span>
<span id="cb4-307"><a href="cleaning-data.html#cb4-307"></a>         <span class="dt">table =</span> 10L) </span>
<span id="cb4-308"><a href="cleaning-data.html#cb4-308"></a></span>
<span id="cb4-309"><a href="cleaning-data.html#cb4-309"></a><span class="co"># Part 3, Table 11</span></span>
<span id="cb4-310"><a href="cleaning-data.html#cb4-310"></a></span>
<span id="cb4-311"><a href="cleaning-data.html#cb4-311"></a>R98P3S11 &lt;-<span class="st"> </span>R98P3S11 <span class="op">%&gt;%</span></span>
<span id="cb4-312"><a href="cleaning-data.html#cb4-312"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb4-313"><a href="cleaning-data.html#cb4-313"></a>    <span class="dt">code =</span> DYCOL01,</span>
<span id="cb4-314"><a href="cleaning-data.html#cb4-314"></a>    <span class="dt">purchased =</span> DYCOL02,</span>
<span id="cb4-315"><a href="cleaning-data.html#cb4-315"></a>    <span class="dt">value =</span> DYCOL03) <span class="op">%&gt;%</span></span>
<span id="cb4-316"><a href="cleaning-data.html#cb4-316"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</span>
<span id="cb4-317"><a href="cleaning-data.html#cb4-317"></a>         <span class="dt">table =</span> 11L) <span class="op">%&gt;%</span></span>
<span id="cb4-318"><a href="cleaning-data.html#cb4-318"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb4-319"><a href="cleaning-data.html#cb4-319"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb4-320"><a href="cleaning-data.html#cb4-320"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value_r=</span>value<span class="op">*</span><span class="dv">100</span><span class="op">/</span>cpi) <span class="op">%&gt;%</span></span>
<span id="cb4-321"><a href="cleaning-data.html#cb4-321"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>table, value_r)</span>
<span id="cb4-322"><a href="cleaning-data.html#cb4-322"></a></span>
<span id="cb4-323"><a href="cleaning-data.html#cb4-323"></a></span>
<span id="cb4-324"><a href="cleaning-data.html#cb4-324"></a>U98P3S11 &lt;-<span class="st"> </span>U98P3S11 <span class="op">%&gt;%</span></span>
<span id="cb4-325"><a href="cleaning-data.html#cb4-325"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb4-326"><a href="cleaning-data.html#cb4-326"></a>    <span class="dt">code =</span> DYCOL01,</span>
<span id="cb4-327"><a href="cleaning-data.html#cb4-327"></a>    <span class="dt">purchased =</span> DYCOL02,</span>
<span id="cb4-328"><a href="cleaning-data.html#cb4-328"></a>    <span class="dt">value =</span> DYCOL03) <span class="op">%&gt;%</span></span>
<span id="cb4-329"><a href="cleaning-data.html#cb4-329"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</span>
<span id="cb4-330"><a href="cleaning-data.html#cb4-330"></a>         <span class="dt">table =</span> 11L) <span class="op">%&gt;%</span></span>
<span id="cb4-331"><a href="cleaning-data.html#cb4-331"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb4-332"><a href="cleaning-data.html#cb4-332"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb4-333"><a href="cleaning-data.html#cb4-333"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value_r=</span>value<span class="op">*</span><span class="dv">100</span><span class="op">/</span>cpi) <span class="op">%&gt;%</span></span>
<span id="cb4-334"><a href="cleaning-data.html#cb4-334"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>table, value_r)</span>
<span id="cb4-335"><a href="cleaning-data.html#cb4-335"></a></span>
<span id="cb4-336"><a href="cleaning-data.html#cb4-336"></a></span>
<span id="cb4-337"><a href="cleaning-data.html#cb4-337"></a><span class="co"># Part 3, Table 12</span></span>
<span id="cb4-338"><a href="cleaning-data.html#cb4-338"></a>R98P3S12 &lt;-<span class="st"> </span>R98P3S12 <span class="op">%&gt;%</span></span>
<span id="cb4-339"><a href="cleaning-data.html#cb4-339"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb4-340"><a href="cleaning-data.html#cb4-340"></a>    <span class="dt">code =</span> DYCOL01,</span>
<span id="cb4-341"><a href="cleaning-data.html#cb4-341"></a>    <span class="dt">purchased =</span> DYCOL02,</span>
<span id="cb4-342"><a href="cleaning-data.html#cb4-342"></a>    <span class="dt">value =</span> DYCOL03) <span class="op">%&gt;%</span></span>
<span id="cb4-343"><a href="cleaning-data.html#cb4-343"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</span>
<span id="cb4-344"><a href="cleaning-data.html#cb4-344"></a>         <span class="dt">table =</span> 12L) <span class="op">%&gt;%</span></span>
<span id="cb4-345"><a href="cleaning-data.html#cb4-345"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb4-346"><a href="cleaning-data.html#cb4-346"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb4-347"><a href="cleaning-data.html#cb4-347"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value_r=</span>value<span class="op">*</span><span class="dv">100</span><span class="op">/</span>cpi) <span class="op">%&gt;%</span></span>
<span id="cb4-348"><a href="cleaning-data.html#cb4-348"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>table, value_r)</span>
<span id="cb4-349"><a href="cleaning-data.html#cb4-349"></a></span>
<span id="cb4-350"><a href="cleaning-data.html#cb4-350"></a></span>
<span id="cb4-351"><a href="cleaning-data.html#cb4-351"></a>U98P3S12 &lt;-<span class="st"> </span>U98P3S12 <span class="op">%&gt;%</span></span>
<span id="cb4-352"><a href="cleaning-data.html#cb4-352"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb4-353"><a href="cleaning-data.html#cb4-353"></a>    <span class="dt">code =</span> DYCOL01,</span>
<span id="cb4-354"><a href="cleaning-data.html#cb4-354"></a>    <span class="dt">purchased =</span> DYCOL02,</span>
<span id="cb4-355"><a href="cleaning-data.html#cb4-355"></a>    <span class="dt">value =</span> DYCOL03) <span class="op">%&gt;%</span></span>
<span id="cb4-356"><a href="cleaning-data.html#cb4-356"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</span>
<span id="cb4-357"><a href="cleaning-data.html#cb4-357"></a>         <span class="dt">table =</span> 12L) <span class="op">%&gt;%</span></span>
<span id="cb4-358"><a href="cleaning-data.html#cb4-358"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb4-359"><a href="cleaning-data.html#cb4-359"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb4-360"><a href="cleaning-data.html#cb4-360"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value_r=</span>value<span class="op">*</span><span class="dv">100</span><span class="op">/</span>cpi) <span class="op">%&gt;%</span></span>
<span id="cb4-361"><a href="cleaning-data.html#cb4-361"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>table, value_r)</span>
<span id="cb4-362"><a href="cleaning-data.html#cb4-362"></a></span>
<span id="cb4-363"><a href="cleaning-data.html#cb4-363"></a></span>
<span id="cb4-364"><a href="cleaning-data.html#cb4-364"></a></span>
<span id="cb4-365"><a href="cleaning-data.html#cb4-365"></a><span class="co"># Part 3, Table 13</span></span>
<span id="cb4-366"><a href="cleaning-data.html#cb4-366"></a>R98P3S13 &lt;-<span class="st"> </span>R98P3S13 <span class="op">%&gt;%</span></span>
<span id="cb4-367"><a href="cleaning-data.html#cb4-367"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb4-368"><a href="cleaning-data.html#cb4-368"></a>    <span class="dt">code =</span> DYCOL01,</span>
<span id="cb4-369"><a href="cleaning-data.html#cb4-369"></a>    <span class="dt">insured_loan =</span> DYCOL02,</span>
<span id="cb4-370"><a href="cleaning-data.html#cb4-370"></a>    <span class="dt">loanfrom =</span> DYCOL03,</span>
<span id="cb4-371"><a href="cleaning-data.html#cb4-371"></a>    <span class="dt">purchased =</span> DYCOL04,</span>
<span id="cb4-372"><a href="cleaning-data.html#cb4-372"></a>    <span class="dt">cost =</span> DYCOL05,</span>
<span id="cb4-373"><a href="cleaning-data.html#cb4-373"></a>    <span class="dt">sell =</span> DYCOL06) <span class="op">%&gt;%</span></span>
<span id="cb4-374"><a href="cleaning-data.html#cb4-374"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</span>
<span id="cb4-375"><a href="cleaning-data.html#cb4-375"></a>    code <span class="op">==</span><span class="st"> </span><span class="dv">51161</span> <span class="op">~</span><span class="st"> </span>51160L,</span>
<span id="cb4-376"><a href="cleaning-data.html#cb4-376"></a>    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code),</span>
<span id="cb4-377"><a href="cleaning-data.html#cb4-377"></a>    <span class="dt">cost =</span> <span class="kw">replace_na</span>(cost,<span class="dv">0</span>),</span>
<span id="cb4-378"><a href="cleaning-data.html#cb4-378"></a>    <span class="dt">sell =</span> <span class="kw">replace_na</span>(sell,<span class="dv">0</span>),</span>
<span id="cb4-379"><a href="cleaning-data.html#cb4-379"></a>    <span class="dt">value =</span> cost <span class="op">-</span><span class="st"> </span>sell,</span>
<span id="cb4-380"><a href="cleaning-data.html#cb4-380"></a>    <span class="dt">table =</span> 13L) <span class="op">%&gt;%</span></span>
<span id="cb4-381"><a href="cleaning-data.html#cb4-381"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb4-382"><a href="cleaning-data.html#cb4-382"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb4-383"><a href="cleaning-data.html#cb4-383"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value_r=</span>value<span class="op">*</span><span class="dv">100</span><span class="op">/</span>cpi_y) <span class="op">%&gt;%</span></span>
<span id="cb4-384"><a href="cleaning-data.html#cb4-384"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>table, value_r)</span>
<span id="cb4-385"><a href="cleaning-data.html#cb4-385"></a></span>
<span id="cb4-386"><a href="cleaning-data.html#cb4-386"></a></span>
<span id="cb4-387"><a href="cleaning-data.html#cb4-387"></a>U98P3S13 &lt;-<span class="st"> </span>U98P3S13 <span class="op">%&gt;%</span></span>
<span id="cb4-388"><a href="cleaning-data.html#cb4-388"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb4-389"><a href="cleaning-data.html#cb4-389"></a>    <span class="dt">code =</span> DYCOL01,</span>
<span id="cb4-390"><a href="cleaning-data.html#cb4-390"></a>    <span class="dt">insured_loan =</span> DYCOL02,</span>
<span id="cb4-391"><a href="cleaning-data.html#cb4-391"></a>    <span class="dt">loanfrom =</span> DYCOL03,</span>
<span id="cb4-392"><a href="cleaning-data.html#cb4-392"></a>    <span class="dt">purchased =</span> DYCOL04,</span>
<span id="cb4-393"><a href="cleaning-data.html#cb4-393"></a>    <span class="dt">cost =</span> DYCOL05,</span>
<span id="cb4-394"><a href="cleaning-data.html#cb4-394"></a>    <span class="dt">sell =</span> DYCOL06) <span class="op">%&gt;%</span></span>
<span id="cb4-395"><a href="cleaning-data.html#cb4-395"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</span>
<span id="cb4-396"><a href="cleaning-data.html#cb4-396"></a>    code <span class="op">==</span><span class="st"> </span><span class="dv">51161</span> <span class="op">~</span><span class="st"> </span>51160L,</span>
<span id="cb4-397"><a href="cleaning-data.html#cb4-397"></a>    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code),</span>
<span id="cb4-398"><a href="cleaning-data.html#cb4-398"></a>    <span class="dt">cost =</span> <span class="kw">replace_na</span>(cost,<span class="dv">0</span>),</span>
<span id="cb4-399"><a href="cleaning-data.html#cb4-399"></a>    <span class="dt">sell =</span> <span class="kw">replace_na</span>(sell,<span class="dv">0</span>),</span>
<span id="cb4-400"><a href="cleaning-data.html#cb4-400"></a>    <span class="dt">value =</span> cost <span class="op">-</span><span class="st"> </span>sell,</span>
<span id="cb4-401"><a href="cleaning-data.html#cb4-401"></a>    <span class="dt">table =</span> 13L) <span class="op">%&gt;%</span></span>
<span id="cb4-402"><a href="cleaning-data.html#cb4-402"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb4-403"><a href="cleaning-data.html#cb4-403"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb4-404"><a href="cleaning-data.html#cb4-404"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value_r=</span>value<span class="op">*</span><span class="dv">100</span><span class="op">/</span>cpi_y) <span class="op">%&gt;%</span></span>
<span id="cb4-405"><a href="cleaning-data.html#cb4-405"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>table, value_r)</span>
<span id="cb4-406"><a href="cleaning-data.html#cb4-406"></a></span>
<span id="cb4-407"><a href="cleaning-data.html#cb4-407"></a><span class="co"># Part 3, Table 14</span></span>
<span id="cb4-408"><a href="cleaning-data.html#cb4-408"></a>R98P3S14 &lt;-<span class="st"> </span>R98P3S14 <span class="op">%&gt;%</span></span>
<span id="cb4-409"><a href="cleaning-data.html#cb4-409"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb4-410"><a href="cleaning-data.html#cb4-410"></a>    <span class="dt">code =</span> DYCOL01,</span>
<span id="cb4-411"><a href="cleaning-data.html#cb4-411"></a>    <span class="dt">purchased =</span> DYCOL02,</span>
<span id="cb4-412"><a href="cleaning-data.html#cb4-412"></a>    <span class="dt">cost =</span> DYCOL03,</span>
<span id="cb4-413"><a href="cleaning-data.html#cb4-413"></a>    <span class="dt">sell =</span> DYCOL04) <span class="op">%&gt;%</span></span>
<span id="cb4-414"><a href="cleaning-data.html#cb4-414"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</span>
<span id="cb4-415"><a href="cleaning-data.html#cb4-415"></a>         <span class="dt">cost =</span> <span class="kw">replace_na</span>(cost,<span class="dv">0</span>),</span>
<span id="cb4-416"><a href="cleaning-data.html#cb4-416"></a>         <span class="dt">sell =</span> <span class="kw">replace_na</span>(sell,<span class="dv">0</span>),</span>
<span id="cb4-417"><a href="cleaning-data.html#cb4-417"></a>         <span class="dt">value =</span> cost <span class="op">-</span><span class="st"> </span>sell,</span>
<span id="cb4-418"><a href="cleaning-data.html#cb4-418"></a>         <span class="dt">table =</span> 14L) <span class="op">%&gt;%</span></span>
<span id="cb4-419"><a href="cleaning-data.html#cb4-419"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb4-420"><a href="cleaning-data.html#cb4-420"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb4-421"><a href="cleaning-data.html#cb4-421"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value_r=</span>value<span class="op">*</span><span class="dv">100</span><span class="op">/</span>cpi_y) <span class="op">%&gt;%</span></span>
<span id="cb4-422"><a href="cleaning-data.html#cb4-422"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>table, value_r)</span>
<span id="cb4-423"><a href="cleaning-data.html#cb4-423"></a></span>
<span id="cb4-424"><a href="cleaning-data.html#cb4-424"></a>U98P3S14 &lt;-<span class="st"> </span>U98P3S14 <span class="op">%&gt;%</span></span>
<span id="cb4-425"><a href="cleaning-data.html#cb4-425"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb4-426"><a href="cleaning-data.html#cb4-426"></a>    <span class="dt">code =</span> DYCOL01,</span>
<span id="cb4-427"><a href="cleaning-data.html#cb4-427"></a>    <span class="dt">purchased =</span> DYCOL02,</span>
<span id="cb4-428"><a href="cleaning-data.html#cb4-428"></a>    <span class="dt">cost =</span> DYCOL03,</span>
<span id="cb4-429"><a href="cleaning-data.html#cb4-429"></a>    <span class="dt">sell =</span> DYCOL04) <span class="op">%&gt;%</span></span>
<span id="cb4-430"><a href="cleaning-data.html#cb4-430"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</span>
<span id="cb4-431"><a href="cleaning-data.html#cb4-431"></a>         <span class="dt">cost =</span> <span class="kw">replace_na</span>(cost,<span class="dv">0</span>),</span>
<span id="cb4-432"><a href="cleaning-data.html#cb4-432"></a>         <span class="dt">sell =</span> <span class="kw">replace_na</span>(sell,<span class="dv">0</span>),</span>
<span id="cb4-433"><a href="cleaning-data.html#cb4-433"></a>         <span class="dt">value =</span> cost <span class="op">-</span><span class="st"> </span>sell,</span>
<span id="cb4-434"><a href="cleaning-data.html#cb4-434"></a>         <span class="dt">table =</span> 14L) <span class="op">%&gt;%</span></span>
<span id="cb4-435"><a href="cleaning-data.html#cb4-435"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb4-436"><a href="cleaning-data.html#cb4-436"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb4-437"><a href="cleaning-data.html#cb4-437"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value_r=</span>value<span class="op">*</span><span class="dv">100</span><span class="op">/</span>cpi_y) <span class="op">%&gt;%</span></span>
<span id="cb4-438"><a href="cleaning-data.html#cb4-438"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>table, value_r)</span></code></pre></div>
</div>
</div>
<div id="cleaning-part-4" class="section level2">
<h2><span class="header-section-number">4.5</span> Cleaning Part 4</h2>
<p>For income tables, we first rename the variables each year to get unique names. We then merge each table with the CPI of each month (1390=1) and with the yearly average of CPI ending in the month of the survey. We use these indices for the price adjustment based on the recalled period of each income item. Finally, we remove unnecessary objects and save the image of all data frames with harmonized names and codes as <em>HEIS98.Rdata</em>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="cleaning-data.html#cb5-1"></a><span class="co">##############################</span></span>
<span id="cb5-2"><a href="cleaning-data.html#cb5-2"></a><span class="co"># Part 4, Table 1</span></span>
<span id="cb5-3"><a href="cleaning-data.html#cb5-3"></a>R98P4S01 &lt;-<span class="st"> </span>R98P4S01 <span class="op">%&gt;%</span></span>
<span id="cb5-4"><a href="cleaning-data.html#cb5-4"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb5-5"><a href="cleaning-data.html#cb5-5"></a>    <span class="dt">member =</span> DYCOL01,</span>
<span id="cb5-6"><a href="cleaning-data.html#cb5-6"></a>    <span class="dt">employed_w =</span> DYCOL02,</span>
<span id="cb5-7"><a href="cleaning-data.html#cb5-7"></a>    <span class="dt">ISCO_w =</span> DYCOL03,</span>
<span id="cb5-8"><a href="cleaning-data.html#cb5-8"></a>    <span class="dt">ISIC_w =</span> DYCOL04,</span>
<span id="cb5-9"><a href="cleaning-data.html#cb5-9"></a>    <span class="dt">status_w =</span> DYCOL05,</span>
<span id="cb5-10"><a href="cleaning-data.html#cb5-10"></a>    <span class="dt">hours_w =</span> DYCOL06,</span>
<span id="cb5-11"><a href="cleaning-data.html#cb5-11"></a>    <span class="dt">days_w =</span> DYCOL07,</span>
<span id="cb5-12"><a href="cleaning-data.html#cb5-12"></a>    <span class="dt">income_w_m =</span> DYCOL08,</span>
<span id="cb5-13"><a href="cleaning-data.html#cb5-13"></a>    <span class="dt">income_w_y =</span> DYCOL09,</span>
<span id="cb5-14"><a href="cleaning-data.html#cb5-14"></a>    <span class="dt">wage_w_m =</span> DYCOL10,</span>
<span id="cb5-15"><a href="cleaning-data.html#cb5-15"></a>    <span class="dt">wage_w_y =</span> DYCOL11,</span>
<span id="cb5-16"><a href="cleaning-data.html#cb5-16"></a>    <span class="dt">perk_w_m =</span> DYCOL12,</span>
<span id="cb5-17"><a href="cleaning-data.html#cb5-17"></a>    <span class="dt">perk_w_y =</span> DYCOL13,</span>
<span id="cb5-18"><a href="cleaning-data.html#cb5-18"></a>    <span class="dt">netincome_w_m =</span> DYCOL14,</span>
<span id="cb5-19"><a href="cleaning-data.html#cb5-19"></a>    <span class="dt">netincome_w_y =</span> DYCOL15) <span class="op">%&gt;%</span></span>
<span id="cb5-20"><a href="cleaning-data.html#cb5-20"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb5-21"><a href="cleaning-data.html#cb5-21"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00=</span> <span class="ot">NA_integer_</span>) <span class="op">%&gt;%</span></span>
<span id="cb5-22"><a href="cleaning-data.html#cb5-22"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb5-23"><a href="cleaning-data.html#cb5-23"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>netincome_w_y, <span class="dt">cpi_m =</span> cpi, cpi_y)</span>
<span id="cb5-24"><a href="cleaning-data.html#cb5-24"></a> </span>
<span id="cb5-25"><a href="cleaning-data.html#cb5-25"></a>U98P4S01 &lt;-<span class="st"> </span>U98P4S01 <span class="op">%&gt;%</span></span>
<span id="cb5-26"><a href="cleaning-data.html#cb5-26"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb5-27"><a href="cleaning-data.html#cb5-27"></a>    <span class="dt">member =</span> DYCOL01,</span>
<span id="cb5-28"><a href="cleaning-data.html#cb5-28"></a>    <span class="dt">employed_w =</span> DYCOL02,</span>
<span id="cb5-29"><a href="cleaning-data.html#cb5-29"></a>    <span class="dt">ISCO_w =</span> DYCOL03,</span>
<span id="cb5-30"><a href="cleaning-data.html#cb5-30"></a>    <span class="dt">ISIC_w =</span> DYCOL04,</span>
<span id="cb5-31"><a href="cleaning-data.html#cb5-31"></a>    <span class="dt">status_w =</span> DYCOL05,</span>
<span id="cb5-32"><a href="cleaning-data.html#cb5-32"></a>    <span class="dt">hours_w =</span> DYCOL06,</span>
<span id="cb5-33"><a href="cleaning-data.html#cb5-33"></a>    <span class="dt">days_w =</span> DYCOL07,</span>
<span id="cb5-34"><a href="cleaning-data.html#cb5-34"></a>    <span class="dt">income_w_m =</span> DYCOL08,</span>
<span id="cb5-35"><a href="cleaning-data.html#cb5-35"></a>    <span class="dt">income_w_y =</span> DYCOL09,</span>
<span id="cb5-36"><a href="cleaning-data.html#cb5-36"></a>    <span class="dt">wage_w_m =</span> DYCOL10,</span>
<span id="cb5-37"><a href="cleaning-data.html#cb5-37"></a>    <span class="dt">wage_w_y =</span> DYCOL11,</span>
<span id="cb5-38"><a href="cleaning-data.html#cb5-38"></a>    <span class="dt">perk_w_m =</span> DYCOL12,</span>
<span id="cb5-39"><a href="cleaning-data.html#cb5-39"></a>    <span class="dt">perk_w_y =</span> DYCOL13,</span>
<span id="cb5-40"><a href="cleaning-data.html#cb5-40"></a>    <span class="dt">netincome_w_m =</span> DYCOL14,</span>
<span id="cb5-41"><a href="cleaning-data.html#cb5-41"></a>    <span class="dt">netincome_w_y =</span> DYCOL15) <span class="op">%&gt;%</span></span>
<span id="cb5-42"><a href="cleaning-data.html#cb5-42"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb5-43"><a href="cleaning-data.html#cb5-43"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00=</span> <span class="ot">NA_integer_</span>) <span class="op">%&gt;%</span></span>
<span id="cb5-44"><a href="cleaning-data.html#cb5-44"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb5-45"><a href="cleaning-data.html#cb5-45"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>netincome_w_y, <span class="dt">cpi_m =</span> cpi, cpi_y)</span>
<span id="cb5-46"><a href="cleaning-data.html#cb5-46"></a></span>
<span id="cb5-47"><a href="cleaning-data.html#cb5-47"></a><span class="co"># Part 4, Table 2</span></span>
<span id="cb5-48"><a href="cleaning-data.html#cb5-48"></a>R98P4S02 &lt;-<span class="st"> </span>R98P4S02 <span class="op">%&gt;%</span></span>
<span id="cb5-49"><a href="cleaning-data.html#cb5-49"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb5-50"><a href="cleaning-data.html#cb5-50"></a>    <span class="dt">member =</span> DYCOL01,</span>
<span id="cb5-51"><a href="cleaning-data.html#cb5-51"></a>    <span class="dt">employed_s =</span> DYCOL02,</span>
<span id="cb5-52"><a href="cleaning-data.html#cb5-52"></a>    <span class="dt">ISCO_s =</span> DYCOL03,</span>
<span id="cb5-53"><a href="cleaning-data.html#cb5-53"></a>    <span class="dt">ISIC_s =</span> DYCOL04,</span>
<span id="cb5-54"><a href="cleaning-data.html#cb5-54"></a>    <span class="dt">status_s =</span> DYCOL05,</span>
<span id="cb5-55"><a href="cleaning-data.html#cb5-55"></a>    <span class="dt">agriculture =</span> DYCOL06,</span>
<span id="cb5-56"><a href="cleaning-data.html#cb5-56"></a>    <span class="dt">hours_s =</span> DYCOL07,</span>
<span id="cb5-57"><a href="cleaning-data.html#cb5-57"></a>    <span class="dt">days_s =</span> DYCOL08,</span>
<span id="cb5-58"><a href="cleaning-data.html#cb5-58"></a>    <span class="dt">cost_employment =</span> DYCOL09,</span>
<span id="cb5-59"><a href="cleaning-data.html#cb5-59"></a>    <span class="dt">cost_raw =</span> DYCOL10,</span>
<span id="cb5-60"><a href="cleaning-data.html#cb5-60"></a>    <span class="dt">cost_machinery =</span> DYCOL11,</span>
<span id="cb5-61"><a href="cleaning-data.html#cb5-61"></a>    <span class="dt">cost_others =</span> DYCOL12,</span>
<span id="cb5-62"><a href="cleaning-data.html#cb5-62"></a>    <span class="dt">cost_tax =</span> DYCOL13,</span>
<span id="cb5-63"><a href="cleaning-data.html#cb5-63"></a>    <span class="dt">sale =</span> DYCOL14,</span>
<span id="cb5-64"><a href="cleaning-data.html#cb5-64"></a>    <span class="dt">income_s_y =</span> DYCOL15) <span class="op">%&gt;%</span></span>
<span id="cb5-65"><a href="cleaning-data.html#cb5-65"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb5-66"><a href="cleaning-data.html#cb5-66"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00=</span> <span class="ot">NA_integer_</span>) <span class="op">%&gt;%</span></span>
<span id="cb5-67"><a href="cleaning-data.html#cb5-67"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb5-68"><a href="cleaning-data.html#cb5-68"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>income_s_y, <span class="dt">cpi_m =</span> cpi, cpi_y)</span>
<span id="cb5-69"><a href="cleaning-data.html#cb5-69"></a></span>
<span id="cb5-70"><a href="cleaning-data.html#cb5-70"></a>U98P4S02 &lt;-<span class="st"> </span>U98P4S02 <span class="op">%&gt;%</span></span>
<span id="cb5-71"><a href="cleaning-data.html#cb5-71"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb5-72"><a href="cleaning-data.html#cb5-72"></a>    <span class="dt">member =</span> DYCOL01,</span>
<span id="cb5-73"><a href="cleaning-data.html#cb5-73"></a>    <span class="dt">employed_s =</span> DYCOL02,</span>
<span id="cb5-74"><a href="cleaning-data.html#cb5-74"></a>    <span class="dt">ISCO_s =</span> DYCOL03,</span>
<span id="cb5-75"><a href="cleaning-data.html#cb5-75"></a>    <span class="dt">ISIC_s =</span> DYCOL04,</span>
<span id="cb5-76"><a href="cleaning-data.html#cb5-76"></a>    <span class="dt">status_s =</span> DYCOL05,</span>
<span id="cb5-77"><a href="cleaning-data.html#cb5-77"></a>    <span class="dt">agriculture =</span> DYCOL06,</span>
<span id="cb5-78"><a href="cleaning-data.html#cb5-78"></a>    <span class="dt">hours_s =</span> DYCOL07,</span>
<span id="cb5-79"><a href="cleaning-data.html#cb5-79"></a>    <span class="dt">days_s =</span> DYCOL08,</span>
<span id="cb5-80"><a href="cleaning-data.html#cb5-80"></a>    <span class="dt">cost_employment =</span> DYCOL09,</span>
<span id="cb5-81"><a href="cleaning-data.html#cb5-81"></a>    <span class="dt">cost_raw =</span> DYCOL10,</span>
<span id="cb5-82"><a href="cleaning-data.html#cb5-82"></a>    <span class="dt">cost_machinery =</span> DYCOL11,</span>
<span id="cb5-83"><a href="cleaning-data.html#cb5-83"></a>    <span class="dt">cost_others =</span> DYCOL12,</span>
<span id="cb5-84"><a href="cleaning-data.html#cb5-84"></a>    <span class="dt">cost_tax =</span> DYCOL13,</span>
<span id="cb5-85"><a href="cleaning-data.html#cb5-85"></a>    <span class="dt">sale =</span> DYCOL14,</span>
<span id="cb5-86"><a href="cleaning-data.html#cb5-86"></a>    <span class="dt">income_s_y =</span> DYCOL15) <span class="op">%&gt;%</span></span>
<span id="cb5-87"><a href="cleaning-data.html#cb5-87"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb5-88"><a href="cleaning-data.html#cb5-88"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00=</span> <span class="ot">NA_integer_</span>) <span class="op">%&gt;%</span></span>
<span id="cb5-89"><a href="cleaning-data.html#cb5-89"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb5-90"><a href="cleaning-data.html#cb5-90"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>income_s_y, cpi_y)</span>
<span id="cb5-91"><a href="cleaning-data.html#cb5-91"></a></span>
<span id="cb5-92"><a href="cleaning-data.html#cb5-92"></a><span class="co"># Part 4, Table 3</span></span>
<span id="cb5-93"><a href="cleaning-data.html#cb5-93"></a>R98P4S03 &lt;-<span class="st"> </span>R98P4S03 <span class="op">%&gt;%</span></span>
<span id="cb5-94"><a href="cleaning-data.html#cb5-94"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb5-95"><a href="cleaning-data.html#cb5-95"></a>    <span class="dt">member =</span> DYCOL01,</span>
<span id="cb5-96"><a href="cleaning-data.html#cb5-96"></a>    <span class="dt">income_pension =</span> DYCOL03,</span>
<span id="cb5-97"><a href="cleaning-data.html#cb5-97"></a>    <span class="dt">income_rent =</span> DYCOL04,</span>
<span id="cb5-98"><a href="cleaning-data.html#cb5-98"></a>    <span class="dt">income_interest =</span> DYCOL05,</span>
<span id="cb5-99"><a href="cleaning-data.html#cb5-99"></a>    <span class="dt">income_aid =</span> DYCOL06,</span>
<span id="cb5-100"><a href="cleaning-data.html#cb5-100"></a>    <span class="dt">income_resale =</span> DYCOL07,</span>
<span id="cb5-101"><a href="cleaning-data.html#cb5-101"></a>    <span class="dt">income_transfer =</span> DYCOL08) <span class="op">%&gt;%</span></span>
<span id="cb5-102"><a href="cleaning-data.html#cb5-102"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb5-103"><a href="cleaning-data.html#cb5-103"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00=</span> <span class="ot">NA_integer_</span>) <span class="op">%&gt;%</span></span>
<span id="cb5-104"><a href="cleaning-data.html#cb5-104"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb5-105"><a href="cleaning-data.html#cb5-105"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>income_transfer, cpi_y)</span>
<span id="cb5-106"><a href="cleaning-data.html#cb5-106"></a></span>
<span id="cb5-107"><a href="cleaning-data.html#cb5-107"></a>U98P4S03 &lt;-<span class="st"> </span>U98P4S03 <span class="op">%&gt;%</span></span>
<span id="cb5-108"><a href="cleaning-data.html#cb5-108"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb5-109"><a href="cleaning-data.html#cb5-109"></a>    <span class="dt">member =</span> DYCOL01,</span>
<span id="cb5-110"><a href="cleaning-data.html#cb5-110"></a>    <span class="dt">income_pension =</span> DYCOL03,</span>
<span id="cb5-111"><a href="cleaning-data.html#cb5-111"></a>    <span class="dt">income_rent =</span> DYCOL04,</span>
<span id="cb5-112"><a href="cleaning-data.html#cb5-112"></a>    <span class="dt">income_interest =</span> DYCOL05,</span>
<span id="cb5-113"><a href="cleaning-data.html#cb5-113"></a>    <span class="dt">income_aid =</span> DYCOL06,</span>
<span id="cb5-114"><a href="cleaning-data.html#cb5-114"></a>    <span class="dt">income_resale =</span> DYCOL07,</span>
<span id="cb5-115"><a href="cleaning-data.html#cb5-115"></a>    <span class="dt">income_transfer =</span> DYCOL08) <span class="op">%&gt;%</span></span>
<span id="cb5-116"><a href="cleaning-data.html#cb5-116"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb5-117"><a href="cleaning-data.html#cb5-117"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00=</span> <span class="ot">NA_integer_</span>) <span class="op">%&gt;%</span></span>
<span id="cb5-118"><a href="cleaning-data.html#cb5-118"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb5-119"><a href="cleaning-data.html#cb5-119"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>income_transfer, cpi_y)</span>
<span id="cb5-120"><a href="cleaning-data.html#cb5-120"></a></span>
<span id="cb5-121"><a href="cleaning-data.html#cb5-121"></a><span class="co"># Part 4, Table 4</span></span>
<span id="cb5-122"><a href="cleaning-data.html#cb5-122"></a></span>
<span id="cb5-123"><a href="cleaning-data.html#cb5-123"></a>R98P4S04 &lt;-<span class="st"> </span>R98P4S04 <span class="op">%&gt;%</span></span>
<span id="cb5-124"><a href="cleaning-data.html#cb5-124"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb5-125"><a href="cleaning-data.html#cb5-125"></a>    <span class="dt">member =</span> Dycol01,</span>
<span id="cb5-126"><a href="cleaning-data.html#cb5-126"></a>    <span class="dt">subsidy_number =</span> Dycol03,</span>
<span id="cb5-127"><a href="cleaning-data.html#cb5-127"></a>    <span class="dt">subsidy_month =</span> Dycol04,</span>
<span id="cb5-128"><a href="cleaning-data.html#cb5-128"></a>    <span class="dt">subsidy =</span> Dycol05) <span class="op">%&gt;%</span></span>
<span id="cb5-129"><a href="cleaning-data.html#cb5-129"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb5-130"><a href="cleaning-data.html#cb5-130"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00=</span> <span class="ot">NA_integer_</span>) <span class="op">%&gt;%</span></span>
<span id="cb5-131"><a href="cleaning-data.html#cb5-131"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb5-132"><a href="cleaning-data.html#cb5-132"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>subsidy, cpi_y)</span>
<span id="cb5-133"><a href="cleaning-data.html#cb5-133"></a></span>
<span id="cb5-134"><a href="cleaning-data.html#cb5-134"></a>U98P4S04 &lt;-<span class="st"> </span>U98P4S04 <span class="op">%&gt;%</span></span>
<span id="cb5-135"><a href="cleaning-data.html#cb5-135"></a><span class="st">  </span><span class="kw">rename</span>(</span>
<span id="cb5-136"><a href="cleaning-data.html#cb5-136"></a>    <span class="dt">member =</span> Dycol01,</span>
<span id="cb5-137"><a href="cleaning-data.html#cb5-137"></a>    <span class="dt">subsidy_number =</span> Dycol03,</span>
<span id="cb5-138"><a href="cleaning-data.html#cb5-138"></a>    <span class="dt">subsidy_month =</span> Dycol04,</span>
<span id="cb5-139"><a href="cleaning-data.html#cb5-139"></a>    <span class="dt">subsidy =</span> Dycol05) <span class="op">%&gt;%</span></span>
<span id="cb5-140"><a href="cleaning-data.html#cb5-140"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb5-141"><a href="cleaning-data.html#cb5-141"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00=</span> <span class="ot">NA_integer_</span>) <span class="op">%&gt;%</span></span>
<span id="cb5-142"><a href="cleaning-data.html#cb5-142"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb5-143"><a href="cleaning-data.html#cb5-143"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>subsidy, cpi_y)</span>
<span id="cb5-144"><a href="cleaning-data.html#cb5-144"></a></span>
<span id="cb5-145"><a href="cleaning-data.html#cb5-145"></a><span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">setdiff</span>(<span class="kw">ls</span>(), <span class="kw">ls</span>(<span class="dt">pattern =</span> <span class="st">&quot;98&quot;</span>))) <span class="co"># removing unnecessary objects</span></span>
<span id="cb5-146"><a href="cleaning-data.html#cb5-146"></a></span>
<span id="cb5-147"><a href="cleaning-data.html#cb5-147"></a><span class="kw">save.image</span>(<span class="dt">file=</span><span class="st">&quot;./exported/HEIS98.Rdata&quot;</span>)</span>
<span id="cb5-148"><a href="cleaning-data.html#cb5-148"></a></span>
<span id="cb5-149"><a href="cleaning-data.html#cb5-149"></a><span class="co"># reloading data for merging price</span></span>
<span id="cb5-150"><a href="cleaning-data.html#cb5-150"></a></span>
<span id="cb5-151"><a href="cleaning-data.html#cb5-151"></a>month &lt;-<span class="st"> </span>R98Data <span class="op">%&gt;%</span></span>
<span id="cb5-152"><a href="cleaning-data.html#cb5-152"></a><span class="st">  </span><span class="kw">bind_rows</span>(U98Data) <span class="op">%&gt;%</span></span>
<span id="cb5-153"><a href="cleaning-data.html#cb5-153"></a><span class="st">  </span><span class="kw">select</span>(Address,month) <span class="op">%&gt;%</span></span>
<span id="cb5-154"><a href="cleaning-data.html#cb5-154"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year=</span><span class="dv">1398</span>)</span>
<span id="cb5-155"><a href="cleaning-data.html#cb5-155"></a></span>
<span id="cb5-156"><a href="cleaning-data.html#cb5-156"></a>CPI &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;CPI/CPI.rds&quot;</span>)</span></code></pre></div>
</div>
<div id="building-item-level-data" class="section level2">
<h2><span class="header-section-number">4.6</span> Building item-level data</h2>
<p>Next, we merge all tables in Part 3 for getting a unique expenditure table by item for rural and urban regions. This table helps to document the trend of nominal and real expenditure in different items. The excel file “itemlabels.xlsx” includes the description of each expenditure item in Farsi and English.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="cleaning-data.html#cb6-1"></a><span class="co">###############################################</span></span>
<span id="cb6-2"><a href="cleaning-data.html#cb6-2"></a><span class="co"># Item-level expenditure table</span></span>
<span id="cb6-3"><a href="cleaning-data.html#cb6-3"></a></span>
<span id="cb6-4"><a href="cleaning-data.html#cb6-4"></a>R98P3 &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(R98P3S01, R98P3S02, R98P3S03, R98P3S04, R98P3S05, R98P3S06, R98P3S07, R98P3S08, R98P3S09, R98P3S11, R98P3S12, R98P3S13, R98P3S14)</span>
<span id="cb6-5"><a href="cleaning-data.html#cb6-5"></a>R98P3 &lt;-<span class="st"> </span>R98P3 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-6"><a href="cleaning-data.html#cb6-6"></a><span class="st">  </span><span class="kw">left_join</span>(R98Data) <span class="op">%&gt;%</span></span>
<span id="cb6-7"><a href="cleaning-data.html#cb6-7"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">province =</span> <span class="kw">substr</span>(Address, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb6-8"><a href="cleaning-data.html#cb6-8"></a>         <span class="dt">town =</span> <span class="kw">substr</span>(Address, <span class="dv">4</span>, <span class="dv">5</span>),</span>
<span id="cb6-9"><a href="cleaning-data.html#cb6-9"></a>         <span class="dt">urban =</span> <span class="st">&quot;R&quot;</span>)</span>
<span id="cb6-10"><a href="cleaning-data.html#cb6-10"></a></span>
<span id="cb6-11"><a href="cleaning-data.html#cb6-11"></a>U98P3 &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(U98P3S01, U98P3S02, U98P3S03, U98P3S04, U98P3S05, U98P3S06, U98P3S07, U98P3S08, U98P3S09, U98P3S11, U98P3S12, U98P3S13, U98P3S14)</span>
<span id="cb6-12"><a href="cleaning-data.html#cb6-12"></a>U98P3 &lt;-<span class="st"> </span>U98P3 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-13"><a href="cleaning-data.html#cb6-13"></a><span class="st">  </span><span class="kw">left_join</span>(U98Data) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-14"><a href="cleaning-data.html#cb6-14"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">province =</span> <span class="kw">substr</span>(U98P3<span class="op">$</span>Address, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb6-15"><a href="cleaning-data.html#cb6-15"></a>         <span class="dt">town =</span> <span class="kw">substr</span>(U98P3<span class="op">$</span>Address, <span class="dv">4</span>, <span class="dv">5</span>),</span>
<span id="cb6-16"><a href="cleaning-data.html#cb6-16"></a>         <span class="dt">urban =</span> <span class="st">&quot;U&quot;</span>)</span>
<span id="cb6-17"><a href="cleaning-data.html#cb6-17"></a></span>
<span id="cb6-18"><a href="cleaning-data.html#cb6-18"></a>itemcode &lt;-<span class="st"> </span><span class="kw">read_excel</span>(<span class="st">&quot;itemlabels.xlsx&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb6-19"><a href="cleaning-data.html#cb6-19"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(Global)) <span class="op">%&gt;%</span></span>
<span id="cb6-20"><a href="cleaning-data.html#cb6-20"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gcode=</span><span class="kw">ifelse</span>(<span class="kw">is.na</span>(G2),Global,Global<span class="op">*</span><span class="dv">100</span><span class="op">+</span>G2)) <span class="op">%&gt;%</span></span>
<span id="cb6-21"><a href="cleaning-data.html#cb6-21"></a><span class="st">  </span><span class="kw">select</span>(gcode, Label, LabelFA)</span>
<span id="cb6-22"><a href="cleaning-data.html#cb6-22"></a>itemcode<span class="op">$</span>item &lt;-<span class="st"> </span><span class="kw">factor</span>(itemcode<span class="op">$</span>gcode, <span class="dt">levels =</span> itemcode<span class="op">$</span>gcode, <span class="dt">labels =</span> itemcode<span class="op">$</span>Label)</span>
<span id="cb6-23"><a href="cleaning-data.html#cb6-23"></a></span>
<span id="cb6-24"><a href="cleaning-data.html#cb6-24"></a>EXP98 &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(R98P3,U98P3) <span class="op">%&gt;%</span></span>
<span id="cb6-25"><a href="cleaning-data.html#cb6-25"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">gcode =</span> DYCOL00) <span class="op">%&gt;%</span></span>
<span id="cb6-26"><a href="cleaning-data.html#cb6-26"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">urban =</span> <span class="kw">as.factor</span>(urban), </span>
<span id="cb6-27"><a href="cleaning-data.html#cb6-27"></a>         <span class="dt">recallperiod=</span><span class="kw">ifelse</span>(table<span class="op">&gt;</span><span class="dv">12</span>,<span class="dv">1</span><span class="op">/</span><span class="dv">12</span>,<span class="dv">1</span>)) <span class="op">%&gt;%</span></span>
<span id="cb6-28"><a href="cleaning-data.html#cb6-28"></a><span class="st">  </span><span class="kw">group_by</span>(table, gcode, code, urban) <span class="op">%&gt;%</span></span>
<span id="cb6-29"><a href="cleaning-data.html#cb6-29"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">Value =</span> <span class="kw">sum</span>(value<span class="op">*</span>weight<span class="op">*</span>recallperiod, <span class="dt">na.rm =</span> T),</span>
<span id="cb6-30"><a href="cleaning-data.html#cb6-30"></a>            <span class="dt">Value_r =</span> <span class="kw">sum</span>(value_r<span class="op">*</span>weight<span class="op">*</span>recallperiod, <span class="dt">na.rm =</span> T),</span>
<span id="cb6-31"><a href="cleaning-data.html#cb6-31"></a>            <span class="dt">Kilogram =</span> <span class="kw">sum</span>(kilogram<span class="op">*</span>weight, <span class="dt">na.rm =</span> T),</span>
<span id="cb6-32"><a href="cleaning-data.html#cb6-32"></a>            <span class="dt">Gram =</span> <span class="kw">sum</span>(gram<span class="op">*</span>weight, <span class="dt">na.rm =</span> T),</span>
<span id="cb6-33"><a href="cleaning-data.html#cb6-33"></a>            <span class="dt">Price =</span> <span class="kw">median</span>(price, <span class="dt">na.rm =</span> T)) <span class="op">%&gt;%</span></span>
<span id="cb6-34"><a href="cleaning-data.html#cb6-34"></a><span class="st">  </span><span class="kw">filter</span>(Value<span class="op">!=</span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb6-35"><a href="cleaning-data.html#cb6-35"></a><span class="st">  </span><span class="kw">left_join</span>(itemcode) <span class="op">%&gt;%</span></span>
<span id="cb6-36"><a href="cleaning-data.html#cb6-36"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>Label, <span class="op">-</span>LabelFA) <span class="op">%&gt;%</span></span>
<span id="cb6-37"><a href="cleaning-data.html#cb6-37"></a><span class="st">  </span><span class="kw">as.data.frame</span>()</span>
<span id="cb6-38"><a href="cleaning-data.html#cb6-38"></a></span>
<span id="cb6-39"><a href="cleaning-data.html#cb6-39"></a><span class="kw">attr</span>(EXP98<span class="op">$</span>table, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;table number in Part 3&quot;</span></span>
<span id="cb6-40"><a href="cleaning-data.html#cb6-40"></a><span class="kw">attr</span>(EXP98<span class="op">$</span>gcode, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;global item code&quot;</span></span>
<span id="cb6-41"><a href="cleaning-data.html#cb6-41"></a><span class="kw">attr</span>(EXP98<span class="op">$</span>code, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;item code in this year&quot;</span></span>
<span id="cb6-42"><a href="cleaning-data.html#cb6-42"></a><span class="kw">attr</span>(EXP98<span class="op">$</span>urban, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;rural or urban&quot;</span></span>
<span id="cb6-43"><a href="cleaning-data.html#cb6-43"></a><span class="kw">attr</span>(EXP98<span class="op">$</span>Price, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;median price&quot;</span></span>
<span id="cb6-44"><a href="cleaning-data.html#cb6-44"></a><span class="kw">attr</span>(EXP98<span class="op">$</span>Value, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;monthly expenditure&quot;</span></span>
<span id="cb6-45"><a href="cleaning-data.html#cb6-45"></a><span class="kw">attr</span>(EXP98<span class="op">$</span>Value_r, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;monthly expenditure in 1390 price&quot;</span></span>
<span id="cb6-46"><a href="cleaning-data.html#cb6-46"></a></span>
<span id="cb6-47"><a href="cleaning-data.html#cb6-47"></a><span class="kw">saveRDS</span>(EXP98, <span class="st">&quot;./exported/EXP98.Rds&quot;</span>)</span></code></pre></div>
</div>
<div id="building-individual-level-data" class="section level2">
<h2><span class="header-section-number">4.7</span> Building individual-level data</h2>
<p>As part 1 and part 4 are at the individual level, we merge them to make a unique data frame containing individual characteristics and income. We also include average monthly and yearly CPI index ending in the month of the survey to enable users to adjust values by a price index. This table can also be used as a rotating panel data for 1389 onwards. One issue to build individual-level data is multi-job people that have more than one occupation code and wage. For this reason, we unify individuals by summing up their income items over different jobs in each table and counting the first listed job as their industry and occupation code. The data frame ending with "_unique" in the below code is the unified version of 4 tables of Part 4.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="cleaning-data.html#cb7-1"></a><span class="co">###############################################</span></span>
<span id="cb7-2"><a href="cleaning-data.html#cb7-2"></a><span class="co"># Building individual level data</span></span>
<span id="cb7-3"><a href="cleaning-data.html#cb7-3"></a></span>
<span id="cb7-4"><a href="cleaning-data.html#cb7-4"></a>r98data&lt;-<span class="st"> </span>R98Data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(Address, mah, weight, khanevartype, Jaygozin, province)</span>
<span id="cb7-5"><a href="cleaning-data.html#cb7-5"></a>u98data&lt;-<span class="st"> </span>U98Data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(Address, mah, weight, khanevartype, Jaygozin, province)</span>
<span id="cb7-6"><a href="cleaning-data.html#cb7-6"></a></span>
<span id="cb7-7"><a href="cleaning-data.html#cb7-7"></a></span>
<span id="cb7-8"><a href="cleaning-data.html#cb7-8"></a><span class="co"># Multi-job people are repeated and need to be unified. The below code is using dplyr</span></span>
<span id="cb7-9"><a href="cleaning-data.html#cb7-9"></a>R98P4S01_unique &lt;-<span class="st"> </span>R98P4S01 <span class="op">%&gt;%</span></span>
<span id="cb7-10"><a href="cleaning-data.html#cb7-10"></a><span class="st">  </span><span class="kw">group_by</span>(Address, member) <span class="op">%&gt;%</span></span>
<span id="cb7-11"><a href="cleaning-data.html#cb7-11"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="kw">across</span>(<span class="kw">c</span>(employed_w,ISCO_w,ISIC_w,status_w), first),</span>
<span id="cb7-12"><a href="cleaning-data.html#cb7-12"></a>            <span class="kw">across</span>(<span class="kw">c</span>(hours_w,days_w,<span class="kw">ends_with</span>(<span class="kw">c</span>(<span class="st">&quot;_y&quot;</span>,<span class="st">&quot;_m&quot;</span>))), <span class="op">~</span><span class="st"> </span><span class="kw">sum</span>(.x,<span class="dt">na.rm =</span> T))) <span class="op">%&gt;%</span></span>
<span id="cb7-13"><a href="cleaning-data.html#cb7-13"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb7-14"><a href="cleaning-data.html#cb7-14"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">c</span>(hours_w,days_w), <span class="op">~</span><span class="kw">ifelse</span>(.x <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,<span class="ot">NA</span>,.x)))</span>
<span id="cb7-15"><a href="cleaning-data.html#cb7-15"></a></span>
<span id="cb7-16"><a href="cleaning-data.html#cb7-16"></a></span>
<span id="cb7-17"><a href="cleaning-data.html#cb7-17"></a>R98P4S02_unique &lt;-<span class="st"> </span>R98P4S02 <span class="op">%&gt;%</span></span>
<span id="cb7-18"><a href="cleaning-data.html#cb7-18"></a><span class="st">  </span><span class="kw">group_by</span>(Address, member) <span class="op">%&gt;%</span></span>
<span id="cb7-19"><a href="cleaning-data.html#cb7-19"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="kw">across</span>(<span class="kw">c</span>(employed_s,ISCO_s,ISIC_s,status_s, agriculture), first),</span>
<span id="cb7-20"><a href="cleaning-data.html#cb7-20"></a>            <span class="kw">across</span>(<span class="kw">c</span>(hours_s,days_s,<span class="kw">starts_with</span>(<span class="st">&quot;cost_&quot;</span>),sale ,income_s_y),</span>
<span id="cb7-21"><a href="cleaning-data.html#cb7-21"></a>                   <span class="op">~</span><span class="kw">sum</span>(.x,<span class="dt">na.rm =</span> T))) <span class="op">%&gt;%</span></span>
<span id="cb7-22"><a href="cleaning-data.html#cb7-22"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb7-23"><a href="cleaning-data.html#cb7-23"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">c</span>(hours_s,days_s), <span class="op">~</span><span class="kw">ifelse</span>(.x <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,<span class="ot">NA</span>,.x)))</span>
<span id="cb7-24"><a href="cleaning-data.html#cb7-24"></a></span>
<span id="cb7-25"><a href="cleaning-data.html#cb7-25"></a>R98P4S03_unique &lt;-<span class="st"> </span>R98P4S03 <span class="op">%&gt;%</span></span>
<span id="cb7-26"><a href="cleaning-data.html#cb7-26"></a><span class="st">  </span><span class="kw">group_by</span>(Address, member) <span class="op">%&gt;%</span></span>
<span id="cb7-27"><a href="cleaning-data.html#cb7-27"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="kw">across</span>(<span class="kw">starts_with</span>(<span class="st">&quot;income_&quot;</span>),<span class="op">~</span><span class="kw">sum</span>(.x,<span class="dt">na.rm =</span> T)))</span>
<span id="cb7-28"><a href="cleaning-data.html#cb7-28"></a></span>
<span id="cb7-29"><a href="cleaning-data.html#cb7-29"></a>R98P4S04_unique &lt;-<span class="st"> </span>R98P4S04 <span class="op">%&gt;%</span></span>
<span id="cb7-30"><a href="cleaning-data.html#cb7-30"></a><span class="st">  </span><span class="kw">group_by</span>(Address, member) <span class="op">%&gt;%</span></span>
<span id="cb7-31"><a href="cleaning-data.html#cb7-31"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="kw">across</span>(<span class="kw">starts_with</span>(<span class="st">&quot;subsidy&quot;</span>),<span class="op">~</span><span class="kw">sum</span>(.x,<span class="dt">na.rm =</span> T)))</span>
<span id="cb7-32"><a href="cleaning-data.html#cb7-32"></a></span>
<span id="cb7-33"><a href="cleaning-data.html#cb7-33"></a>Rind98 &lt;-<span class="st"> </span>r98data <span class="op">%&gt;%</span></span>
<span id="cb7-34"><a href="cleaning-data.html#cb7-34"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">urban =</span> <span class="st">&quot;R&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb7-35"><a href="cleaning-data.html#cb7-35"></a><span class="st">  </span><span class="kw">left_join</span>(R98P1) <span class="op">%&gt;%</span></span>
<span id="cb7-36"><a href="cleaning-data.html#cb7-36"></a><span class="st">  </span><span class="kw">left_join</span>(R98P4S01_unique) <span class="op">%&gt;%</span></span>
<span id="cb7-37"><a href="cleaning-data.html#cb7-37"></a><span class="st">  </span><span class="kw">left_join</span>(R98P4S02_unique) <span class="op">%&gt;%</span></span>
<span id="cb7-38"><a href="cleaning-data.html#cb7-38"></a><span class="st">  </span><span class="kw">left_join</span>(R98P4S03_unique) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-39"><a href="cleaning-data.html#cb7-39"></a><span class="st">  </span><span class="kw">left_join</span>(R98P4S04_unique) <span class="op">%&gt;%</span></span>
<span id="cb7-40"><a href="cleaning-data.html#cb7-40"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">where</span>(is.character),as.integer)) </span>
<span id="cb7-41"><a href="cleaning-data.html#cb7-41"></a></span>
<span id="cb7-42"><a href="cleaning-data.html#cb7-42"></a>U98P4S01_unique &lt;-<span class="st"> </span>U98P4S01 <span class="op">%&gt;%</span></span>
<span id="cb7-43"><a href="cleaning-data.html#cb7-43"></a><span class="st">  </span><span class="kw">group_by</span>(Address, member) <span class="op">%&gt;%</span></span>
<span id="cb7-44"><a href="cleaning-data.html#cb7-44"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="kw">across</span>(<span class="kw">c</span>(employed_w,ISCO_w,ISIC_w,status_w), first),</span>
<span id="cb7-45"><a href="cleaning-data.html#cb7-45"></a>            <span class="kw">across</span>(<span class="kw">c</span>(hours_w,days_w,<span class="kw">ends_with</span>(<span class="kw">c</span>(<span class="st">&quot;_y&quot;</span>,<span class="st">&quot;_m&quot;</span>))), <span class="op">~</span><span class="st"> </span><span class="kw">sum</span>(.x,<span class="dt">na.rm =</span> T))) <span class="op">%&gt;%</span></span>
<span id="cb7-46"><a href="cleaning-data.html#cb7-46"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb7-47"><a href="cleaning-data.html#cb7-47"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">c</span>(hours_w,days_w), <span class="op">~</span><span class="kw">ifelse</span>(.x <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,<span class="ot">NA</span>,.x)))</span>
<span id="cb7-48"><a href="cleaning-data.html#cb7-48"></a></span>
<span id="cb7-49"><a href="cleaning-data.html#cb7-49"></a>U98P4S02_unique &lt;-<span class="st"> </span>U98P4S02 <span class="op">%&gt;%</span></span>
<span id="cb7-50"><a href="cleaning-data.html#cb7-50"></a><span class="st">  </span><span class="kw">group_by</span>(Address, member) <span class="op">%&gt;%</span></span>
<span id="cb7-51"><a href="cleaning-data.html#cb7-51"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="kw">across</span>(<span class="kw">c</span>(employed_s,ISCO_s,ISIC_s,status_s, agriculture), first),</span>
<span id="cb7-52"><a href="cleaning-data.html#cb7-52"></a>            <span class="kw">across</span>(<span class="kw">c</span>(hours_s,days_s,<span class="kw">starts_with</span>(<span class="st">&quot;cost_&quot;</span>),sale, income_s_y),</span>
<span id="cb7-53"><a href="cleaning-data.html#cb7-53"></a>                   <span class="op">~</span><span class="kw">sum</span>(.x,<span class="dt">na.rm =</span> T))) <span class="op">%&gt;%</span></span>
<span id="cb7-54"><a href="cleaning-data.html#cb7-54"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb7-55"><a href="cleaning-data.html#cb7-55"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">c</span>(hours_s,days_s), <span class="op">~</span><span class="kw">ifelse</span>(.x <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,<span class="ot">NA</span>,.x)))</span>
<span id="cb7-56"><a href="cleaning-data.html#cb7-56"></a></span>
<span id="cb7-57"><a href="cleaning-data.html#cb7-57"></a>U98P4S03_unique &lt;-<span class="st"> </span>U98P4S03 <span class="op">%&gt;%</span></span>
<span id="cb7-58"><a href="cleaning-data.html#cb7-58"></a><span class="st">  </span><span class="kw">group_by</span>(Address, member) <span class="op">%&gt;%</span></span>
<span id="cb7-59"><a href="cleaning-data.html#cb7-59"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="kw">across</span>(<span class="kw">starts_with</span>(<span class="st">&quot;income_&quot;</span>),<span class="op">~</span><span class="kw">sum</span>(.x,<span class="dt">na.rm =</span> T)))</span>
<span id="cb7-60"><a href="cleaning-data.html#cb7-60"></a></span>
<span id="cb7-61"><a href="cleaning-data.html#cb7-61"></a>U98P4S04_unique &lt;-<span class="st"> </span>U98P4S04 <span class="op">%&gt;%</span></span>
<span id="cb7-62"><a href="cleaning-data.html#cb7-62"></a><span class="st">  </span><span class="kw">group_by</span>(Address, member) <span class="op">%&gt;%</span></span>
<span id="cb7-63"><a href="cleaning-data.html#cb7-63"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="kw">across</span>(<span class="kw">starts_with</span>(<span class="st">&quot;subsidy&quot;</span>), <span class="op">~</span><span class="kw">sum</span>(.x,<span class="dt">na.rm =</span> T)))</span>
<span id="cb7-64"><a href="cleaning-data.html#cb7-64"></a></span>
<span id="cb7-65"><a href="cleaning-data.html#cb7-65"></a>Uind98 &lt;-<span class="st"> </span>u98data <span class="op">%&gt;%</span></span>
<span id="cb7-66"><a href="cleaning-data.html#cb7-66"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">urban =</span> <span class="st">&quot;U&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb7-67"><a href="cleaning-data.html#cb7-67"></a><span class="st">  </span><span class="kw">left_join</span>(U98P1) <span class="op">%&gt;%</span></span>
<span id="cb7-68"><a href="cleaning-data.html#cb7-68"></a><span class="st">  </span><span class="kw">left_join</span>(U98P4S01_unique) <span class="op">%&gt;%</span></span>
<span id="cb7-69"><a href="cleaning-data.html#cb7-69"></a><span class="st">  </span><span class="kw">left_join</span>(U98P4S02_unique) <span class="op">%&gt;%</span></span>
<span id="cb7-70"><a href="cleaning-data.html#cb7-70"></a><span class="st">  </span><span class="kw">left_join</span>(U98P4S03_unique) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-71"><a href="cleaning-data.html#cb7-71"></a><span class="st">  </span><span class="kw">left_join</span>(U98P4S04_unique) <span class="op">%&gt;%</span></span>
<span id="cb7-72"><a href="cleaning-data.html#cb7-72"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">where</span>(is.character),as.integer))</span>
<span id="cb7-73"><a href="cleaning-data.html#cb7-73"></a></span>
<span id="cb7-74"><a href="cleaning-data.html#cb7-74"></a>IND98 &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(Rind98,Uind98) <span class="op">%&gt;%</span></span>
<span id="cb7-75"><a href="cleaning-data.html#cb7-75"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">urban =</span> <span class="kw">as.factor</span>(urban),</span>
<span id="cb7-76"><a href="cleaning-data.html#cb7-76"></a>         <span class="dt">DYCOL00 =</span> <span class="ot">NA_integer_</span> ) <span class="op">%&gt;%</span></span>
<span id="cb7-77"><a href="cleaning-data.html#cb7-77"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb7-78"><a href="cleaning-data.html#cb7-78"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb7-79"><a href="cleaning-data.html#cb7-79"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>urban, <span class="dt">cpi_m =</span> cpi, cpi_y) <span class="op">%&gt;%</span></span>
<span id="cb7-80"><a href="cleaning-data.html#cb7-80"></a><span class="st">  </span><span class="kw">as.data.frame</span>()</span>
<span id="cb7-81"><a href="cleaning-data.html#cb7-81"></a></span>
<span id="cb7-82"><a href="cleaning-data.html#cb7-82"></a><span class="kw">attr</span>(IND98<span class="op">$</span>occupationalst, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;Job status&quot;</span></span>
<span id="cb7-83"><a href="cleaning-data.html#cb7-83"></a><span class="kw">attr</span>(IND98<span class="op">$</span>employed_w, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;Whether employed in wage-earning job?&quot;</span></span>
<span id="cb7-84"><a href="cleaning-data.html#cb7-84"></a><span class="kw">attr</span>(IND98<span class="op">$</span>ISIC_w, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;Industry code of wage-earning job&quot;</span></span>
<span id="cb7-85"><a href="cleaning-data.html#cb7-85"></a><span class="kw">attr</span>(IND98<span class="op">$</span>ISCO_w, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;Occupation code of wage-earning job&quot;</span></span>
<span id="cb7-86"><a href="cleaning-data.html#cb7-86"></a><span class="kw">attr</span>(IND98<span class="op">$</span>status_w, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;Wage-earning job status: 1-private 2-cooperative 3-public&quot;</span></span>
<span id="cb7-87"><a href="cleaning-data.html#cb7-87"></a><span class="kw">attr</span>(IND98<span class="op">$</span>hours_w, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;Wage-earning job: hours per day&quot;</span></span>
<span id="cb7-88"><a href="cleaning-data.html#cb7-88"></a><span class="kw">attr</span>(IND98<span class="op">$</span>days_w, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;Wage-earning job: day per week&quot;</span></span>
<span id="cb7-89"><a href="cleaning-data.html#cb7-89"></a><span class="kw">attr</span>(IND98<span class="op">$</span>netincome_w_m, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;wage-earning job: net income previous month&quot;</span></span>
<span id="cb7-90"><a href="cleaning-data.html#cb7-90"></a><span class="kw">attr</span>(IND98<span class="op">$</span>netincome_w_y, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;wage earning job: net income previous year&quot;</span></span>
<span id="cb7-91"><a href="cleaning-data.html#cb7-91"></a><span class="kw">attr</span>(IND98<span class="op">$</span>employed_s, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;Whether employed in non-wage job?&quot;</span></span>
<span id="cb7-92"><a href="cleaning-data.html#cb7-92"></a><span class="kw">attr</span>(IND98<span class="op">$</span>ISIC_s, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;Industry code of non-wage job&quot;</span></span>
<span id="cb7-93"><a href="cleaning-data.html#cb7-93"></a><span class="kw">attr</span>(IND98<span class="op">$</span>ISCO_s, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;Occupation code of non-wage job&quot;</span></span>
<span id="cb7-94"><a href="cleaning-data.html#cb7-94"></a><span class="kw">attr</span>(IND98<span class="op">$</span>status_s, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;job status: 4-employer 2-selfemployed 3-familyworker&quot;</span></span>
<span id="cb7-95"><a href="cleaning-data.html#cb7-95"></a><span class="kw">attr</span>(IND98<span class="op">$</span>hours_s, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;non-wage job: hours per day&quot;</span></span>
<span id="cb7-96"><a href="cleaning-data.html#cb7-96"></a><span class="kw">attr</span>(IND98<span class="op">$</span>days_s, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;non-wage job: day per week&quot;</span></span>
<span id="cb7-97"><a href="cleaning-data.html#cb7-97"></a><span class="kw">attr</span>(IND98<span class="op">$</span>income_s_y, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;non-wage job: net income previous year&quot;</span></span>
<span id="cb7-98"><a href="cleaning-data.html#cb7-98"></a></span>
<span id="cb7-99"><a href="cleaning-data.html#cb7-99"></a><span class="kw">saveRDS</span>(IND98,<span class="st">&quot;./exported/IND98.Rds&quot;</span>)</span></code></pre></div>
</div>
<div id="building-household-level-data-summary-files" class="section level2">
<h2><span class="header-section-number">4.8</span> Building Household-level data (summary files)</h2>
<p>Together with the raw data, SCI also disseminates the summary files for each HEIS year which includes household-level summary data of the survey. With the same idea, we build summary files for each year as follows.</p>
<p>For doing this, we first build data frames with household size, the number of literate, student, and employed members, and the characteristics of the head of the household.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="cleaning-data.html#cb8-1"></a><span class="co">###############################################</span></span>
<span id="cb8-2"><a href="cleaning-data.html#cb8-2"></a><span class="co"># Building Household Data</span></span>
<span id="cb8-3"><a href="cleaning-data.html#cb8-3"></a></span>
<span id="cb8-4"><a href="cleaning-data.html#cb8-4"></a><span class="co"># Household size, number of literates, students, employeds</span></span>
<span id="cb8-5"><a href="cleaning-data.html#cb8-5"></a>r98p1 &lt;-<span class="st"> </span>R98P1 <span class="op">%&gt;%</span></span>
<span id="cb8-6"><a href="cleaning-data.html#cb8-6"></a><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></span>
<span id="cb8-7"><a href="cleaning-data.html#cb8-7"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">size =</span> <span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(member)),</span>
<span id="cb8-8"><a href="cleaning-data.html#cb8-8"></a>         <span class="dt">literates =</span> <span class="kw">sum</span>(literacy <span class="op">==</span><span class="st"> &quot;literate&quot;</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb8-9"><a href="cleaning-data.html#cb8-9"></a>         <span class="dt">students =</span> <span class="kw">sum</span>(studying <span class="op">==</span><span class="st"> &quot;Yes&quot;</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb8-10"><a href="cleaning-data.html#cb8-10"></a>         <span class="dt">employeds =</span> <span class="kw">sum</span>(occupationalst <span class="op">==</span><span class="st"> &quot;employed&quot;</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) </span>
<span id="cb8-11"><a href="cleaning-data.html#cb8-11"></a></span>
<span id="cb8-12"><a href="cleaning-data.html#cb8-12"></a>u98p1 &lt;-<span class="st"> </span>U98P1 <span class="op">%&gt;%</span></span>
<span id="cb8-13"><a href="cleaning-data.html#cb8-13"></a><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></span>
<span id="cb8-14"><a href="cleaning-data.html#cb8-14"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">size =</span> <span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(member)),</span>
<span id="cb8-15"><a href="cleaning-data.html#cb8-15"></a>            <span class="dt">literates =</span> <span class="kw">sum</span>(literacy <span class="op">==</span><span class="st"> &quot;literate&quot;</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb8-16"><a href="cleaning-data.html#cb8-16"></a>            <span class="dt">students =</span> <span class="kw">sum</span>(studying <span class="op">==</span><span class="st"> &quot;Yes&quot;</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb8-17"><a href="cleaning-data.html#cb8-17"></a>            <span class="dt">employeds =</span> <span class="kw">sum</span>(occupationalst <span class="op">==</span><span class="st"> &quot;employed&quot;</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) </span>
<span id="cb8-18"><a href="cleaning-data.html#cb8-18"></a></span>
<span id="cb8-19"><a href="cleaning-data.html#cb8-19"></a><span class="co"># Head&#39;s characteristics in Part 1</span></span>
<span id="cb8-20"><a href="cleaning-data.html#cb8-20"></a>r_head &lt;-<span class="st"> </span>R98P1 <span class="op">%&gt;%</span></span>
<span id="cb8-21"><a href="cleaning-data.html#cb8-21"></a><span class="st">  </span><span class="kw">filter</span>(relation <span class="op">==</span><span class="st"> &quot;Head&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb8-22"><a href="cleaning-data.html#cb8-22"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>member,<span class="op">-</span>relation,<span class="op">-</span>studying)</span>
<span id="cb8-23"><a href="cleaning-data.html#cb8-23"></a></span>
<span id="cb8-24"><a href="cleaning-data.html#cb8-24"></a>u_head &lt;-<span class="st"> </span>U98P1 <span class="op">%&gt;%</span></span>
<span id="cb8-25"><a href="cleaning-data.html#cb8-25"></a><span class="st">        </span><span class="kw">filter</span>(relation <span class="op">==</span><span class="st"> &quot;Head&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb8-26"><a href="cleaning-data.html#cb8-26"></a><span class="st">        </span><span class="kw">select</span>(<span class="op">-</span>member,<span class="op">-</span>relation,<span class="op">-</span>studying)</span>
<span id="cb8-27"><a href="cleaning-data.html#cb8-27"></a></span>
<span id="cb8-28"><a href="cleaning-data.html#cb8-28"></a><span class="co"># summary of heads job codes</span></span>
<span id="cb8-29"><a href="cleaning-data.html#cb8-29"></a>r_job &lt;-<span class="st"> </span>Rind98 <span class="op">%&gt;%</span></span>
<span id="cb8-30"><a href="cleaning-data.html#cb8-30"></a><span class="st">  </span><span class="kw">filter</span>(relation <span class="op">==</span><span class="st"> &quot;Head&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb8-31"><a href="cleaning-data.html#cb8-31"></a><span class="st">  </span><span class="kw">select</span>(Address,<span class="kw">starts_with</span>(<span class="st">&quot;IS&quot;</span>))</span>
<span id="cb8-32"><a href="cleaning-data.html#cb8-32"></a></span>
<span id="cb8-33"><a href="cleaning-data.html#cb8-33"></a>u_job &lt;-<span class="st"> </span>Uind98 <span class="op">%&gt;%</span></span>
<span id="cb8-34"><a href="cleaning-data.html#cb8-34"></a><span class="st">  </span><span class="kw">filter</span>(relation <span class="op">==</span><span class="st"> &quot;Head&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb8-35"><a href="cleaning-data.html#cb8-35"></a><span class="st">  </span><span class="kw">select</span>(Address,<span class="kw">starts_with</span>(<span class="st">&quot;IS&quot;</span>))</span></code></pre></div>
<p>We next summarize household expenditure items within each table of Part 3. Here “cost” shows the nominal expenditure and “cost_r” shows the real expenditure:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="cleaning-data.html#cb9-1"></a><span class="co"># Sum of household expenditure items</span></span>
<span id="cb9-2"><a href="cleaning-data.html#cb9-2"></a>r98p3 &lt;-<span class="st"> </span>R98P3 <span class="op">%&gt;%</span></span>
<span id="cb9-3"><a href="cleaning-data.html#cb9-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Table =</span> <span class="kw">case_when</span>(</span>
<span id="cb9-4"><a href="cleaning-data.html#cb9-4"></a>    table <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> &quot;food&quot;</span>,</span>
<span id="cb9-5"><a href="cleaning-data.html#cb9-5"></a>    table <span class="op">==</span><span class="st"> </span><span class="dv">2</span> <span class="op">~</span><span class="st"> &quot;tobacco&quot;</span>,</span>
<span id="cb9-6"><a href="cleaning-data.html#cb9-6"></a>    table <span class="op">==</span><span class="st"> </span><span class="dv">3</span> <span class="op">~</span><span class="st"> &quot;clothing&quot;</span>,</span>
<span id="cb9-7"><a href="cleaning-data.html#cb9-7"></a>    table <span class="op">==</span><span class="st"> </span><span class="dv">4</span> <span class="op">~</span><span class="st"> &quot;housing&quot;</span>,</span>
<span id="cb9-8"><a href="cleaning-data.html#cb9-8"></a>    table <span class="op">==</span><span class="st"> </span><span class="dv">5</span> <span class="op">~</span><span class="st"> &quot;furniture&quot;</span>,</span>
<span id="cb9-9"><a href="cleaning-data.html#cb9-9"></a>    table <span class="op">==</span><span class="st"> </span><span class="dv">6</span> <span class="op">~</span><span class="st"> &quot;health&quot;</span>,</span>
<span id="cb9-10"><a href="cleaning-data.html#cb9-10"></a>    table <span class="op">==</span><span class="st"> </span><span class="dv">7</span> <span class="op">~</span><span class="st"> &quot;transport&quot;</span>,</span>
<span id="cb9-11"><a href="cleaning-data.html#cb9-11"></a>    table <span class="op">==</span><span class="st"> </span><span class="dv">8</span> <span class="op">~</span><span class="st"> &quot;communication&quot;</span>,</span>
<span id="cb9-12"><a href="cleaning-data.html#cb9-12"></a>    table <span class="op">==</span><span class="st"> </span><span class="dv">9</span> <span class="op">~</span><span class="st"> &quot;recreation&quot;</span>,</span>
<span id="cb9-13"><a href="cleaning-data.html#cb9-13"></a>    table <span class="op">==</span><span class="st"> </span><span class="dv">11</span> <span class="op">~</span><span class="st"> &quot;restaurant&quot;</span>,</span>
<span id="cb9-14"><a href="cleaning-data.html#cb9-14"></a>    table <span class="op">==</span><span class="st"> </span><span class="dv">12</span> <span class="op">~</span><span class="st"> &quot;miscellaneous&quot;</span>,</span>
<span id="cb9-15"><a href="cleaning-data.html#cb9-15"></a>    table <span class="op">==</span><span class="st"> </span><span class="dv">13</span> <span class="op">~</span><span class="st"> &quot;durables&quot;</span>,</span>
<span id="cb9-16"><a href="cleaning-data.html#cb9-16"></a>    table <span class="op">==</span><span class="st"> </span><span class="dv">14</span> <span class="op">~</span><span class="st"> &quot;investment&quot;</span>,</span>
<span id="cb9-17"><a href="cleaning-data.html#cb9-17"></a>    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="ot">NA_character_</span>)) <span class="op">%&gt;%</span></span>
<span id="cb9-18"><a href="cleaning-data.html#cb9-18"></a><span class="st">  </span><span class="kw">group_by</span>(Address,Table) <span class="op">%&gt;%</span></span>
<span id="cb9-19"><a href="cleaning-data.html#cb9-19"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cost =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb9-20"><a href="cleaning-data.html#cb9-20"></a>            <span class="dt">cost_r =</span> <span class="kw">sum</span>(value_r, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></span>
<span id="cb9-21"><a href="cleaning-data.html#cb9-21"></a><span class="st">  </span><span class="kw">pivot_wider</span>(Address, </span>
<span id="cb9-22"><a href="cleaning-data.html#cb9-22"></a>              <span class="dt">names_from =</span> <span class="st">&quot;Table&quot;</span>, </span>
<span id="cb9-23"><a href="cleaning-data.html#cb9-23"></a>              <span class="dt">values_from =</span> <span class="kw">c</span>(<span class="st">&quot;cost&quot;</span>,<span class="st">&quot;cost_r&quot;</span>), </span>
<span id="cb9-24"><a href="cleaning-data.html#cb9-24"></a>              <span class="dt">values_fill =</span> <span class="kw">list</span>(<span class="dt">cost =</span> <span class="dv">0</span>))</span>
<span id="cb9-25"><a href="cleaning-data.html#cb9-25"></a></span>
<span id="cb9-26"><a href="cleaning-data.html#cb9-26"></a>u98p3 &lt;-<span class="st"> </span>U98P3 <span class="op">%&gt;%</span></span>
<span id="cb9-27"><a href="cleaning-data.html#cb9-27"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Table =</span> <span class="kw">case_when</span>(</span>
<span id="cb9-28"><a href="cleaning-data.html#cb9-28"></a>    table <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> &quot;food&quot;</span>,</span>
<span id="cb9-29"><a href="cleaning-data.html#cb9-29"></a>    table <span class="op">==</span><span class="st"> </span><span class="dv">2</span> <span class="op">~</span><span class="st"> &quot;tobacco&quot;</span>,</span>
<span id="cb9-30"><a href="cleaning-data.html#cb9-30"></a>    table <span class="op">==</span><span class="st"> </span><span class="dv">3</span> <span class="op">~</span><span class="st"> &quot;clothing&quot;</span>,</span>
<span id="cb9-31"><a href="cleaning-data.html#cb9-31"></a>    table <span class="op">==</span><span class="st"> </span><span class="dv">4</span> <span class="op">~</span><span class="st"> &quot;housing&quot;</span>,</span>
<span id="cb9-32"><a href="cleaning-data.html#cb9-32"></a>    table <span class="op">==</span><span class="st"> </span><span class="dv">5</span> <span class="op">~</span><span class="st"> &quot;furniture&quot;</span>,</span>
<span id="cb9-33"><a href="cleaning-data.html#cb9-33"></a>    table <span class="op">==</span><span class="st"> </span><span class="dv">6</span> <span class="op">~</span><span class="st"> &quot;health&quot;</span>,</span>
<span id="cb9-34"><a href="cleaning-data.html#cb9-34"></a>    table <span class="op">==</span><span class="st"> </span><span class="dv">7</span> <span class="op">~</span><span class="st"> &quot;transport&quot;</span>,</span>
<span id="cb9-35"><a href="cleaning-data.html#cb9-35"></a>    table <span class="op">==</span><span class="st"> </span><span class="dv">8</span> <span class="op">~</span><span class="st"> &quot;communication&quot;</span>,</span>
<span id="cb9-36"><a href="cleaning-data.html#cb9-36"></a>    table <span class="op">==</span><span class="st"> </span><span class="dv">9</span> <span class="op">~</span><span class="st"> &quot;recreation&quot;</span>,</span>
<span id="cb9-37"><a href="cleaning-data.html#cb9-37"></a>    table <span class="op">==</span><span class="st"> </span><span class="dv">11</span> <span class="op">~</span><span class="st"> &quot;restaurant&quot;</span>,</span>
<span id="cb9-38"><a href="cleaning-data.html#cb9-38"></a>    table <span class="op">==</span><span class="st"> </span><span class="dv">12</span> <span class="op">~</span><span class="st"> &quot;miscellaneous&quot;</span>,</span>
<span id="cb9-39"><a href="cleaning-data.html#cb9-39"></a>    table <span class="op">==</span><span class="st"> </span><span class="dv">13</span> <span class="op">~</span><span class="st"> &quot;durables&quot;</span>,</span>
<span id="cb9-40"><a href="cleaning-data.html#cb9-40"></a>    table <span class="op">==</span><span class="st"> </span><span class="dv">14</span> <span class="op">~</span><span class="st"> &quot;investment&quot;</span>,</span>
<span id="cb9-41"><a href="cleaning-data.html#cb9-41"></a>    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="ot">NA_character_</span>)) <span class="op">%&gt;%</span></span>
<span id="cb9-42"><a href="cleaning-data.html#cb9-42"></a><span class="st">  </span><span class="kw">group_by</span>(Address,Table) <span class="op">%&gt;%</span></span>
<span id="cb9-43"><a href="cleaning-data.html#cb9-43"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cost =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb9-44"><a href="cleaning-data.html#cb9-44"></a>            <span class="dt">cost_r =</span> <span class="kw">sum</span>(value_r, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></span>
<span id="cb9-45"><a href="cleaning-data.html#cb9-45"></a><span class="st">  </span><span class="kw">pivot_wider</span>(Address, </span>
<span id="cb9-46"><a href="cleaning-data.html#cb9-46"></a>              <span class="dt">names_from =</span> <span class="st">&quot;Table&quot;</span>, </span>
<span id="cb9-47"><a href="cleaning-data.html#cb9-47"></a>              <span class="dt">values_from =</span> <span class="kw">c</span>(<span class="st">&quot;cost&quot;</span>,<span class="st">&quot;cost_r&quot;</span>), </span>
<span id="cb9-48"><a href="cleaning-data.html#cb9-48"></a>              <span class="dt">values_fill =</span> <span class="kw">list</span>(<span class="dt">cost =</span> <span class="dv">0</span>))</span></code></pre></div>
<p>We build non-monetary income based on imputed rent for homeowner households and the total value of non-purchased items as follows and then merge all income tables into one</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="cleaning-data.html#cb10-1"></a><span class="co"># Non-monetary household income</span></span>
<span id="cb10-2"><a href="cleaning-data.html#cb10-2"></a>r_NM_housing &lt;-<span class="st"> </span>R98P3S04 <span class="op">%&gt;%</span></span>
<span id="cb10-3"><a href="cleaning-data.html#cb10-3"></a><span class="st">  </span><span class="kw">filter</span>(DYCOL00 <span class="op">%/%</span><span class="st"> </span><span class="dv">1000</span> <span class="op">==</span><span class="st"> </span><span class="dv">42</span>) <span class="op">%&gt;%</span></span>
<span id="cb10-4"><a href="cleaning-data.html#cb10-4"></a><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></span>
<span id="cb10-5"><a href="cleaning-data.html#cb10-5"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">income_nm_house =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> T))</span>
<span id="cb10-6"><a href="cleaning-data.html#cb10-6"></a></span>
<span id="cb10-7"><a href="cleaning-data.html#cb10-7"></a>u_NM_housing &lt;-<span class="st"> </span>U98P3S04 <span class="op">%&gt;%</span></span>
<span id="cb10-8"><a href="cleaning-data.html#cb10-8"></a><span class="st">  </span><span class="kw">filter</span>(DYCOL00 <span class="op">%/%</span><span class="st"> </span><span class="dv">1000</span> <span class="op">==</span><span class="st"> </span><span class="dv">42</span>) <span class="op">%&gt;%</span></span>
<span id="cb10-9"><a href="cleaning-data.html#cb10-9"></a><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></span>
<span id="cb10-10"><a href="cleaning-data.html#cb10-10"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">income_nm_house =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> T))</span>
<span id="cb10-11"><a href="cleaning-data.html#cb10-11"></a></span>
<span id="cb10-12"><a href="cleaning-data.html#cb10-12"></a>r_NMincome &lt;-<span class="st"> </span>R98P3 <span class="op">%&gt;%</span></span>
<span id="cb10-13"><a href="cleaning-data.html#cb10-13"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">type =</span> <span class="kw">case_when</span>(</span>
<span id="cb10-14"><a href="cleaning-data.html#cb10-14"></a>    purchased <span class="op">%in%</span><span class="st"> </span><span class="dv">3</span><span class="op">:</span><span class="dv">4</span> <span class="op">~</span><span class="st"> &quot;public&quot;</span>,</span>
<span id="cb10-15"><a href="cleaning-data.html#cb10-15"></a>    purchased <span class="op">==</span><span class="st"> </span><span class="dv">5</span> <span class="op">~</span><span class="st"> &quot;private&quot;</span>,</span>
<span id="cb10-16"><a href="cleaning-data.html#cb10-16"></a>    purchased <span class="op">==</span><span class="st"> </span><span class="dv">6</span> <span class="op">~</span><span class="st"> &quot;agriculture&quot;</span>,</span>
<span id="cb10-17"><a href="cleaning-data.html#cb10-17"></a>    purchased <span class="op">==</span><span class="st"> </span><span class="dv">7</span> <span class="op">~</span><span class="st"> &quot;nonagriculture&quot;</span>, </span>
<span id="cb10-18"><a href="cleaning-data.html#cb10-18"></a>    purchased <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">8</span>) <span class="op">~</span><span class="st"> &quot;miscellaneous&quot;</span>,</span>
<span id="cb10-19"><a href="cleaning-data.html#cb10-19"></a>    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="ot">NA_character_</span>)) <span class="op">%&gt;%</span></span>
<span id="cb10-20"><a href="cleaning-data.html#cb10-20"></a><span class="st">  </span><span class="kw">group_by</span>(Address, type) <span class="op">%&gt;%</span></span>
<span id="cb10-21"><a href="cleaning-data.html#cb10-21"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">value =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> T)) <span class="op">%&gt;%</span></span>
<span id="cb10-22"><a href="cleaning-data.html#cb10-22"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(type)<span class="op">&amp;</span>value<span class="op">!=</span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb10-23"><a href="cleaning-data.html#cb10-23"></a><span class="st">  </span><span class="kw">pivot_wider</span>(Address, </span>
<span id="cb10-24"><a href="cleaning-data.html#cb10-24"></a>              <span class="dt">names_from=</span><span class="st">&quot;type&quot;</span>, <span class="dt">names_prefix =</span> <span class="st">&quot;income_nm_&quot;</span>, </span>
<span id="cb10-25"><a href="cleaning-data.html#cb10-25"></a>              <span class="dt">values_from =</span> <span class="st">&quot;value&quot;</span>,  <span class="dt">values_fill =</span> <span class="kw">list</span>(<span class="dt">value =</span> <span class="dv">0</span>)) <span class="op">%&gt;%</span></span>
<span id="cb10-26"><a href="cleaning-data.html#cb10-26"></a><span class="st">  </span><span class="kw">full_join</span>(r_NM_housing) </span>
<span id="cb10-27"><a href="cleaning-data.html#cb10-27"></a>r_NMincome[<span class="kw">is.na</span>(r_NMincome)] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb10-28"><a href="cleaning-data.html#cb10-28"></a></span>
<span id="cb10-29"><a href="cleaning-data.html#cb10-29"></a>u_NMincome &lt;-<span class="st"> </span>U98P3 <span class="op">%&gt;%</span></span>
<span id="cb10-30"><a href="cleaning-data.html#cb10-30"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">type =</span> <span class="kw">case_when</span>(</span>
<span id="cb10-31"><a href="cleaning-data.html#cb10-31"></a>    purchased <span class="op">%in%</span><span class="st"> </span><span class="dv">3</span><span class="op">:</span><span class="dv">4</span> <span class="op">~</span><span class="st"> &quot;public&quot;</span>,</span>
<span id="cb10-32"><a href="cleaning-data.html#cb10-32"></a>    purchased <span class="op">==</span><span class="st"> </span><span class="dv">5</span> <span class="op">~</span><span class="st"> &quot;private&quot;</span>,</span>
<span id="cb10-33"><a href="cleaning-data.html#cb10-33"></a>    purchased <span class="op">==</span><span class="st"> </span><span class="dv">6</span> <span class="op">~</span><span class="st"> &quot;agriculture&quot;</span>,</span>
<span id="cb10-34"><a href="cleaning-data.html#cb10-34"></a>    purchased <span class="op">==</span><span class="st"> </span><span class="dv">7</span> <span class="op">~</span><span class="st"> &quot;nonagriculture&quot;</span>, </span>
<span id="cb10-35"><a href="cleaning-data.html#cb10-35"></a>    purchased <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">8</span>) <span class="op">~</span><span class="st"> &quot;miscellaneous&quot;</span>,</span>
<span id="cb10-36"><a href="cleaning-data.html#cb10-36"></a>    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="ot">NA_character_</span>)) <span class="op">%&gt;%</span></span>
<span id="cb10-37"><a href="cleaning-data.html#cb10-37"></a><span class="st">  </span><span class="kw">group_by</span>(Address, type) <span class="op">%&gt;%</span></span>
<span id="cb10-38"><a href="cleaning-data.html#cb10-38"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">value =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> T)) <span class="op">%&gt;%</span></span>
<span id="cb10-39"><a href="cleaning-data.html#cb10-39"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(type)<span class="op">&amp;</span>value<span class="op">!=</span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb10-40"><a href="cleaning-data.html#cb10-40"></a><span class="st">  </span><span class="kw">pivot_wider</span>(Address, </span>
<span id="cb10-41"><a href="cleaning-data.html#cb10-41"></a>              <span class="dt">names_from=</span><span class="st">&quot;type&quot;</span>, <span class="dt">names_prefix =</span> <span class="st">&quot;income_nm_&quot;</span>, </span>
<span id="cb10-42"><a href="cleaning-data.html#cb10-42"></a>              <span class="dt">values_from =</span> <span class="st">&quot;value&quot;</span>, <span class="dt">values_fill =</span> <span class="kw">list</span>(<span class="dt">value =</span> <span class="dv">0</span>)) <span class="op">%&gt;%</span></span>
<span id="cb10-43"><a href="cleaning-data.html#cb10-43"></a><span class="st">  </span><span class="kw">full_join</span>(u_NM_housing) </span>
<span id="cb10-44"><a href="cleaning-data.html#cb10-44"></a>u_NMincome[<span class="kw">is.na</span>(u_NMincome)] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb10-45"><a href="cleaning-data.html#cb10-45"></a></span>
<span id="cb10-46"><a href="cleaning-data.html#cb10-46"></a><span class="co"># sum of household income</span></span>
<span id="cb10-47"><a href="cleaning-data.html#cb10-47"></a>r_incomeSum &lt;-<span class="st"> </span>Rind98 <span class="op">%&gt;%</span></span>
<span id="cb10-48"><a href="cleaning-data.html#cb10-48"></a><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></span>
<span id="cb10-49"><a href="cleaning-data.html#cb10-49"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="kw">across</span>(<span class="kw">c</span>(<span class="kw">starts_with</span>(<span class="kw">c</span>(<span class="st">&quot;income&quot;</span>,<span class="st">&quot;netincome&quot;</span>)),<span class="st">&quot;subsidy&quot;</span>), <span class="op">~</span><span class="kw">sum</span>(.x,<span class="dt">na.rm =</span> T)))</span>
<span id="cb10-50"><a href="cleaning-data.html#cb10-50"></a></span>
<span id="cb10-51"><a href="cleaning-data.html#cb10-51"></a>u_incomeSum &lt;-<span class="st"> </span>Uind98 <span class="op">%&gt;%</span></span>
<span id="cb10-52"><a href="cleaning-data.html#cb10-52"></a><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></span>
<span id="cb10-53"><a href="cleaning-data.html#cb10-53"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="kw">across</span>(<span class="kw">c</span>(<span class="kw">starts_with</span>(<span class="kw">c</span>(<span class="st">&quot;income&quot;</span>,<span class="st">&quot;netincome&quot;</span>)),<span class="st">&quot;subsidy&quot;</span>), <span class="op">~</span><span class="kw">sum</span>(.x,<span class="dt">na.rm =</span> T)))</span></code></pre></div>
<p>Finally, we merge all household-level data to save it as data frame names as <em>HH98.Rds</em> and include CPI index for the month and the year ending to survey month. We also build “expenditure” and “income” variables that show total monthly expenditure and yearly income. For aggregating expenditure, we note the difference in the recall period of table 13 and 14 to the rest.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="cleaning-data.html#cb11-1"></a><span class="co"># merging household-level data</span></span>
<span id="cb11-2"><a href="cleaning-data.html#cb11-2"></a>RHH98 &lt;-<span class="st"> </span>r98data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-3"><a href="cleaning-data.html#cb11-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">urban =</span> <span class="st">&quot;R&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb11-4"><a href="cleaning-data.html#cb11-4"></a><span class="st">  </span><span class="kw">left_join</span>(r98p1, <span class="dt">by=</span><span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb11-5"><a href="cleaning-data.html#cb11-5"></a><span class="st">  </span><span class="kw">left_join</span>(r_head, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb11-6"><a href="cleaning-data.html#cb11-6"></a><span class="st">  </span><span class="kw">left_join</span>(r_job, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb11-7"><a href="cleaning-data.html#cb11-7"></a><span class="st">  </span><span class="kw">left_join</span>(r98p3, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb11-8"><a href="cleaning-data.html#cb11-8"></a><span class="st">  </span><span class="kw">left_join</span>(r_incomeSum, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb11-9"><a href="cleaning-data.html#cb11-9"></a><span class="st">  </span><span class="kw">left_join</span>(r_NMincome, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb11-10"><a href="cleaning-data.html#cb11-10"></a><span class="st">  </span><span class="kw">left_join</span>(R98P2) <span class="op">%&gt;%</span></span>
<span id="cb11-11"><a href="cleaning-data.html#cb11-11"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(income_w_y<span class="op">:</span>income_nm_nonagriculture, <span class="op">~</span><span class="kw">ifelse</span>(<span class="kw">is.na</span>(.x),<span class="dv">0</span>,.x)))</span>
<span id="cb11-12"><a href="cleaning-data.html#cb11-12"></a></span>
<span id="cb11-13"><a href="cleaning-data.html#cb11-13"></a>UHH98 &lt;-<span class="st"> </span>u98data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-14"><a href="cleaning-data.html#cb11-14"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">urban =</span> <span class="st">&quot;U&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb11-15"><a href="cleaning-data.html#cb11-15"></a><span class="st">  </span><span class="kw">left_join</span>(u98p1, <span class="dt">by=</span><span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb11-16"><a href="cleaning-data.html#cb11-16"></a><span class="st">  </span><span class="kw">left_join</span>(r_head, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb11-17"><a href="cleaning-data.html#cb11-17"></a><span class="st">  </span><span class="kw">left_join</span>(u_job, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb11-18"><a href="cleaning-data.html#cb11-18"></a><span class="st">  </span><span class="kw">left_join</span>(u98p3, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb11-19"><a href="cleaning-data.html#cb11-19"></a><span class="st">  </span><span class="kw">left_join</span>(u_incomeSum, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb11-20"><a href="cleaning-data.html#cb11-20"></a><span class="st">  </span><span class="kw">left_join</span>(u_NMincome, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb11-21"><a href="cleaning-data.html#cb11-21"></a><span class="st">  </span><span class="kw">left_join</span>(U98P2) <span class="op">%&gt;%</span></span>
<span id="cb11-22"><a href="cleaning-data.html#cb11-22"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(income_w_y<span class="op">:</span>income_nm_nonagriculture, <span class="op">~</span><span class="kw">ifelse</span>(<span class="kw">is.na</span>(.x),<span class="dv">0</span>,.x)))</span>
<span id="cb11-23"><a href="cleaning-data.html#cb11-23"></a></span>
<span id="cb11-24"><a href="cleaning-data.html#cb11-24"></a>HH98 &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(RHH98, UHH98) <span class="op">%&gt;%</span></span>
<span id="cb11-25"><a href="cleaning-data.html#cb11-25"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">urban =</span> <span class="kw">as.factor</span>(urban)) <span class="op">%&gt;%</span></span>
<span id="cb11-26"><a href="cleaning-data.html#cb11-26"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">expenditure =</span> cost_food <span class="op">+</span><span class="st"> </span>cost_tobacco <span class="op">+</span><span class="st"> </span>cost_clothing <span class="op">+</span><span class="st"> </span>cost_housing <span class="op">+</span><span class="st"> </span>cost_furniture <span class="op">+</span><span class="st"> </span>cost_health <span class="op">+</span><span class="st"> </span>cost_transport <span class="op">+</span><span class="st"> </span>cost_communication <span class="op">+</span><span class="st"> </span>cost_recreation <span class="op">+</span><span class="st">  </span>cost_restaurant <span class="op">+</span><span class="st"> </span>cost_miscellaneous</span>
<span id="cb11-27"><a href="cleaning-data.html#cb11-27"></a>              <span class="op">+</span><span class="st"> </span>cost_durables<span class="op">/</span><span class="dv">12</span> <span class="op">+</span><span class="st"> </span>cost_investment<span class="op">/</span><span class="dv">12</span>,</span>
<span id="cb11-28"><a href="cleaning-data.html#cb11-28"></a>         <span class="dt">income =</span> income_s_y <span class="op">+</span><span class="st"> </span>netincome_w_y <span class="op">+</span><span class="st"> </span>income_pension <span class="op">+</span><span class="st"> </span>income_rent <span class="op">+</span><span class="st"> </span>income_interest <span class="op">+</span><span class="st"> </span>income_aid <span class="op">+</span><span class="st"> </span>income_transfer <span class="op">+</span><span class="st"> </span>subsidy <span class="op">+</span><span class="st"> </span>income_nm_agriculture <span class="op">+</span><span class="st"> </span>income_nm_miscellaneous <span class="op">+</span><span class="st"> </span>income_nm_public <span class="op">+</span><span class="st"> </span>income_nm_private <span class="op">+</span><span class="st"> </span>income_nm_nonagriculture <span class="op">+</span><span class="st"> </span>income_nm_house,</span>
<span id="cb11-29"><a href="cleaning-data.html#cb11-29"></a>         <span class="dt">DYCOL00 =</span> <span class="ot">NA_integer_</span> </span>
<span id="cb11-30"><a href="cleaning-data.html#cb11-30"></a>         ) <span class="op">%&gt;%</span></span>
<span id="cb11-31"><a href="cleaning-data.html#cb11-31"></a><span class="st">  </span><span class="kw">left_join</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb11-32"><a href="cleaning-data.html#cb11-32"></a><span class="st">  </span><span class="kw">left_join</span>(CPI) <span class="op">%&gt;%</span></span>
<span id="cb11-33"><a href="cleaning-data.html#cb11-33"></a><span class="st">  </span><span class="kw">select</span>(Address<span class="op">:</span>income, <span class="dt">cpi_m =</span> cpi, cpi_y) <span class="op">%&gt;%</span></span>
<span id="cb11-34"><a href="cleaning-data.html#cb11-34"></a><span class="st">  </span><span class="kw">as.data.frame</span>()</span>
<span id="cb11-35"><a href="cleaning-data.html#cb11-35"></a></span>
<span id="cb11-36"><a href="cleaning-data.html#cb11-36"></a><span class="kw">attr</span>(HH98<span class="op">$</span>size, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;Household size&quot;</span></span>
<span id="cb11-37"><a href="cleaning-data.html#cb11-37"></a><span class="kw">attr</span>(HH98<span class="op">$</span>literates, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;Number of literate members&quot;</span></span>
<span id="cb11-38"><a href="cleaning-data.html#cb11-38"></a><span class="kw">attr</span>(HH98<span class="op">$</span>students, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;Number of student members&quot;</span></span>
<span id="cb11-39"><a href="cleaning-data.html#cb11-39"></a><span class="kw">attr</span>(HH98<span class="op">$</span>employeds, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;Number of employed members&quot;</span></span>
<span id="cb11-40"><a href="cleaning-data.html#cb11-40"></a><span class="kw">attr</span>(HH98<span class="op">$</span>gender, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;Head&#39;s gender&quot;</span></span>
<span id="cb11-41"><a href="cleaning-data.html#cb11-41"></a><span class="kw">attr</span>(HH98<span class="op">$</span>age, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;Head&#39;s age&quot;</span></span>
<span id="cb11-42"><a href="cleaning-data.html#cb11-42"></a><span class="kw">attr</span>(HH98<span class="op">$</span>literacy, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;Head&#39;s literacy&quot;</span></span>
<span id="cb11-43"><a href="cleaning-data.html#cb11-43"></a><span class="kw">attr</span>(HH98<span class="op">$</span>degree, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;Head&#39;s degree&quot;</span></span>
<span id="cb11-44"><a href="cleaning-data.html#cb11-44"></a><span class="kw">attr</span>(HH98<span class="op">$</span>occupationalst, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;Head&#39;s job status&quot;</span></span>
<span id="cb11-45"><a href="cleaning-data.html#cb11-45"></a><span class="kw">attr</span>(HH98<span class="op">$</span>maritalst, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;Head&#39;s marital status&quot;</span></span>
<span id="cb11-46"><a href="cleaning-data.html#cb11-46"></a><span class="kw">attr</span>(HH98<span class="op">$</span>ISIC_w, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;Head&#39;s Industry code of wage-earning job&quot;</span></span>
<span id="cb11-47"><a href="cleaning-data.html#cb11-47"></a><span class="kw">attr</span>(HH98<span class="op">$</span>ISCO_w, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;Head&#39;s Occupation code of wage-earning job&quot;</span></span>
<span id="cb11-48"><a href="cleaning-data.html#cb11-48"></a><span class="kw">attr</span>(HH98<span class="op">$</span>ISIC_s, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;Head&#39;s Industry code of non-wage job&quot;</span></span>
<span id="cb11-49"><a href="cleaning-data.html#cb11-49"></a><span class="kw">attr</span>(HH98<span class="op">$</span>ISCO_s, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;Head&#39;s Occupation code of non-wage job&quot;</span></span>
<span id="cb11-50"><a href="cleaning-data.html#cb11-50"></a><span class="kw">attr</span>(HH98<span class="op">$</span>income_nm_agriculture, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;Non-monetary income from agriculture&quot;</span></span>
<span id="cb11-51"><a href="cleaning-data.html#cb11-51"></a><span class="kw">attr</span>(HH98<span class="op">$</span>income_nm_nonagriculture, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;Non-monetary income from nonagriculture&quot;</span></span>
<span id="cb11-52"><a href="cleaning-data.html#cb11-52"></a><span class="kw">attr</span>(HH98<span class="op">$</span>income_nm_public, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;Non-monetary income from public sector job&quot;</span></span>
<span id="cb11-53"><a href="cleaning-data.html#cb11-53"></a><span class="kw">attr</span>(HH98<span class="op">$</span>income_nm_private, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;Non-monetary income from private sector job&quot;</span></span>
<span id="cb11-54"><a href="cleaning-data.html#cb11-54"></a><span class="kw">attr</span>(HH98<span class="op">$</span>netincome_w_m, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;wage-earning job: net income previous month&quot;</span></span>
<span id="cb11-55"><a href="cleaning-data.html#cb11-55"></a><span class="kw">attr</span>(HH98<span class="op">$</span>netincome_w_y, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;wage-earning job: net income previous year&quot;</span></span>
<span id="cb11-56"><a href="cleaning-data.html#cb11-56"></a><span class="kw">attr</span>(HH98<span class="op">$</span>income_w_y, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;wage-earning job: gross income previous year&quot;</span></span>
<span id="cb11-57"><a href="cleaning-data.html#cb11-57"></a><span class="kw">attr</span>(HH98<span class="op">$</span>income_s_y, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;non-wage job: net income previous year&quot;</span></span>
<span id="cb11-58"><a href="cleaning-data.html#cb11-58"></a></span>
<span id="cb11-59"><a href="cleaning-data.html#cb11-59"></a><span class="kw">saveRDS</span>(HH98, <span class="dt">file =</span> <span class="st">&quot;./exported/HH98.Rds&quot;</span>)</span></code></pre></div>
<div id="exporting-to-other-formats." class="section level3">
<h3><span class="header-section-number">4.8.1</span> Exporting to other formats.</h3>
<p>The <em>Rds</em> files can be easily converted to other formats using the proper <em>R</em> package. The package “haven” is a good choice to convert to ‘STATA’, ‘SPSS’, and ‘SAS’.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="cleaning-data.html#cb12-1"></a><span class="co">#######################################</span></span>
<span id="cb12-2"><a href="cleaning-data.html#cb12-2"></a><span class="co"># Exporting Rds files to CSV, STATA, etc.</span></span>
<span id="cb12-3"><a href="cleaning-data.html#cb12-3"></a></span>
<span id="cb12-4"><a href="cleaning-data.html#cb12-4"></a><span class="co">#install.packages(&quot;haven&quot;) # uncomment if not already installed</span></span>
<span id="cb12-5"><a href="cleaning-data.html#cb12-5"></a></span>
<span id="cb12-6"><a href="cleaning-data.html#cb12-6"></a>df &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;./exported/HH98.Rds&quot;</span>) <span class="co"># Specify the Rds file to convert here</span></span>
<span id="cb12-7"><a href="cleaning-data.html#cb12-7"></a></span>
<span id="cb12-8"><a href="cleaning-data.html#cb12-8"></a>haven<span class="op">::</span><span class="kw">write_dta</span>(df, <span class="st">&quot;./exported/HH98.dta&quot;</span>) <span class="co"># to export in STATA</span></span>
<span id="cb12-9"><a href="cleaning-data.html#cb12-9"></a><span class="kw">write_csv2</span>(df, <span class="st">&quot;./exported/HH98.csv&quot;</span>) <span class="co"># to export in CSV</span></span></code></pre></div>
</div>
</div>
<div id="special-issues-for-different-years" class="section level2">
<h2><span class="header-section-number">4.9</span> Special issues for different years</h2>
<p>There are some issues specific to one year or multiple years that are dealt with in the script of each year. We briefly mention them here:</p>
<ul>
<li><p>before 1396 SCI provides summary file separately and the weights are available only in summary files and not in the raw access files.</p></li>
<li><p>Education codes are changing before and after 1995, and we stick to new codings.</p></li>
<li><p>ISIC codes are changing after 1392 and the user must have this in mind.</p></li>
</ul>
<div id="the-structure-of-address-variable" class="section level3">
<h3><span class="header-section-number">4.9.1</span> The structure of Address variable</h3>
<p>The length and information in variable Address is changing from one year to another. Note that before 1387 the first digit corresponding to rural/urban could be 0/1. If the variable Address is converted to numeric format, before 1387, for rural areas the number of digits in Address is one less. Moreover, note that in years prior to 1382, the Address in the raw data is different from the Address provided in the summary files and the user must build the variable Address based on other variables and the information in the below table. Also in some older years (like 1376) the HH number reported in the data had 5 digits instead of 4. With careful investigation we realized that SCI wrongly inserted a “0” as the second digit of HH number for all household. After removing the second digit we could merge the summary files and raw files.</p>
<p><img src="figures/Address.png" /></p>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>A minor note on coding: this part of the code can be speeded up using <em>data.table</em> package instead of using summarize of <em>dplyr</em>. But because the <em>dplyr</em> coding is more intuitive we stick to it here. The code using <em>data.table</em> is written in the script in each year.<a href="cleaning-data.html#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="importing-raw-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="trends-in-expenditure-items.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
