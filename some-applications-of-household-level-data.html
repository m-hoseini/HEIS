<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Some applications of household-level data | Iran Household Expenditure and Income Surveys</title>
  <meta name="description" content="Chapter 8 Some applications of household-level data | Iran Household Expenditure and Income Surveys: Introduction and data cleaning" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Some applications of household-level data | Iran Household Expenditure and Income Surveys" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Chapter 8 Some applications of household-level data | Iran Household Expenditure and Income Surveys: Introduction and data cleaning" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Some applications of household-level data | Iran Household Expenditure and Income Surveys" />
  
  <meta name="twitter:description" content="Chapter 8 Some applications of household-level data | Iran Household Expenditure and Income Surveys: Introduction and data cleaning" />
  

<meta name="author" content="Mohammad Hoseini" />


<meta name="date" content="2021-09-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="trends-in-individual-level-data.html"/>

<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Iran HEIS surveys</a></li>

<li class="divider"></li>
<li><a href="index.html#section"></a>
<ul>
<li><a href="index.html#section-1"></a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#sample-design"><i class="fa fa-check"></i><b>1.1</b> Sample design</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#rotating-panel-feature"><i class="fa fa-check"></i><b>1.1.1</b> Rotating panel feature</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#different-rounds"><i class="fa fa-check"></i><b>1.2</b> Different rounds</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="questionnaire-details.html"><a href="questionnaire-details.html"><i class="fa fa-check"></i><b>2</b> Questionnaire details</a>
<ul>
<li class="chapter" data-level="2.1" data-path="questionnaire-details.html"><a href="questionnaire-details.html#part-1---member-characteristics"><i class="fa fa-check"></i><b>2.1</b> Part 1 - Member Characteristics</a></li>
<li class="chapter" data-level="2.2" data-path="questionnaire-details.html"><a href="questionnaire-details.html#part-2---household-facilities"><i class="fa fa-check"></i><b>2.2</b> Part 2 - Household Facilities</a></li>
<li class="chapter" data-level="2.3" data-path="questionnaire-details.html"><a href="questionnaire-details.html#part-3---expenditure"><i class="fa fa-check"></i><b>2.3</b> Part 3 - Expenditure</a></li>
<li class="chapter" data-level="2.4" data-path="questionnaire-details.html"><a href="questionnaire-details.html#part-4-income"><i class="fa fa-check"></i><b>2.4</b> Part 4: Income</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="importing-raw-data.html"><a href="importing-raw-data.html"><i class="fa fa-check"></i><b>3</b> Importing raw data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="importing-raw-data.html"><a href="importing-raw-data.html#importing-access-files-to-r"><i class="fa fa-check"></i><b>3.1</b> Importing access files to R</a></li>
<li class="chapter" data-level="3.2" data-path="importing-raw-data.html"><a href="importing-raw-data.html#importing-code-for-all-years"><i class="fa fa-check"></i><b>3.2</b> Importing code for all years</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="cleaning-data.html"><a href="cleaning-data.html"><i class="fa fa-check"></i><b>4</b> Cleaning data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="cleaning-data.html"><a href="cleaning-data.html#importing-raw-data-and-sampling-information"><i class="fa fa-check"></i><b>4.1</b> Importing raw data and sampling information</a></li>
<li class="chapter" data-level="4.2" data-path="cleaning-data.html"><a href="cleaning-data.html#cleaning-part-1"><i class="fa fa-check"></i><b>4.2</b> Cleaning Part 1</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="cleaning-data.html"><a href="cleaning-data.html#education-code"><i class="fa fa-check"></i><b>4.2.1</b> Education code</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="cleaning-data.html"><a href="cleaning-data.html#cleaning-part-2"><i class="fa fa-check"></i><b>4.3</b> Cleaning Part 2</a></li>
<li class="chapter" data-level="4.4" data-path="cleaning-data.html"><a href="cleaning-data.html#cleaning-part-3"><i class="fa fa-check"></i><b>4.4</b> Cleaning Part 3</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="cleaning-data.html"><a href="cleaning-data.html#price-index-and-real-expenditure"><i class="fa fa-check"></i><b>4.4.1</b> Price index and real expenditure</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="cleaning-data.html"><a href="cleaning-data.html#cleaning-part-4"><i class="fa fa-check"></i><b>4.5</b> Cleaning Part 4</a></li>
<li class="chapter" data-level="4.6" data-path="cleaning-data.html"><a href="cleaning-data.html#building-item-level-data"><i class="fa fa-check"></i><b>4.6</b> Building item-level data</a></li>
<li class="chapter" data-level="4.7" data-path="cleaning-data.html"><a href="cleaning-data.html#building-individual-level-data"><i class="fa fa-check"></i><b>4.7</b> Building individual-level data</a></li>
<li class="chapter" data-level="4.8" data-path="cleaning-data.html"><a href="cleaning-data.html#building-household-level-data-summary-files"><i class="fa fa-check"></i><b>4.8</b> Building Household-level data (summary files)</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="cleaning-data.html"><a href="cleaning-data.html#exporting-to-other-formats."><i class="fa fa-check"></i><b>4.8.1</b> Exporting to other formats.</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="cleaning-data.html"><a href="cleaning-data.html#special-issues-for-different-years"><i class="fa fa-check"></i><b>4.9</b> Special issues for different years</a>
<ul>
<li class="chapter" data-level="4.9.1" data-path="cleaning-data.html"><a href="cleaning-data.html#the-structure-of-address-variable"><i class="fa fa-check"></i><b>4.9.1</b> The structure of Address variable</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="trends-in-expenditure-items.html"><a href="trends-in-expenditure-items.html"><i class="fa fa-check"></i><b>5</b> Trends in expenditure items</a>
<ul>
<li class="chapter" data-level="5.1" data-path="trends-in-expenditure-items.html"><a href="trends-in-expenditure-items.html#total-expenditure-across-coicop-groups"><i class="fa fa-check"></i><b>5.1</b> Total expenditure across COICOP groups</a></li>
<li class="chapter" data-level="5.2" data-path="trends-in-expenditure-items.html"><a href="trends-in-expenditure-items.html#expenditure-shares-of-coicop-groups"><i class="fa fa-check"></i><b>5.2</b> Expenditure shares of COICOP groups</a></li>
<li class="chapter" data-level="5.3" data-path="trends-in-expenditure-items.html"><a href="trends-in-expenditure-items.html#percapita-expenditure-across-coicop-groups-and-regions"><i class="fa fa-check"></i><b>5.3</b> Percapita expenditure across COICOP groups and regions</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="trends-of-household-level-data.html"><a href="trends-of-household-level-data.html"><i class="fa fa-check"></i><b>6</b> Trends of household-level data</a></li>
<li class="chapter" data-level="7" data-path="trends-in-individual-level-data.html"><a href="trends-in-individual-level-data.html"><i class="fa fa-check"></i><b>7</b> Trends in individual-level data</a></li>
<li class="chapter" data-level="8" data-path="some-applications-of-household-level-data.html"><a href="some-applications-of-household-level-data.html"><i class="fa fa-check"></i><b>8</b> Some applications of household-level data</a>
<ul>
<li class="chapter" data-level="8.1" data-path="some-applications-of-household-level-data.html"><a href="some-applications-of-household-level-data.html#finding-the-trend-of-a-specific-expenditure-item"><i class="fa fa-check"></i><b>8.1</b> Finding the trend of a specific expenditure item</a></li>
<li class="chapter" data-level="8.2" data-path="some-applications-of-household-level-data.html"><a href="some-applications-of-household-level-data.html#finding-the-trend-of-percent-of-households-with-a-nonzero-expenditure-for-a-specific-items"><i class="fa fa-check"></i><b>8.2</b> Finding the trend of percent of households with a nonzero expenditure for a specific items</a></li>
<li class="chapter" data-level="8.3" data-path="some-applications-of-household-level-data.html"><a href="some-applications-of-household-level-data.html#gas-price-reform-in-november-2019-in-iran-and-poverty"><i class="fa fa-check"></i><b>8.3</b> Gas price reform in November 2019 in Iran and poverty</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank"> </a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Iran Household Expenditure and Income Surveys</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="some-applications-of-household-level-data" class="section level1" number="8">
<h1><span class="header-section-number">Chapter 8</span> Some applications of household-level data</h1>
<style type="text/css">
pre {
  max-height: 500px;
  overflow-y: auto;
}

pre[class] {
  max-height: 500px;
}
</style>
<p>In this section, I present some application of the household level data.</p>
<div id="finding-the-trend-of-a-specific-expenditure-item" class="section level2" number="8.1">
<h2><span class="header-section-number">8.1</span> Finding the trend of a specific expenditure item</h2>
<p>To find the trend of a specific expenditure item we can use expenditure files as follows</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="some-applications-of-household-level-data.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<pre><code>## -- Attaching packages --------------------------------------- tidyverse 1.3.1 --</code></pre>
<pre><code>## v ggplot2 3.3.5     v purrr   0.3.4
## v tibble  3.1.4     v dplyr   1.0.7
## v tidyr   1.1.3     v stringr 1.4.0
## v readr   2.0.1     v forcats 0.5.1</code></pre>
<pre><code>## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="some-applications-of-household-level-data.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">## merging different rounds</span></span>
<span id="cb5-2"><a href="some-applications-of-household-level-data.html#cb5-2" aria-hidden="true" tabindex="-1"></a>list_EXP <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">&quot;exported&quot;</span>, <span class="at">pattern =</span> <span class="st">&quot;^EXP.*</span><span class="sc">\\</span><span class="st">Rds$&quot;</span>)</span>
<span id="cb5-3"><a href="some-applications-of-household-level-data.html#cb5-3" aria-hidden="true" tabindex="-1"></a>EXP <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb5-4"><a href="some-applications-of-household-level-data.html#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (year <span class="cf">in</span> list_EXP) {</span>
<span id="cb5-5"><a href="some-applications-of-household-level-data.html#cb5-5" aria-hidden="true" tabindex="-1"></a>  EXP <span class="ot">&lt;-</span> <span class="fu">assign</span>(year, <span class="fu">readRDS</span>(<span class="fu">paste0</span>(<span class="st">&quot;exported/&quot;</span>,year))) <span class="sc">%&gt;%</span> </span>
<span id="cb5-6"><a href="some-applications-of-household-level-data.html#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">parse_number</span>(year)) <span class="sc">%&gt;%</span></span>
<span id="cb5-7"><a href="some-applications-of-household-level-data.html#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(EXP)</span>
<span id="cb5-8"><a href="some-applications-of-household-level-data.html#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list=</span>year)</span>
<span id="cb5-9"><a href="some-applications-of-household-level-data.html#cb5-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-10"><a href="some-applications-of-household-level-data.html#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="some-applications-of-household-level-data.html#cb5-11" aria-hidden="true" tabindex="-1"></a>exp <span class="ot">&lt;-</span> EXP <span class="sc">%&gt;%</span></span>
<span id="cb5-12"><a href="some-applications-of-household-level-data.html#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Global <span class="sc">==</span> <span class="dv">1011111</span>)  <span class="co"># here we choose the item based on the global code</span></span>
<span id="cb5-13"><a href="some-applications-of-household-level-data.html#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(exp, <span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span><span class="fu">log</span>(Value_r),<span class="at">color=</span>urban,<span class="at">shape=</span>urban)) <span class="sc">+</span> </span>
<span id="cb5-14"><a href="some-applications-of-household-level-data.html#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb5-15"><a href="some-applications-of-household-level-data.html#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb5-16"><a href="some-applications-of-household-level-data.html#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">&quot;trend of &quot;</span>,exp<span class="sc">$</span>item[<span class="dv">1</span>]))</span></code></pre></div>
<p><img src="HEIS_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
</div>
<div id="finding-the-trend-of-percent-of-households-with-a-nonzero-expenditure-for-a-specific-items" class="section level2" number="8.2">
<h2><span class="header-section-number">8.2</span> Finding the trend of percent of households with a nonzero expenditure for a specific items</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="some-applications-of-household-level-data.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) </span>
<span id="cb6-2"><a href="some-applications-of-household-level-data.html#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="some-applications-of-household-level-data.html#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb6-4"><a href="some-applications-of-household-level-data.html#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="some-applications-of-household-level-data.html#cb6-5" aria-hidden="true" tabindex="-1"></a>list_HEIS <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">&quot;exported&quot;</span>, <span class="at">pattern =</span> <span class="st">&quot;^HEIS.*</span><span class="sc">\\</span><span class="st">Rdata$&quot;</span>)</span>
<span id="cb6-6"><a href="some-applications-of-household-level-data.html#cb6-6" aria-hidden="true" tabindex="-1"></a>EXPS <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb6-7"><a href="some-applications-of-household-level-data.html#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (year <span class="cf">in</span> list_HEIS) {</span>
<span id="cb6-8"><a href="some-applications-of-household-level-data.html#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="fu">paste0</span>(<span class="st">&quot;exported/&quot;</span>,year))</span>
<span id="cb6-9"><a href="some-applications-of-household-level-data.html#cb6-9" aria-hidden="true" tabindex="-1"></a>  yr <span class="ot">=</span> <span class="fu">parse_number</span>(year)</span>
<span id="cb6-10"><a href="some-applications-of-household-level-data.html#cb6-10" aria-hidden="true" tabindex="-1"></a>  EXPS <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">mget</span>(<span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">&quot;^.*P3S.*&quot;</span>))) <span class="sc">%&gt;%</span> <span class="co"># enter the table of the item</span></span>
<span id="cb6-11"><a href="some-applications-of-household-level-data.html#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Global <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2127125</span>,<span class="dv">2127131</span>)) <span class="sc">%&gt;%</span> <span class="co"># item codes are entered here</span></span>
<span id="cb6-12"><a href="some-applications-of-household-level-data.html#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Address,Global, value) <span class="sc">%&gt;%</span></span>
<span id="cb6-13"><a href="some-applications-of-household-level-data.html#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(Global,Address) <span class="sc">%&gt;%</span></span>
<span id="cb6-14"><a href="some-applications-of-household-level-data.html#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Global, <span class="at">names_prefix=</span><span class="st">&quot;exp_&quot;</span>, <span class="at">values_from =</span> value, <span class="at">values_fn =</span> sum) <span class="sc">%&gt;%</span></span>
<span id="cb6-15"><a href="some-applications-of-household-level-data.html#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year =</span> yr) <span class="sc">%&gt;%</span></span>
<span id="cb6-16"><a href="some-applications-of-household-level-data.html#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(EXPS)</span>
<span id="cb6-17"><a href="some-applications-of-household-level-data.html#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> yr)) <span class="co"># removing unnecessary objects</span></span>
<span id="cb6-18"><a href="some-applications-of-household-level-data.html#cb6-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-19"><a href="some-applications-of-household-level-data.html#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="some-applications-of-household-level-data.html#cb6-20" aria-hidden="true" tabindex="-1"></a>list_HH <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">&quot;exported&quot;</span>, <span class="at">pattern =</span> <span class="st">&quot;^HH.*</span><span class="sc">\\</span><span class="st">Rds$&quot;</span>)</span>
<span id="cb6-21"><a href="some-applications-of-household-level-data.html#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="some-applications-of-household-level-data.html#cb6-22" aria-hidden="true" tabindex="-1"></a>HH <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb6-23"><a href="some-applications-of-household-level-data.html#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (year <span class="cf">in</span> list_HH) {</span>
<span id="cb6-24"><a href="some-applications-of-household-level-data.html#cb6-24" aria-hidden="true" tabindex="-1"></a>  HH <span class="ot">&lt;-</span> <span class="fu">assign</span>(year, <span class="fu">readRDS</span>(<span class="fu">paste0</span>(<span class="st">&quot;exported/&quot;</span>,year))) <span class="sc">%&gt;%</span> </span>
<span id="cb6-25"><a href="some-applications-of-household-level-data.html#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(weight)) <span class="sc">%&gt;%</span></span>
<span id="cb6-26"><a href="some-applications-of-household-level-data.html#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">parse_number</span>(year)) <span class="sc">%&gt;%</span></span>
<span id="cb6-27"><a href="some-applications-of-household-level-data.html#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(HH)</span>
<span id="cb6-28"><a href="some-applications-of-household-level-data.html#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list=</span>year)</span>
<span id="cb6-29"><a href="some-applications-of-household-level-data.html#cb6-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-30"><a href="some-applications-of-household-level-data.html#cb6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-31"><a href="some-applications-of-household-level-data.html#cb6-31" aria-hidden="true" tabindex="-1"></a>HH <span class="sc">%&gt;%</span></span>
<span id="cb6-32"><a href="some-applications-of-household-level-data.html#cb6-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(EXPS) <span class="sc">%&gt;%</span></span>
<span id="cb6-33"><a href="some-applications-of-household-level-data.html#cb6-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb6-34"><a href="some-applications-of-household-level-data.html#cb6-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;exp_&quot;</span>),<span class="sc">~</span><span class="fu">weighted.mean</span>(<span class="sc">!</span><span class="fu">is.na</span>(.x),weight)<span class="sc">*</span><span class="dv">100</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-35"><a href="some-applications-of-household-level-data.html#cb6-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">&quot;exp_&quot;</span>), <span class="at">names_to =</span> <span class="st">&quot;item&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;nonzero_percent&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-36"><a href="some-applications-of-household-level-data.html#cb6-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>year,<span class="at">y=</span>nonzero_percent, <span class="at">shape=</span>item, <span class="at">color=</span>item)) <span class="sc">+</span></span>
<span id="cb6-37"><a href="some-applications-of-household-level-data.html#cb6-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code></pre></div>
<pre><code>## Joining, by = c(&quot;Address&quot;, &quot;year&quot;)</code></pre>
<p><img src="HEIS_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
</div>
<div id="gas-price-reform-in-november-2019-in-iran-and-poverty" class="section level2" number="8.3">
<h2><span class="header-section-number">8.3</span> Gas price reform in November 2019 in Iran and poverty</h2>
<p>The Iranian government announced an increase in gas price from 1000T to 3000T per liter in November 2019 (Aban 1398) and paid the revenue from this reform to the bottom 60% of household in the income disribution. To see whether this policy help improving the living condition of lower income households or not we compare the monthly trend of share of food expenditure in 1397 and 1398. As food is neccesary for housholds its share in total expenditure is a simple measure of poverty. The below code and its output shows that prior to Aban the food share in 1398 was higher than 1397, suggesting worse living condition in 1398. But after Aban the share declined and in 1398 were lower than 1397, which is most probably due to the gas price reform and its subsequent subsidies.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="some-applications-of-household-level-data.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb8-2"><a href="some-applications-of-household-level-data.html#cb8-2" aria-hidden="true" tabindex="-1"></a>monthly <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;./exported/HH97.Rds&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="some-applications-of-household-level-data.html#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year=</span><span class="st">&quot;97&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="some-applications-of-household-level-data.html#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">readRDS</span>(<span class="st">&quot;./exported/HH98.Rds&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="some-applications-of-household-level-data.html#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year=</span><span class="fu">replace_na</span>(year,<span class="st">&quot;98&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-6"><a href="some-applications-of-household-level-data.html#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month,year) <span class="sc">%&gt;%</span></span>
<span id="cb8-7"><a href="some-applications-of-household-level-data.html#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(cost_food,expenditure),<span class="sc">~</span><span class="fu">sum</span>(.x<span class="sc">*</span>weight,<span class="at">na.rm=</span>T))) <span class="sc">%&gt;%</span></span>
<span id="cb8-8"><a href="some-applications-of-household-level-data.html#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">foodshare=</span>cost_food<span class="sc">/</span>expenditure) <span class="sc">%&gt;%</span></span>
<span id="cb8-9"><a href="some-applications-of-household-level-data.html#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(month<span class="sc">&gt;</span><span class="dv">0</span>)</span>
<span id="cb8-10"><a href="some-applications-of-household-level-data.html#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="some-applications-of-household-level-data.html#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(monthly,<span class="fu">aes</span>(month, foodshare, <span class="at">color =</span> year, <span class="at">shape =</span> year)) <span class="sc">+</span> </span>
<span id="cb8-12"><a href="some-applications-of-household-level-data.html#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb8-13"><a href="some-applications-of-household-level-data.html#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb8-14"><a href="some-applications-of-household-level-data.html#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;share of food in monthly expenditure&quot;</span>) <span class="sc">+</span> </span>
<span id="cb8-15"><a href="some-applications-of-household-level-data.html#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>)</span></code></pre></div>
<p><img src="figures/Gasprice.png" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="trends-in-individual-level-data.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/08-othertrends.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["HEIS.pdf", "HEIS.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
